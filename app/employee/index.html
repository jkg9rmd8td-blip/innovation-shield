<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <title>Ø¯Ø±Ø¹ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± | Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/app.css" />
    <style>
        .function-list {
            margin: 10px 0 0;
            padding: 0;
            list-style: none;
            display: grid;
            gap: 6px;
            color: var(--muted2);
        }

        .employee-control-bar {
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, .12);
            background: linear-gradient(150deg, rgba(78, 163, 255, .14), rgba(66, 246, 231, .06));
            padding: 12px;
            margin-top: 12px;
            box-shadow: var(--shadow2);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr)) auto;
            gap: 8px;
            align-items: end;
        }

        .segmented {
            display: inline-flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .segmented .btn {
            min-height: 34px;
            padding: 0 10px;
        }

        .segmented .btn.is-active {
            border-color: rgba(78, 163, 255, .32);
            background: rgba(78, 163, 255, .18);
        }

        .filter-chip-row {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-chip {
            border: 1px solid rgba(255, 255, 255, .14);
            background: rgba(255, 255, 255, .05);
            color: #e6efff;
            border-radius: 999px;
            min-height: 30px;
            padding: 0 10px;
            font-size: 12px;
            font-weight: 800;
            cursor: pointer;
        }

        .filter-chip.is-active {
            border-color: rgba(66, 246, 231, .40);
            background: rgba(66, 246, 231, .16);
        }

        .table-tools.table-tools-employee {
            display: grid;
            grid-template-columns: 1.2fr repeat(4, minmax(130px, 1fr)) auto;
            gap: 8px;
        }

        .journey-panel {
            margin-top: 12px;
        }

        .journey-strip {
            display: grid;
            grid-template-columns: repeat(6, minmax(0, 1fr));
            gap: 8px;
        }

        .journey-step {
            position: relative;
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 14px;
            background: rgba(255, 255, 255, .03);
            min-height: 88px;
            padding: 8px;
            display: grid;
            align-content: space-between;
            gap: 4px;
        }

        .journey-step small {
            color: var(--muted2);
            font-size: 11px;
            font-weight: 800;
        }

        .journey-step strong {
            font-size: 13px;
            font-weight: 900;
            line-height: 1.4;
        }

        .journey-step.is-active {
            border-color: rgba(78, 163, 255, .45);
            background: rgba(78, 163, 255, .16);
            box-shadow: inset 0 0 0 1px rgba(78, 163, 255, .32);
        }

        .journey-step.is-done {
            border-color: rgba(57, 229, 140, .32);
            background: rgba(57, 229, 140, .12);
        }

        .focus-grid {
            margin-top: 12px;
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
        }

        .focus-card {
            min-height: 220px;
        }

        .metric-rings {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 8px;
            margin-top: 2px;
        }

        .ring-wrap {
            display: grid;
            justify-items: center;
            gap: 6px;
        }

        .ring {
            --p: 0;
            width: 82px;
            height: 82px;
            border-radius: 50%;
            background: conic-gradient(rgba(78, 163, 255, .95) calc(var(--p) * 1%), rgba(255, 255, 255, .11) 0);
            display: grid;
            place-items: center;
            position: relative;
        }

        .ring::before {
            content: "";
            position: absolute;
            width: 62px;
            height: 62px;
            border-radius: 50%;
            background: rgba(10, 17, 26, .90);
            border: 1px solid rgba(255, 255, 255, .10);
        }

        .ring b {
            position: relative;
            z-index: 1;
            font-size: 12px;
            font-weight: 900;
        }

        .ring-wrap small {
            color: var(--muted2);
            font-size: 11px;
            text-align: center;
        }

        .alert-list {
            margin: 0;
            padding: 0;
            list-style: none;
            display: grid;
            gap: 8px;
        }

        .alert-list li {
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, .12);
            background: rgba(255, 255, 255, .03);
            padding: 8px;
            color: #dce8ff;
            line-height: 1.7;
            font-size: 13px;
        }

        .proto-table tbody tr.is-focused {
            background: rgba(78, 163, 255, .12);
        }

        @media (max-width: 1200px) {
            .control-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .table-tools.table-tools-employee {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .journey-strip {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }

            .focus-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 680px) {
            .journey-strip,
            .metric-rings {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>

<body class="career-body">

    <div class="platform-bg">
        <div class="mesh mesh-1"></div>
        <div class="mesh mesh-2"></div>
        <div class="mesh mesh-3"></div>
    </div>

    <div class="platform-shell">

        <!-- TOPBAR -->
        <header class="platform-topbar reveal">
            <div class="topbar-brand">
                <div class="brand-mark">IS</div>
                <div>
                    <h1 class="topbar-title">Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</h1>
                    <p class="topbar-sub">Ù…Ù„Ù Ù…Ø¨ØªÙƒØ± â€¢ Workspace â€¢ Prototype Stage â€¢ Audit</p>
                </div>
            </div>

            <nav class="nav">
                <a href="../../index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="../map/index.html">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±</a>
                <a href="../prototype/index.html">Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</a>
                <a href="../employee/index.html" class="active">Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</a>
                <a href="../judging/index.html">Ø§Ù„ØªØ­ÙƒÙŠÙ…</a>
                <a href="../command/index.html">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</a>
                <a href="../policies/index.html">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</a>
                <a href="../report/index.html">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ</a>
            </nav>

            <div class="topbar-actions">
                <span class="live-pill"><span class="live-dot"></span>Ù…Ù„Ù Ù†Ø´Ø·</span>
                <button class="btn btn-primary" id="btnNew">Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø¯Ø±Ø©</button>
                <button class="btn btn-soft" id="btnMap">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±</button>
                <button class="btn btn-ghost" id="btnApiSettings">API</button>
            </div>
        </header>

        <div class="platform-body">

            <!-- SIDEBAR -->
            <aside class="platform-sidebar reveal">

                <!-- Profile -->
                <section class="profile-card">
                    <div class="profile-head">
                        <div class="avatar" id="pfAvatar">Ù…</div>
                        <div>
                            <h2 id="pfName">â€”</h2>
                            <p class="role" id="pfRole">â€”</p>
                        </div>
                    </div>

                    <dl class="meta-list">
                        <div>
                            <dt>Ø§Ù„Ø¬Ù‡Ø©</dt>
                            <dd id="pfOrg">â€”</dd>
                        </div>
                        <div>
                            <dt>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©/Ø§Ù„Ù‚Ø³Ù…</dt>
                            <dd id="pfDept">â€”</dd>
                        </div>
                        <div>
                            <dt>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</dt>
                            <dd><span class="level-chip" id="pfLevel">â€”</span></dd>
                        </div>
                    </dl>
                </section>

                <!-- Readiness -->
                <section class="side-panel">
                    <h3>Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±ÙŠ</h3>

                    <div class="readiness-box">
                        <div class="readiness-meta">
                            <span>Ù…Ø¤Ø´Ø± Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©</span>
                            <strong id="rdPct">â€”</strong>
                        </div>
                        <div class="progress-track"><span id="rdBar"></span></div>
                        <p class="points-line">Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: <strong id="pfPoints">â€”</strong></p>
                    </div>

                    <ul class="metric-list">
                        <li><span>Ù…Ø¨Ø§Ø¯Ø±Ø§ØªÙŠ</span> <strong id="mTotal">â€”</strong></li>
                        <li><span>Ù‚ÙŠØ¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ</span> <strong id="mProto">â€”</strong></li>
                        <li><span>Ù…Ø¹ØªÙ…Ø¯Ø©</span> <strong id="mApproved">â€”</strong></li>
                    </ul>
                </section>

                <!-- NDA / Governance -->
                <section class="side-panel">
                    <h3>Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>

                    <p class="nda-status is-off" id="ndaBox">Ù„Ù… ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„ ØªØ¹Ù‡Ø¯ Ø§Ù„Ø³Ø±ÙŠØ© Ø¨Ø¹Ø¯</p>

                    <button class="btn btn-primary" data-accept-policy id="btnAccept">
                        Ù‚Ø¨ÙˆÙ„ ØªØ¹Ù‡Ø¯ Ø§Ù„Ø³Ø±ÙŠØ© (NDA)
                    </button>

                    <p class="generated" style="margin-top:6px;">
                        Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ù‡Ø¯ ÙŠÙØ¹Ù‘Ù„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø¯Ø§Ø®Ù„ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„ ÙˆÙŠÙØ³Ø¬Ù‘ÙÙ„ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚.
                    </p>
                </section>

            </aside>

            <!-- MAIN -->
            <main class="platform-main reveal">

                <!-- Banner -->
                <section class="workspace-banner">
                    <div>
                        <p class="eyebrow">Innovation Workspace</p>
                        <h2 class="hero-title">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±ÙŠØ©: Ù…Ù† Ø§Ù„ÙÙƒØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨Ø®Ø·ÙˆØ§Øª ÙˆØ§Ø¶Ø­Ø©</h2>
                        <p class="hero-sub">
                            ÙƒÙ„ ÙˆØ¸Ø§Ø¦ÙÙƒ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© Ø§Ù„Ø¢Ù† ÙÙŠ Ø´Ø§Ø´Ø© ÙˆØ§Ø­Ø¯Ø©: Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§ØªØŒ Ø±ÙØ¹ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©ØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…ØŒ
                            ÙˆØªØªØ¨Ø¹ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ØªØ­ÙƒÙŠÙ….
                        </p>
                        <ul class="function-list">
                            <li>1) Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¨Ø§Ø¯Ø±Ø§ØªÙƒ ÙˆØªØ­Ø¯ÙŠØ¯ Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°</li>
                            <li>2) ØªØ´ØºÙŠÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø¨Ø³Ø±Ø¹Ø©</li>
                            <li>3) Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù… Ø¹Ø¨Ø± Ù…Ø³Ø§Ø± Ø¨ØµØ±ÙŠ Ù…Ø¨Ø§Ø´Ø±</li>
                        </ul>
                    </div>

                    <div class="quality-pill" id="bannerState">âš¡ Ø¬Ø§Ù‡Ø²ÙŠØ© Ù…ØªÙˆØ³Ø·Ø©</div>
                </section>

                <section class="employee-control-bar">
                    <div class="control-grid">
                        <div class="field">
                            <div class="lbl">ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶</div>
                            <select id="viewMode">
                                <option value="executive">ØªÙ†ÙÙŠØ°ÙŠ</option>
                                <option value="detailed" selected>ØªÙØµÙŠÙ„ÙŠ</option>
                            </select>
                        </div>
                        <div class="field">
                            <div class="lbl">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ù…</div>
                            <select id="globalSort">
                                <option value="updated">Ø§Ù„Ø£Ø­Ø¯Ø« ØªØ­Ø¯ÙŠØ«Ù‹Ø§</option>
                                <option value="priority">Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</option>
                                <option value="progress">Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…</option>
                            </select>
                        </div>
                        <div class="field">
                            <div class="lbl">Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø²Ù…Ù†ÙŠ</div>
                            <div class="segmented">
                                <button class="btn btn-soft is-active" data-focus-range="today">Ø§Ù„ÙŠÙˆÙ…</button>
                                <button class="btn btn-soft" data-focus-range="week">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
                                <button class="btn btn-soft" data-focus-range="month">Ø§Ù„Ø´Ù‡Ø±</button>
                            </div>
                        </div>
                        <div class="field">
                            <div class="lbl">ØªØ­Ø¯ÙŠØ« Ø³Ø±ÙŠØ¹</div>
                            <button class="btn btn-primary" id="btnFocusRefresh">Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù„ÙˆØ­Ø©</button>
                        </div>
                    </div>
                    <div class="filter-chip-row" id="quickStageChips"></div>
                </section>

                <!-- Stats -->
                <section class="stats-grid">
                    <div class="stat-card stat-a">
                        <p>Ù…Ø¨Ø§Ø¯Ø±Ø§ØªÙŠ</p>
                        <h3 id="sMy">â€”</h3>
                        <small>ÙƒÙ„ Ù…Ø§ ØªØ¨Ø¯Ø£ Ø¨Ø¯Ø±ÙŠâ€¦ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØªØ­Ø¨Ù‘Ùƒ Ø£ÙƒØ«Ø± ğŸ˜„</small>
                    </div>

                    <div class="stat-card stat-b">
                        <p>Ù…Ù‡Ø§Ù…ÙŠ Ø§Ù„Ù…ÙØªÙˆØ­Ø©</p>
                        <h3 id="sTasks">â€”</h3>
                        <small>Ù†Ù‚Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… = ØªÙ‚Ø¯Ù… Ø­Ù‚ÙŠÙ‚ÙŠ</small>
                    </div>

                    <div class="stat-card stat-c">
                        <p>Prototype Active</p>
                        <h3 id="sProto">â€”</h3>
                        <small>Ù‚ÙˆØ§Ù„Ø¨ + Ø¯Ø¹Ù… ÙˆØ­Ø¯Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</small>
                    </div>

                    <div class="stat-card stat-d">
                        <p>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</p>
                        <h3 id="sPoints">â€”</h3>
                        <small>ØªØªØ±Ø§ÙƒÙ… Ù…Ø¹ Ø§Ù„ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø²</small>
                    </div>
                </section>

                <section class="panel journey-panel">
                    <div class="panel-head">
                        <h3>Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¨ØµØ±ÙŠ Ù„Ù„Ù…ÙˆØ¸Ù</h3>
                        <span class="panel-note" id="journeyHint">â€”</span>
                    </div>
                    <div class="journey-strip" id="employeeJourney"></div>
                </section>

                <!-- Two columns -->
                <section class="insights-grid">

                    <!-- My Initiatives -->
                    <section class="panel">
                        <div class="panel-head">
                            <h3>Ù…Ø¨Ø§Ø¯Ø±Ø§ØªÙŠ</h3>
                            <span class="panel-note" id="iniCount">â€”</span>
                        </div>

                        <div class="table-tools table-tools-employee">
                            <input id="q" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø±Ùâ€¦" />
                            <select id="stageFilter">
                                <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</option>
                            </select>
                            <select id="statusFilter">
                                <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            </select>
                            <select id="priorityFilter">
                                <option value="">ÙƒÙ„ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                                <option>Ø­Ø±Ø¬Ø©</option>
                                <option>Ø¹Ø§Ù„ÙŠØ©</option>
                                <option>Ù…ØªÙˆØ³Ø·Ø©</option>
                                <option>Ù…Ù†Ø®ÙØ¶Ø©</option>
                            </select>
                            <select id="sortBy">
                                <option value="updated">Ø§Ù„Ø£Ø­Ø¯Ø« ØªØ­Ø¯ÙŠØ«Ù‹Ø§</option>
                                <option value="progress">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚Ø¯Ù…Ù‹Ø§</option>
                                <option value="priority">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø£ÙˆÙ„ÙˆÙŠØ©</option>
                            </select>
                            <span class="table-count" id="countPill">â€”</span>
                        </div>

                        <div class="table-wrap" style="margin-top:10px;">
                            <table class="proto-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ù…Ø¹Ø±Ù</th>
                                        <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                        <th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                                        <th>Ø§Ù„ØªÙ‚Ø¯Ù…</th>
                                        <th>Prototype</th>
                                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="tb"></tbody>
                            </table>
                        </div>

                        <div class="empty-line" id="emptyRow" style="display:none; margin-top:10px;">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬â€¦ Ø¬Ø±Ù‘Ø¨ ØªØºÙŠØ± Ø§Ù„Ø¨Ø­Ø«/Ø§Ù„ÙÙ„ØªØ±.
                        </div>
                    </section>

                    <!-- Prototype Stage -->
                    <section class="panel">
                        <div class="panel-head">
                            <h3>Ù…Ø±Ø­Ù„Ø© ØªØ·ÙˆÙŠØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ</h3>
                            <span class="panel-note">Prototype Stage</span>
                        </div>

                        <ul class="stage-bars" id="protoList"></ul>

                        <div class="hr"></div>

                        <div class="panel-head">
                            <h3>Ù…Ù‡Ø§Ù… Ø³Ø±ÙŠØ¹Ø©</h3>
                            <span class="panel-note">Task Focus</span>
                        </div>

                        <ul class="insight-list" id="taskList"></ul>

                    </section>

                </section>

                <section class="focus-grid">
                    <section class="panel focus-card">
                        <div class="panel-head">
                            <h3>ÙˆØ¸Ø§Ø¦Ù Ù…Ø¨Ø§Ø´Ø±Ø©</h3>
                            <span class="panel-note" id="focusTitle">â€”</span>
                        </div>
                        <ul class="insight-list" id="focusTasks"></ul>
                    </section>

                    <section class="panel focus-card">
                        <div class="panel-head">
                            <h3>Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„</h3>
                            <span class="panel-note">Dashboard</span>
                        </div>
                        <div class="metric-rings">
                            <div class="ring-wrap">
                                <div class="ring" id="ringInitiative" style="--p:0;"><b id="ringInitiativeVal">â€”</b></div>
                                <small>ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©</small>
                            </div>
                            <div class="ring-wrap">
                                <div class="ring" id="ringReadiness" style="--p:0;"><b id="ringReadinessVal">â€”</b></div>
                                <small>Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…Ù„Ù</small>
                            </div>
                            <div class="ring-wrap">
                                <div class="ring" id="ringTasks" style="--p:0;"><b id="ringTasksVal">â€”</b></div>
                                <small>Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù‡Ø§Ù…</small>
                            </div>
                        </div>
                        <ul class="insight-list" id="focusMetrics" style="margin-top:10px;"></ul>
                    </section>

                    <section class="panel focus-card">
                        <div class="panel-head">
                            <h3>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØªØ´Ø®ÙŠØµ</h3>
                            <span class="panel-note">Smart Alerts</span>
                        </div>
                        <ul class="alert-list" id="focusAlerts"></ul>
                    </section>
                </section>

                <!-- Audit -->
                <section class="panel">
                    <div class="panel-head">
                        <h3>Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ (Audit Log)</h3>
                        <span class="panel-note">ÙŠÙØ³Ø¬Ù‘Ù„ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø«</span>
                    </div>

                    <ul class="timeline" id="audit"></ul>
                </section>

            </main>

        </div>
    </div>

    <div class="modal hidden" id="modalApi">
        <div class="modal-backdrop" data-close-api></div>
        <div class="modal-card">
            <div class="mhead">
                <div class="mtitle">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· API</div>
                <button class="btn btn-ghost" data-close-api>Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
            <div class="field">
                <div class="lbl">API Base URL</div>
                <input id="apiBaseInput" placeholder="http://127.0.0.1:8080" dir="ltr" />
            </div>
            <div class="mfoot">
                <div class="mtext" id="apiStateHint">ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.</div>
                <button class="btn btn-soft" id="btnApiTest">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
                <button class="btn btn-primary" id="btnApiSave">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Core JS -->
    <script src="../../assets/js/app.js"></script>

    <script>
        (() => {
            "use strict";

            const $ = (s, r = document) => r.querySelector(s);
            const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
            const IS = window.IS;

            const fmt = (n) => new Intl.NumberFormat("ar-SA").format(Number(n || 0));
            const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
            const esc = (v) => String(v ?? "")
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;");
            const normalize = (v) => String(v || "")
                .toLowerCase()
                .replace(/[Ø£Ø¥Ø¢]/g, "Ø§")
                .replace(/Ø©/g, "Ù‡")
                .replace(/Ù‰/g, "ÙŠ")
                .trim();
            const nowISO = () => new Date().toISOString();
            const priorityRank = { "Ø­Ø±Ø¬Ø©": 4, "Ø¹Ø§Ù„ÙŠØ©": 3, "Ù…ØªÙˆØ³Ø·Ø©": 2, "Ù…Ù†Ø®ÙØ¶Ø©": 1 };
            const API_BASE_KEY = "IS_API_BASE";
            const DEFAULT_API_BASE = localStorage.getItem(API_BASE_KEY) || "http://127.0.0.1:8080";

            function openApiModal() {
                $("#apiBaseInput").value = getApiBase();
                $("#apiStateHint").textContent = "ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.";
                $("#modalApi").classList.remove("hidden");
            }

            function closeApiModal() { $("#modalApi").classList.add("hidden"); }
            $$("[data-close-api]").forEach((b) => b.addEventListener("click", closeApiModal));

            function setApiBase(nextBase) {
                const clean = String(nextBase || "").trim().replace(/\/+$/, "");
                if (!clean) return null;
                localStorage.setItem(API_BASE_KEY, clean);
                return clean;
            }

            const JOURNEY = [
                { key: "idea", label: "ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙÙƒØ±Ø©", stages: ["Ø§Ù„ÙÙƒØ±Ø©"] },
                { key: "eval", label: "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", stages: ["Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"] },
                { key: "proto", label: "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ", stages: ["Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ"] },
                { key: "pilot", label: "Ø§Ù„ØªØ¬Ø±Ø¨Ø©", stages: ["Ø§Ù„ØªØ¬Ø±Ø¨Ø©"] },
                { key: "approve", label: "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯", stages: ["Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯"] },
                { key: "apply", label: "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚", stages: ["Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"] }
            ];

            const ui = {
                focusRange: "today",
                focusedId: IS.getSelectedInitiative() || null
            };

            function initials(name) {
                const t = (name || "Ù…").trim();
                return t.slice(0, 1);
            }

            function parseDate(v) {
                if (!v) return null;
                const d = new Date(v);
                return Number.isNaN(d.getTime()) ? null : d;
            }

            function getApiBase() {
                return (localStorage.getItem(API_BASE_KEY) || DEFAULT_API_BASE).replace(/\/+$/, "");
            }

            function mapStageToLocal(stageValue) {
                const raw = normalize(stageValue || "");
                const map = {
                    "idea_submission": "Ø§Ù„ÙÙƒØ±Ø©",
                    "screening": "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
                    "evaluation": "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
                    "team_formation": "Ø§Ù„ØªØ·ÙˆÙŠØ±",
                    "prototype": "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ",
                    "development": "Ø§Ù„ØªØ·ÙˆÙŠØ±",
                    "pilot": "Ø§Ù„ØªØ¬Ø±Ø¨Ø©",
                    "approval": "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯",
                    "legal_protection": "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯",
                    "launch": "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
                };
                if (map[raw]) return map[raw];
                if (String(stageValue || "").trim()) return String(stageValue).trim();
                return "Ø§Ù„ÙÙƒØ±Ø©";
            }

            function mapStatusToLocal(statusValue) {
                const raw = normalize(statusValue || "");
                const map = {
                    "draft": "Ù…Ø³ÙˆØ¯Ø©",
                    "in_review": "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…",
                    "in_progress": "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",
                    "pilot": "Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©",
                    "approved": "Ù…Ø¹ØªÙ…Ø¯",
                    "rejected": "Ù…Ø±ÙÙˆØ¶",
                    "launched": "Ù…Ø·Ù„Ù‚"
                };
                if (map[raw]) return map[raw];
                if (String(statusValue || "").trim()) return String(statusValue).trim();
                return "Ù…Ø³ÙˆØ¯Ø©";
            }

            function stageProgress(stage) {
                const s = mapStageToLocal(stage);
                const p = {
                    "Ø§Ù„ÙÙƒØ±Ø©": 12,
                    "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…": 28,
                    "Ø§Ù„ØªØ·ÙˆÙŠØ±": 46,
                    "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ": 58,
                    "Ø§Ù„ØªØ¬Ø±Ø¨Ø©": 72,
                    "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯": 84,
                    "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚": 96
                };
                return p[s] || 20;
            }

            function withTimeout(promise, ms = 2600) {
                let timer = null;
                const timeout = new Promise((_, reject) => {
                    timer = setTimeout(() => reject(new Error("REQUEST_TIMEOUT")), ms);
                });
                return Promise.race([promise, timeout]).finally(() => clearTimeout(timer));
            }

            function toLocalInitiativeShape(remote) {
                return {
                    id: remote.id,
                    title: remote.title || "Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†",
                    stage: mapStageToLocal(remote.stage),
                    status: mapStatusToLocal(remote.status),
                    progress: stageProgress(remote.stage),
                    updatedAt: remote.updatedAt || remote.createdAt || nowISO(),
                    tags: Array.isArray(remote.tags) ? remote.tags : [],
                    tasks: [],
                    prototype: null
                };
            }

            async function syncInitiativesFromApi({ silent = false } = {}) {
                const base = getApiBase();
                const endpoint = `${base}/api/v2/initiatives`;
                try {
                    const res = await withTimeout(fetch(endpoint, {
                        method: "GET",
                        headers: { "Content-Type": "application/json" }
                    }), 2600);

                    if (!res.ok) throw new Error(`API_${res.status}`);
                    const payload = await res.json();
                    const rows = Array.isArray(payload?.data) ? payload.data : (Array.isArray(payload) ? payload : []);
                    if (!rows.length) return { loaded: false, count: 0 };

                    const remote = rows
                        .filter((r) => r && r.id)
                        .map(toLocalInitiativeShape);

                    const local = IS.state.initiatives || [];
                    const localMap = new Map(local.map((i) => [i.id, i]));
                    const merged = remote.map((r) => ({
                        ...(localMap.get(r.id) || {}),
                        ...r,
                        tasks: Array.isArray(localMap.get(r.id)?.tasks) ? localMap.get(r.id).tasks : [],
                        prototype: localMap.get(r.id)?.prototype || null,
                        priority: localMap.get(r.id)?.priority
                    }));

                    local.forEach((i) => {
                        if (!merged.some((x) => x.id === i.id)) merged.push(i);
                    });

                    IS.state.initiatives = merged;
                    IS.save();

                    if (!silent) IS.toast(`ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© ${fmt(remote.length)} Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…Ù† API`, "ok", 1500);
                    return { loaded: true, count: remote.length };
                } catch (err) {
                    if (!silent) {
                        IS.toast("API ØºÙŠØ± Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù†. ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.", "warn", 1800);
                    }
                    return { loaded: false, count: 0, error: err?.message || "API_UNAVAILABLE" };
                }
            }

            function allTasks(initiatives) {
                const out = [];
                (initiatives || []).forEach((i) => (i.tasks || []).forEach((t) => out.push({ ...t, ini: i.id, titleIni: i.title })));
                return out;
            }

            function riskPct(initiative) {
                const p = initiative?.riskProfile || {};
                const vals = [
                    Number(p.operational || 2),
                    Number(p.financial || 2),
                    Number(p.technical || 2),
                    Number(p.quality || 2),
                    Number(p.experience || 2)
                ];
                const avg = vals.reduce((a, b) => a + b, 0) / vals.length;
                return clamp(Math.round((avg / 5) * 100), 0, 100);
            }

            function inferPriority(initiative) {
                const i = initiative || {};
                const progress = clamp(Number(i.progress || i.prototype?.progress || 0), 0, 100);
                let urgency = (100 - progress) * 0.58 + riskPct(i) * 0.32;
                if (String(i.stage || "").includes("Ø§Ù„ØªÙ‚ÙŠÙŠÙ…")) urgency += 8;
                if (String(i.stage || "").includes("Ø§Ù„Ù†Ù…ÙˆØ°Ø¬")) urgency += 12;
                if (String(i.status || "").includes("Ù…Ø¹ØªÙ…Ø¯") || String(i.stage || "").includes("Ø§Ù„ØªØ·Ø¨ÙŠÙ‚")) urgency -= 26;
                if (urgency >= 70) return "Ø­Ø±Ø¬Ø©";
                if (urgency >= 54) return "Ø¹Ø§Ù„ÙŠØ©";
                if (urgency >= 36) return "Ù…ØªÙˆØ³Ø·Ø©";
                return "Ù…Ù†Ø®ÙØ¶Ø©";
            }

            function normalizeInitiatives() {
                IS.state.initiatives = IS.state.initiatives || [];
                IS.state.initiatives.forEach((i) => {
                    i.progress = clamp(Number(i.progress || i.prototype?.progress || 0), 0, 100);
                    i.status = i.status || "Ù…Ø³ÙˆØ¯Ø©";
                    i.stage = i.stage || "Ø§Ù„ÙÙƒØ±Ø©";
                    i.updatedAt = i.updatedAt || nowISO();
                    i.priority = inferPriority(i);
                    i.tasks = Array.isArray(i.tasks) ? i.tasks : [];
                });
            }

            function readinessScore() {
                const inis = IS.state.initiatives || [];
                const total = inis.length || 1;
                const proto = inis.filter((x) => x.prototype).length;
                const approved = inis.filter((x) =>
                    (x.status || "").includes("Ù…Ø¹ØªÙ…Ø¯") || x.stage === "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯" || x.stage === "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
                ).length;

                let score = 20;
                score += Math.min(30, total * 6);
                score += Math.min(30, proto * 12);
                score += Math.min(20, approved * 10);
                return clamp(score, 0, 100);
            }

            function stageIndex(stage) {
                const idx = JOURNEY.findIndex((j) => j.stages.includes(stage));
                return idx >= 0 ? idx : 0;
            }

            function getFocusedInitiative() {
                const inis = IS.state.initiatives || [];
                if (!inis.length) return null;
                if (ui.focusedId) {
                    const hit = inis.find((x) => x.id === ui.focusedId);
                    if (hit) return hit;
                }
                const sorted = [...inis].sort((a, b) => {
                    const pa = priorityRank[a.priority] || 0;
                    const pb = priorityRank[b.priority] || 0;
                    if (pb !== pa) return pb - pa;
                    return Number(b.progress || 0) - Number(a.progress || 0);
                });
                return sorted[0] || null;
            }

            function setFocusedInitiative(id, withAudit = false) {
                ui.focusedId = id || null;
                IS.setSelectedInitiative(ui.focusedId || "");
                if (withAudit && id) {
                    IS.audit("ØªØ±ÙƒÙŠØ² Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ¸Ù", id);
                }
            }

            function setRing(id, val, labelId) {
                const pct = clamp(Number(val || 0), 0, 100);
                const node = $(id);
                if (!node) return;
                node.style.setProperty("--p", pct);
                $(labelId).textContent = `${pct}%`;
            }

            function taskInRange(task, range) {
                const due = parseDate(task?.due);
                if (!due) return true;
                const now = new Date();
                const diffDays = Math.floor((due - now) / (1000 * 60 * 60 * 24));
                if (range === "today") return diffDays <= 0;
                if (range === "week") return diffDays <= 7;
                return diffDays <= 30;
            }

            function renderProfile() {
                const me = IS.state.me || {};
                const inis = IS.state.initiatives || [];
                const tasks = allTasks(inis);

                $("#pfName").textContent = me.name || "Ù…ÙˆØ¸Ù Ù…Ø¨ØªÙƒØ±";
                $("#pfRole").textContent = "Ù…ÙˆØ¸Ù Ù…Ø¨ØªÙƒØ± â€¢ Innovation Contributor";
                $("#pfOrg").textContent = (IS.state.org && IS.state.org.nameAr) || "â€”";
                $("#pfDept").textContent = me.dept || "â€”";
                $("#pfLevel").textContent = me.level || "Pioneer";
                $("#pfAvatar").textContent = initials(me.name);
                $("#pfPoints").textContent = fmt(me.points || 0);

                const accepted = !!(IS.state.policies && IS.state.policies.accepted);
                const ndaBox = $("#ndaBox");
                const btn = $("#btnAccept");
                if (accepted) {
                    ndaBox.classList.remove("is-off");
                    ndaBox.textContent = "ØªÙ… Ù‚Ø¨ÙˆÙ„ ØªØ¹Ù‡Ø¯ Ø§Ù„Ø³Ø±ÙŠØ© âœ…";
                    btn.disabled = true;
                    btn.textContent = "ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„";
                } else {
                    ndaBox.classList.add("is-off");
                    ndaBox.textContent = "Ù„Ù… ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„ ØªØ¹Ù‡Ø¯ Ø§Ù„Ø³Ø±ÙŠØ© Ø¨Ø¹Ø¯";
                    btn.disabled = false;
                    btn.textContent = "Ù‚Ø¨ÙˆÙ„ ØªØ¹Ù‡Ø¯ Ø§Ù„Ø³Ø±ÙŠØ© (NDA)";
                }

                const r = readinessScore();
                $("#rdPct").textContent = `${fmt(r)}%`;
                $("#rdBar").style.width = `${r}%`;
                $("#bannerState").textContent =
                    r >= 80 ? "ğŸ Ø¬Ø§Ù‡Ø²ÙŠØ© Ø¹Ø§Ù„ÙŠØ©" :
                        r >= 55 ? "âš¡ Ø¬Ø§Ù‡Ø²ÙŠØ© Ù…ØªÙˆØ³Ø·Ø©" :
                            "ğŸ§¯ Ø¬Ø§Ù‡Ø²ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø© â€” Ø§Ø¨Ø¯Ø£ Prototype";

                $("#mTotal").textContent = fmt(inis.length);
                $("#mProto").textContent = fmt(inis.filter((x) => x.prototype).length);
                $("#mApproved").textContent = fmt(inis.filter((x) => x.stage === "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯" || x.stage === "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" || (x.status || "").includes("Ù…Ø¹ØªÙ…Ø¯")).length);

                $("#sMy").textContent = fmt(inis.length);
                $("#sTasks").textContent = fmt(tasks.filter((t) => t.col !== "done").length);
                $("#sProto").textContent = fmt(inis.filter((x) => x.prototype).length);
                $("#sPoints").textContent = fmt(me.points || 0);

                const mode = ($("#viewMode").value || "detailed");
                document.body.classList.toggle("dense-mode", mode === "executive");
            }

            function fillFilterOptions() {
                const inis = IS.state.initiatives || [];
                const sf = $("#stageFilter");
                const currentStage = sf.value;
                const stages = IS.state.stages || [];
                sf.innerHTML = `<option value="">ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</option>` + stages.map((s) => `<option value="${esc(s)}">${esc(s)}</option>`).join("");
                if (stages.includes(currentStage)) sf.value = currentStage;

                const statuses = Array.from(new Set(inis.map((i) => String(i.status || "").trim()).filter(Boolean)));
                const stf = $("#statusFilter");
                const currentStatus = stf.value;
                stf.innerHTML = `<option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>` + statuses.map((s) => `<option value="${esc(s)}">${esc(s)}</option>`).join("");
                if (statuses.includes(currentStatus)) stf.value = currentStatus;
            }

            function renderQuickStageChips(filtered) {
                const inis = IS.state.initiatives || [];
                const stageValue = $("#stageFilter").value || "";
                const byStage = new Map();
                (IS.state.stages || []).forEach((s) => byStage.set(s, 0));
                inis.forEach((i) => byStage.set(i.stage, (byStage.get(i.stage) || 0) + 1));

                const node = $("#quickStageChips");
                const allActive = !stageValue ? "is-active" : "";
                const chips = [`<button class="filter-chip ${allActive}" data-chip="">Ø§Ù„ÙƒÙ„ (${fmt(filtered.length)})</button>`];
                for (const [stage, count] of byStage.entries()) {
                    const cls = stageValue === stage ? "is-active" : "";
                    chips.push(`<button class="filter-chip ${cls}" data-chip="${esc(stage)}">${esc(stage)} (${fmt(count)})</button>`);
                }
                node.innerHTML = chips.join("");
                $$("[data-chip]", node).forEach((b) => b.addEventListener("click", () => {
                    $("#stageFilter").value = b.getAttribute("data-chip") || "";
                    renderInitiatives();
                }));
            }

            function getFilteredInitiatives() {
                const inis = IS.state.initiatives || [];
                const q = normalize($("#q").value || "");
                const stage = ($("#stageFilter").value || "").trim();
                const status = ($("#statusFilter").value || "").trim();
                const priority = ($("#priorityFilter").value || "").trim();
                const sortBy = ($("#sortBy").value || $("#globalSort").value || "updated");

                const filtered = inis.filter((i) => {
                    const hay = normalize(`${i.id} ${i.title} ${(i.tags || []).join(" ")} ${i.stage} ${i.status} ${i.priority}`);
                    const okQ = !q || hay.includes(q);
                    const okStage = !stage || i.stage === stage;
                    const okStatus = !status || i.status === status;
                    const okPriority = !priority || i.priority === priority;
                    return okQ && okStage && okStatus && okPriority;
                });

                filtered.sort((a, b) => {
                    if (sortBy === "progress") return Number(b.progress || 0) - Number(a.progress || 0);
                    if (sortBy === "priority") return (priorityRank[b.priority] || 0) - (priorityRank[a.priority] || 0);
                    return new Date(b.updatedAt || 0).getTime() - new Date(a.updatedAt || 0).getTime();
                });

                return filtered;
            }

            function renderInitiatives() {
                fillFilterOptions();
                const inis = IS.state.initiatives || [];
                const filtered = getFilteredInitiatives();
                const focused = getFocusedInitiative();

                $("#iniCount").textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleDateString("ar-SA")}`;
                $("#countPill").textContent = `${fmt(filtered.length)} / ${fmt(inis.length)}`;
                renderQuickStageChips(filtered);

                $("#tb").innerHTML = filtered.map((i) => {
                    const prog = clamp(i.progress || 0, 0, 100);
                    const hasProto = !!i.prototype;
                    const isFocused = focused && focused.id === i.id ? "is-focused" : "";
                    const stageClass =
                        i.stage === "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" || i.stage === "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯" ? "is-good" :
                            i.stage === "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ" || i.stage === "Ø§Ù„ØªØ¬Ø±Ø¨Ø©" ? "is-mid" : "is-low";
                    const priorityClass =
                        i.priority === "Ø­Ø±Ø¬Ø©" ? "is-bad" :
                            i.priority === "Ø¹Ø§Ù„ÙŠØ©" ? "is-mid" :
                                i.priority === "Ù…ØªÙˆØ³Ø·Ø©" ? "is-low" : "is-good";

                    return `
            <tr class="${isFocused}">
              <td><strong>${esc(i.id)}</strong></td>
              <td>${esc(i.title)}</td>
              <td><span class="status-badge ${stageClass}">${esc(i.stage || "â€”")}</span></td>
              <td>${esc(i.status || "â€”")}</td>
              <td><span class="status-badge ${priorityClass}">${esc(i.priority || "â€”")}</span></td>
              <td class="progress-cell">
                <div class="mini-progress"><span style="width:${prog}%"></span></div>
                <small>${fmt(prog)}%</small>
              </td>
              <td>${hasProto ? `<span class="status-badge is-mid">${esc(i.prototype?.status || "Active")}</span>` : `<span class="status-badge is-low">â€”</span>`}</td>
              <td>
                <button class="btn btn-soft" data-focus="${esc(i.id)}">ØªØ±ÙƒÙŠØ²</button>
                <button class="btn btn-ghost" data-open="${esc(i.id)}">Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
                <button class="btn btn-ghost" data-proto="${esc(i.id)}">Ø¨Ø¯Ø¡ Prototype</button>
              </td>
            </tr>
          `;
                }).join("");

                $("#emptyRow").style.display = filtered.length ? "none" : "flex";

                $$("[data-focus]").forEach((b) => b.addEventListener("click", () => {
                    const id = b.getAttribute("data-focus");
                    setFocusedInitiative(id, true);
                    IS.save();
                    IS.toast("ØªÙ… ØªØ­Ø¯ÙŠØ« ØªØ±ÙƒÙŠØ² Ø§Ù„Ù„ÙˆØ­Ø© âœ…", "ok", 1200);
                    renderJourney();
                    renderFocusPanels();
                    renderInitiatives();
                }));

                $$("[data-open]").forEach((b) => b.addEventListener("click", () => {
                    const id = b.getAttribute("data-open");
                    setFocusedInitiative(id, true);
                    IS.save();
                    IS.toast("ØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±.", "ok", 1200);
                    location.href = "../map/index.html";
                }));

                $$("[data-proto]").forEach((b) => b.addEventListener("click", () => {
                    const id = b.getAttribute("data-proto");
                    const ini = inis.find((x) => x.id === id);
                    if (!ini) return;
                    if (!ini.prototype) {
                        ini.prototype = {
                            id: "P-" + Math.floor(3000 + Math.random() * 900),
                            template: "Dashboard",
                            support: "Prototype Support Unit",
                            scope: "Ù†Ø·Ø§Ù‚ Ø£ÙˆÙ„ÙŠ (Mock)",
                            progress: 18,
                            status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",
                            createdAt: nowISO()
                        };
                    }
                    ini.stage = "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ";
                    ini.status = "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±";
                    ini.progress = Math.max(ini.progress || 0, 28);
                    ini.updatedAt = nowISO();
                    ini.priority = inferPriority(ini);
                    setFocusedInitiative(id, false);

                    IS.audit("Ø¨Ø¯Ø¡ Prototype", id);
                    IS.save();
                    IS.toast("ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ âœ…", "ok");
                    refreshAll();
                }));
            }

            function renderPrototype() {
                const inis = IS.state.initiatives || [];
                const proto = inis.filter((i) => i.prototype);
                const focused = getFocusedInitiative();

                const list = $("#protoList");
                list.innerHTML = proto.length ? proto.map((i) => {
                    const p = i.prototype || {};
                    const pr = clamp(p.progress || 0, 0, 100);
                    const focusedTag = focused && focused.id === i.id ? `<span class="status-badge is-good">Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…Ø±ÙƒØ²Ø©</span>` : "";
                    return `
            <li class="stage-item">
              <div class="stage-item-head">
                <strong>${esc(i.title)}</strong>
                <span class="status-badge is-mid">${esc(p.template || "Prototype")}</span>
              </div>
              <div class="stage-item-head">
                <span>Ø§Ù„Ø¯Ø¹Ù…: <strong>${esc(p.support || "â€”")}</strong></span>
                <span>Ø§Ù„Ø­Ø§Ù„Ø©: <strong>${esc(p.status || "â€”")}</strong></span>
              </div>
              <div class="stage-track"><span style="width:${pr}%"></span></div>
              <div class="stage-item-head">
                <span>Ù†Ø·Ø§Ù‚: <strong>${esc(p.scope || "â€”")}</strong></span>
                <span>${fmt(pr)}%</span>
              </div>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                ${focusedTag}
                <button class="btn btn-soft" data-bump="${esc(i.id)}">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù… +10%</button>
                <button class="btn btn-ghost" data-report="${esc(i.id)}">ØªÙ‚Ø±ÙŠØ± Ø¬Ø§Ù‡Ø²ÙŠØ©</button>
              </div>
            </li>
          `;
                }).join("") : `<li class="empty-line">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Prototype Ù†Ø´Ø· â€” Ø§Ø¨Ø¯Ø£ Ù…Ù† (Ù…Ø¨Ø§Ø¯Ø±Ø§ØªÙŠ â†’ Ø¨Ø¯Ø¡ Prototype).</li>`;

                $$("[data-bump]").forEach((b) => b.addEventListener("click", () => {
                    const id = b.getAttribute("data-bump");
                    const ini = inis.find((x) => x.id === id);
                    if (!ini || !ini.prototype) return;
                    ini.prototype.progress = clamp((ini.prototype.progress || 0) + 10, 0, 100);
                    ini.progress = Math.max(ini.progress || 0, ini.prototype.progress);
                    ini.priority = inferPriority(ini);
                    ini.updatedAt = nowISO();
                    setFocusedInitiative(id, false);
                    IS.audit("ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø¯Ù… Prototype", `${id} â€¢ +10%`);
                    IS.save();
                    IS.toast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù… âœ…", "ok");
                    refreshAll();
                }));

                $$("[data-report]").forEach((b) => b.addEventListener("click", () => {
                    const id = b.getAttribute("data-report");
                    IS.audit("ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø¬Ø§Ù‡Ø²ÙŠØ© Prototype", id);
                    IS.save();
                    IS.toast("ØªÙ… ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø¬Ø§Ù‡Ø²ÙŠØ© Ø£ÙˆÙ„ÙŠ (Mock).", "ok", 1800);
                }));
            }

            function renderTasks() {
                const inis = IS.state.initiatives || [];
                const tasks = allTasks(inis);
                const open = tasks.filter((t) => t.col !== "done").slice(0, 6);
                $("#taskList").innerHTML = open.length ? open.map((t) => `
          <li>
            <strong>${esc(t.title)}</strong> â€” <span style="color:#4e6883;">${esc(t.owner || "â€”")}</span>
            <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
              <span class="status-badge is-low">${esc(t.ini)}</span>
              <span class="status-badge ${t.col === "doing" ? "is-mid" : "is-low"}">${t.col === "doing" ? "Ø¬Ø§Ø±ÙŠ" : "Ù‚ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡"}</span>
              <span class="status-badge is-low">${esc(t.due || "â€”")}</span>
            </div>
          </li>
        `).join("") : `<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ÙØªÙˆØ­Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>`;
            }

            function renderJourney() {
                const inis = IS.state.initiatives || [];
                const focused = getFocusedInitiative();
                const fIdx = focused ? stageIndex(focused.stage) : 0;
                $("#employeeJourney").innerHTML = JOURNEY.map((step, idx) => {
                    const count = inis.filter((i) => step.stages.includes(i.stage)).length;
                    const cls = `${idx < fIdx ? "is-done" : ""} ${idx === fIdx ? "is-active" : ""}`.trim();
                    return `
            <article class="journey-step ${cls}">
              <small>Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${idx + 1}</small>
              <strong>${step.label}</strong>
              <span class="status-badge is-low">${fmt(count)} Ù…Ø¨Ø§Ø¯Ø±Ø©</span>
            </article>
          `;
                }).join("");

                if (!focused) {
                    $("#journeyHint").textContent = "Ø§Ø®ØªØ± Ù…Ø¨Ø§Ø¯Ø±Ø© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©.";
                    return;
                }
                $("#journeyHint").textContent = `Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²Ø©: ${focused.id} â€¢ ${focused.stage}`;
            }

            function renderFocusPanels() {
                const inis = IS.state.initiatives || [];
                const focused = getFocusedInitiative();
                const all = allTasks(inis);
                const focusTasksAll = focused ? all.filter((t) => t.ini === focused.id) : all;
                const openTasks = focusTasksAll.filter((t) => t.col !== "done");
                const doneTasks = focusTasksAll.filter((t) => t.col === "done");
                const rangeTasks = openTasks.filter((t) => taskInRange(t, ui.focusRange)).slice(0, 5);

                $("#focusTitle").textContent = focused ? `${focused.id} â€¢ ${focused.priority}` : "Ø¨Ø¯ÙˆÙ† ØªØ±ÙƒÙŠØ²";
                $("#focusTasks").innerHTML = rangeTasks.length ? rangeTasks.map((t) => `
          <li>
            <strong>${esc(t.title)}</strong>
            <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
              <span class="status-badge is-low">${esc(t.ini)}</span>
              <span class="status-badge ${t.col === "doing" ? "is-mid" : "is-low"}">${t.col === "doing" ? "Ø¬Ø§Ø±ÙŠ" : "Ù‚ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡"}</span>
              <span class="status-badge is-low">${esc(t.due || "â€”")}</span>
            </div>
          </li>
        `).join("") : `<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¶Ù…Ù† Ù†Ø·Ø§Ù‚ ${ui.focusRange}.</li>`;

                const initiativePct = focused ? clamp(Number(focused.progress || 0), 0, 100) : 0;
                const readinessPct = readinessScore();
                const taskClosurePct = (openTasks.length + doneTasks.length)
                    ? Math.round((doneTasks.length / (openTasks.length + doneTasks.length)) * 100)
                    : 0;
                setRing("#ringInitiative", initiativePct, "#ringInitiativeVal");
                setRing("#ringReadiness", readinessPct, "#ringReadinessVal");
                setRing("#ringTasks", taskClosurePct, "#ringTasksVal");

                $("#focusMetrics").innerHTML = focused ? `
          <li><strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> ${esc(focused.stage || "â€”")}</li>
          <li><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${esc(focused.status || "â€”")}</li>
          <li><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> ${new Date(focused.updatedAt || nowISO()).toLocaleDateString("ar-SA")}</li>
        ` : `<li>Ø§Ø®ØªØ± Ù…Ø¨Ø§Ø¯Ø±Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©.</li>`;

                const alerts = [];
                const ndaAccepted = !!(IS.state.policies && IS.state.policies.accepted);
                if (!ndaAccepted) alerts.push("ØªØ¹Ù‡Ø¯ Ø§Ù„Ø³Ø±ÙŠØ© ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„ Ø¨Ø¹Ø¯Ø› Ø¨Ø¹Ø¶ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø³ØªØ¨Ù‚Ù‰ Ù…Ø­Ø¯ÙˆØ¯Ø©.");
                const highRisk = inis.filter((i) => i.priority === "Ø­Ø±Ø¬Ø©" || i.priority === "Ø¹Ø§Ù„ÙŠØ©");
                if (highRisk.length) alerts.push(`Ù„Ø¯ÙŠÙƒ ${fmt(highRisk.length)} Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø¹Ø§Ù„ÙŠØ©/Ø­Ø±Ø¬Ø© ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© Ù‚Ø±ÙŠØ¨Ø©.`);
                const overdue = openTasks.filter((t) => {
                    const due = parseDate(t.due);
                    return due && due < new Date();
                });
                if (overdue.length) alerts.push(`ÙŠÙˆØ¬Ø¯ ${fmt(overdue.length)} Ù…Ù‡Ø§Ù… Ù…ØªØ£Ø®Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²Ø©.`);
                if (focused && !focused.prototype && stageIndex(focused.stage) >= 1) {
                    alerts.push("Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²Ø© ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ù…ØªÙ‚Ø¯Ù…Ø© Ø¨Ø¯ÙˆÙ† Prototype Ù†Ø´Ø·.");
                }
                if (!alerts.length) alerts.push("Ø§Ù„ÙˆØ¶Ø¹ Ù…Ø³ØªÙ‚Ø± Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø±Ø¬Ø©.");

                $("#focusAlerts").innerHTML = alerts.map((a) => `<li>${esc(a)}</li>`).join("");
            }

            function renderAudit() {
                const audit = IS.state.audit || [];
                $("#audit").innerHTML = audit.slice(0, 18).map((a) => `
          <li class="timeline-item">
            <h4>${esc(a.title || "Ø­Ø¯Ø«")}</h4>
            <p>${esc(a.meta || "")}</p>
            <div class="time">${(a.at || "").slice(0, 19).replace("T", " â€¢ ")}</div>
          </li>
        `).join("");
            }

            function refreshAll() {
                renderProfile();
                renderInitiatives();
                renderPrototype();
                renderTasks();
                renderJourney();
                renderFocusPanels();
                renderAudit();
            }

            function wireTopActions() {
                $("#btnNew").addEventListener("click", () => {
                    IS.toast("Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ØªØªÙ… Ù…Ù† Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±.", "ok", 1700);
                    location.href = "../map/index.html";
                });
                $("#btnMap").addEventListener("click", () => location.href = "../map/index.html");
                $("#btnApiSettings").addEventListener("click", openApiModal);
            }

            function wireControls() {
                ["q", "stageFilter", "statusFilter", "priorityFilter", "sortBy"].forEach((id) => {
                    document.getElementById(id).addEventListener(id === "q" ? "input" : "change", renderInitiatives);
                });

                $("#globalSort").addEventListener("change", (e) => {
                    $("#sortBy").value = e.target.value;
                    renderInitiatives();
                });

                $("#viewMode").addEventListener("change", renderProfile);

                $$("[data-focus-range]").forEach((b) => b.addEventListener("click", () => {
                    ui.focusRange = b.getAttribute("data-focus-range") || "today";
                    $$("[data-focus-range]").forEach((x) => x.classList.remove("is-active"));
                    b.classList.add("is-active");
                    renderFocusPanels();
                }));

                $("#btnFocusRefresh").addEventListener("click", async () => {
                    await syncInitiativesFromApi({ silent: true });
                    normalizeInitiatives();
                    IS.audit("ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ¸Ù", ui.focusRange);
                    IS.save();
                    refreshAll();
                    IS.toast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª âœ…", "ok", 1200);
                });

                $("#btnApiSave").addEventListener("click", async () => {
                    const nextBase = setApiBase($("#apiBaseInput").value);
                    if (!nextBase) {
                        $("#apiStateHint").textContent = "Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† API ØµØ­ÙŠØ­ Ø£ÙˆÙ„Ø§Ù‹.";
                        return;
                    }
                    $("#apiStateHint").textContent = "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...";
                    const result = await syncInitiativesFromApi({ silent: true });
                    if (result.loaded) {
                        $("#apiStateHint").textContent = `ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ (${fmt(result.count)} Ù…Ø¨Ø§Ø¯Ø±Ø©).`;
                        refreshAll();
                    } else {
                        $("#apiStateHint").textContent = "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠÙ‹Ø§.";
                    }
                });

                $("#btnApiTest").addEventListener("click", async () => {
                    $("#apiStateHint").textContent = "Ø¬Ø§Ø±Ù Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...";
                    const result = await syncInitiativesFromApi({ silent: true });
                    if (result.loaded) {
                        $("#apiStateHint").textContent = `Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ (${fmt(result.count)} Ù…Ø¨Ø§Ø¯Ø±Ø©).`;
                        refreshAll();
                    } else {
                        $("#apiStateHint").textContent = "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€backend.";
                    }
                });
            }

            async function init() {
                await syncInitiativesFromApi({ silent: true });
                normalizeInitiatives();
                wireTopActions();
                wireControls();
                IS.audit("ÙØªØ­ Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù", "employee");
                IS.save();
                if (!ui.focusedId) {
                    const first = getFocusedInitiative();
                    if (first) setFocusedInitiative(first.id, false);
                }
                refreshAll();
            }

            document.addEventListener("DOMContentLoaded", () => {
                init().catch(() => {
                    normalizeInitiatives();
                    wireTopActions();
                    wireControls();
                    refreshAll();
                });
            });
        })();
    </script>

</body>

</html>
