<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <title>Ø¯Ø±Ø¹ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± | Ù…Ø±ÙƒØ² Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/app.css" />
    <style>
        .prototype-controls {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .prototype-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
        }

        .prototype-card {
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, .12);
            background: rgba(255, 255, 255, .03);
            box-shadow: var(--shadow2);
            padding: 12px;
            display: grid;
            gap: 8px;
        }

        .prototype-head {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            align-items: flex-start;
        }

        .prototype-head h4 {
            margin: 0;
            font-size: 15px;
        }

        .prototype-meta {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .chip {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, .14);
            background: rgba(255, 255, 255, .05);
            font-size: 11px;
            font-weight: 800;
            color: rgba(243, 246, 255, .88);
        }

        .prototype-summary {
            margin: 0;
            color: var(--muted);
            line-height: 1.8;
            font-size: 13px;
        }

        .prototype-kpis {
            margin: 0;
            padding-right: 18px;
            display: grid;
            gap: 5px;
            font-size: 12px;
            color: var(--muted);
        }

        .proto-progress {
            display: grid;
            gap: 4px;
        }

        .proto-progress-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--muted2);
            font-weight: 800;
        }

        .proto-track {
            height: 8px;
            border-radius: 999px;
            overflow: hidden;
            background: rgba(255, 255, 255, .09);
        }

        .proto-track span {
            display: block;
            height: 100%;
            background: linear-gradient(90deg, rgba(78, 163, 255, .88), rgba(66, 246, 231, .9));
            width: 0;
            transition: width .24s ease;
        }

        .prototype-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .prototype-actions .btn {
            padding: 6px 10px;
            font-size: 12px;
        }

        .backlog-table th,
        .backlog-table td {
            font-size: 12px;
        }

        .weeks-grid {
            display: grid;
            grid-template-columns: repeat(6, minmax(0, 1fr));
            gap: 8px;
        }

        .week-item {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            padding: 8px;
            min-height: 120px;
        }

        .week-item strong {
            display: block;
            font-size: 12px;
            margin-bottom: 6px;
            color: rgba(243, 246, 255, .92);
        }

        .week-item ul {
            margin: 0;
            padding-right: 14px;
            display: grid;
            gap: 5px;
            color: var(--muted);
            font-size: 12px;
        }

        .brief-box {
            border: 1px solid rgba(255, 255, 255, .14);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            padding: 10px;
            display: grid;
            gap: 8px;
        }

        .brief-box ul {
            margin: 0;
            padding-right: 18px;
            display: grid;
            gap: 5px;
            color: var(--muted);
            font-size: 13px;
        }

        .empty-box {
            border: 1px dashed rgba(255, 255, 255, .2);
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            color: var(--muted2);
            font-size: 13px;
            font-weight: 800;
        }

        @media (max-width: 1160px) {
            .prototype-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .prototype-controls {
                grid-template-columns: 1fr 1fr;
            }

            .weeks-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        @media (max-width: 760px) {
            .prototype-grid,
            .prototype-controls,
            .weeks-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body class="career-body">

    <div class="platform-bg">
        <div class="mesh mesh-1"></div>
        <div class="mesh mesh-2"></div>
        <div class="mesh mesh-3"></div>
    </div>

    <div class="platform-shell">

        <header class="platform-topbar reveal">
            <div class="topbar-brand">
                <div class="brand-mark">IS</div>
                <div>
                    <h1 class="topbar-title">Ù…Ø±ÙƒØ² Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</h1>
                    <p class="topbar-sub">Prototype Factory â€¢ MVP Plans â€¢ KPIs â€¢ Go-to-Map</p>
                </div>
            </div>

            <nav class="nav">
                <a href="../../index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="../map/index.html">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±</a>
                <a href="../prototype/index.html" class="active">Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</a>
                <a href="../employee/index.html">Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</a>
                <a href="../judging/index.html">Ø§Ù„ØªØ­ÙƒÙŠÙ…</a>
                <a href="../command/index.html">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</a>
                <a href="../policies/index.html">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</a>
                <a href="../report/index.html">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ</a>
            </nav>

            <div class="topbar-actions">
                <span class="live-pill">ğŸ§ª Prototype Factory</span>
                <button class="btn btn-soft" id="btnCreateAll">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„</button>
                <button class="btn btn-soft" id="btnGoMap">Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
                <button class="btn btn-primary" id="btnPrint">Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>
        </header>

        <section class="workspace-banner reveal">
            <div>
                <span class="eyebrow">Execution-Ready</span>
                <h2 class="hero-title">3 Ù†Ù…Ø§Ø°Ø¬ Ø£ÙˆÙ„ÙŠØ© Ø°Ø§Øª Ø£Ø«Ø± Ø¹Ø§Ù„ÙŠ ÙˆØ¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¨Ø¯Ø¡ ÙÙˆØ±Ù‹Ø§</h2>
                <p class="hero-sub">
                    Ù‡Ø°Ù‡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ø¨Ù†ÙŠØ© Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙŠ Ø¨ÙŠØ¦Ø© ØµØ­ÙŠØ©: ØªØ¹Ø±ÙŠÙ Ù…Ø´ÙƒÙ„Ø© ÙˆØ§Ø¶Ø­ØŒ MVP Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø®Ù„Ø§Ù„ 6 Ø£Ø³Ø§Ø¨ÙŠØ¹ØŒ
                    Ù…Ø¤Ø´Ø±Ø§Øª Ù‚ÙŠØ§Ø³ Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ ÙˆØ²Ø± ÙˆØ§Ø­Ø¯ Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¯Ø§Ø®Ù„ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±.
                </p>
            </div>
            <div class="quality-pill">Ù…Ù† Ø§Ù„ÙÙƒØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªÙ†ÙÙŠØ° Ø®Ù„Ø§Ù„ 6 Ø£Ø³Ø§Ø¨ÙŠØ¹</div>
        </section>

        <section class="stats-grid reveal">
            <div class="stat-card stat-a">
                <p>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
                <h3 id="kTotal">â€”</h3>
                <small>Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</small>
            </div>
            <div class="stat-card stat-b">
                <p>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©</p>
                <h3 id="kReadiness">â€”</h3>
                <small>AI Readiness</small>
            </div>
            <div class="stat-card stat-c">
                <p>Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ø§Ù„Ø³Ù†ÙˆÙŠ</p>
                <h3 id="kEconomic">â€”</h3>
                <small>Net Annual (SAR)</small>
            </div>
            <div class="stat-card stat-d">
                <p>ÙØ±Øµ Ø³Ø±ÙŠØ¹Ø© (Quick Wins)</p>
                <h3 id="kQuick">â€”</h3>
                <small>Ø¬Ø§Ù‡Ø²ÙŠØ© Ù…Ø±ØªÙØ¹Ø© + Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø³Ø±ÙŠØ¹</small>
            </div>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>ØªØµÙÙŠØ© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</h3>
                <span class="panel-note">Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù„ / Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ / Ø§Ù„Ø£Ø«Ø±</span>
            </div>
            <div class="prototype-controls">
                <input id="q" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø£Ùˆ KPI..." />
                <select id="domainFilter">
                    <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</option>
                </select>
                <select id="complexityFilter">
                    <option value="">ÙƒÙ„ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªØ¹Ù‚ÙŠØ¯</option>
                    <option value="Ù…Ù†Ø®ÙØ¶">Ù…Ù†Ø®ÙØ¶</option>
                    <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ù…Ø±ØªÙØ¹">Ù…Ø±ØªÙØ¹</option>
                </select>
                <select id="impactFilter">
                    <option value="">ÙƒÙ„ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø£Ø«Ø±</option>
                    <option value="Ø¹Ø§Ù„Ù">Ø¹Ø§Ù„Ù</option>
                    <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
                </select>
            </div>
            <div class="table-tools" style="margin-top:10px;">
                <span class="table-count" id="resultCount">â€”</span>
                <button class="btn btn-ghost" id="btnReset">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
            </div>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</h3>
                <span class="panel-note">MVP + KPIs + Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°</span>
            </div>
            <div class="prototype-grid" id="prototypeGrid"></div>
            <div class="empty-box" id="emptyState" style="display:none; margin-top:10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù…Ø§Ø°Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</div>
        </section>

        <section class="insights-grid reveal">
            <section class="panel">
                <div class="panel-head">
                    <h3>MVP Backlog</h3>
                    <span class="panel-note">Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                </div>
                <div class="table-wrap">
                    <table class="proto-table backlog-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</th>
                                <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                                <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                                <th>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
                            </tr>
                        </thead>
                        <tbody id="backlogBody"></tbody>
                    </table>
                </div>
            </section>

            <section class="panel">
                <div class="panel-head">
                    <h3>Prototype Brief</h3>
                    <span class="panel-note">Ù…Ù„Ù ØªÙ†ÙÙŠØ°ÙŠ Ø³Ø±ÙŠØ¹</span>
                </div>
                <div class="brief-box">
                    <ul id="briefList"></ul>
                    <button class="btn btn-soft" id="btnGenerateBrief">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ</button>
                </div>
            </section>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>Ø®Ø·Ø© ØªÙ†ÙÙŠØ° 6 Ø£Ø³Ø§Ø¨ÙŠØ¹</h3>
                <span class="panel-note">Cross-Prototype Sprint Plan</span>
            </div>
            <div class="weeks-grid" id="weeksGrid"></div>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>Ø³Ø¬Ù„ Ù†Ø´Ø§Ø· Ù…Ø±ÙƒØ² Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</h3>
                <span class="panel-note">Ø¢Ø®Ø± 12 Ø­Ø¯Ø«</span>
            </div>
            <ul class="timeline" id="audit"></ul>
        </section>

    </div>

    <div class="modal hidden" id="modalBlueprint">
        <div class="modal-backdrop" data-close-modal></div>
        <div class="modal-card" style="max-width:760px; width:min(760px, calc(100vw - 24px));">
            <div class="modal-head">
                <h3 id="mTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</h3>
                <button class="modal-close" data-close-modal>âœ•</button>
            </div>

            <div class="form-grid">
                <label>Ø§Ù„Ø¬Ù‡Ø©</label>
                <input id="mOrg" placeholder="Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø©" />
                <label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                <select id="mPriority">
                    <option value="Ø­Ø±Ø¬Ø©">Ø­Ø±Ø¬Ø©</option>
                    <option value="Ø¹Ø§Ù„ÙŠØ©">Ø¹Ø§Ù„ÙŠØ©</option>
                    <option value="Ù…ØªÙˆØ³Ø·Ø©">Ù…ØªÙˆØ³Ø·Ø©</option>
                    <option value="Ù…Ù†Ø®ÙØ¶Ø©">Ù…Ù†Ø®ÙØ¶Ø©</option>
                </select>
                <label>Ù…Ø§Ù„Ùƒ Ø§Ù„ØªÙ†ÙÙŠØ°</label>
                <input id="mOwner" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ" />
            </div>

            <div class="panel" style="margin-top:10px;">
                <div class="panel-head">
                    <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</h3>
                    <span class="panel-note" id="mReadiness">â€”</span>
                </div>
                <ul class="insight-list" id="mSummary"></ul>
            </div>

            <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; margin-top:12px;">
                <button class="btn btn-soft" id="mAdd">Ø¥Ø¶Ø§ÙØ© ÙƒÙ…Ø¨Ø§Ø¯Ø±Ø©</button>
                <button class="btn btn-primary" id="mAddOpen">Ø¥Ø¶Ø§ÙØ© ÙˆÙØªØ­ Ø¨Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
            </div>
        </div>
    </div>

    <script src="../../assets/js/app.js"></script>
    <script>
        (() => {
            "use strict";
            const $ = (s, r = document) => r.querySelector(s);
            const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
            const IS = window.IS;

            const BLUEPRINTS = [
                {
                    id: "BP-ER-TRIAGE",
                    title: "ÙØ±Ø² Ø°ÙƒÙŠ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦",
                    domain: "Ø³Ø±ÙŠØ±ÙŠ",
                    complexity: "Ù…ØªÙˆØ³Ø·",
                    impactLevel: "Ø¹Ø§Ù„Ù",
                    summary: "Ù†Ù…ÙˆØ°Ø¬ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØ±ØªÙŠØ¨ Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙÙˆØ± ÙˆØµÙˆÙ„Ù‡Ø§ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø²Ù…Ù† Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©.",
                    problem: "ØªØ£Ø®Ø± ÙØ±Ø² Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø§Ø±ØªÙØ§Ø¹ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙˆØªÙØ§ÙˆØª Ø¬ÙˆØ¯Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©.",
                    beneficiary: "Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙˆØ·Ø§Ù‚Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆÙ‚Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„.",
                    evidence: "ØªØ­Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± + Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·ÙˆØ§Ù‚Ù… + Ù…Ø¹Ø¯Ù„ ØªØ­ÙˆÙŠÙ„Ø§Øª Ø¹Ø§Ø¬Ù„Ø© Ù…ØªØ£Ø®Ø±Ø©.",
                    tag: "Ø³Ø±ÙŠØ±ÙŠ",
                    defaultPriority: "Ø­Ø±Ø¬Ø©",
                    prototypeTemplate: "Decision Assistant",
                    supportUnit: "ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ©",
                    prototypeScope: "Ø´Ø§Ø´Ø© ÙØ±Ø² + Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„ÙˆÙŠØ© + Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ù‚Ø¨Ø©",
                    readinessBase: 74,
                    dataSources: ["Ø³Ø¬Ù„ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦", "Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ±Ø²", "ÙˆÙ‚Øª Ø§Ù„ÙˆØµÙˆÙ„", "Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©"],
                    kpis: [
                        "Ø®ÙØ¶ Ù…ØªÙˆØ³Ø· Ø²Ù…Ù† Ø§Ù„ÙØ±Ø² Ø¨Ù†Ø³Ø¨Ø© 30%",
                        "Ø®ÙØ¶ Ø²Ù…Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø© Ø¨Ù†Ø³Ø¨Ø© 25%",
                        "Ø±ÙØ¹ Ø¯Ù‚Ø© Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø¥Ù„Ù‰ +90%"
                    ],
                    mvpFeatures: [
                        "Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©",
                        "Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„ÙˆÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©",
                        "Ù„ÙˆØ­Ø© ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©",
                        "ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆØ±Ø¯ÙŠØ©"
                    ],
                    milestones: [
                        { week: 1, task: "ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ¹Ø±ÙŠÙ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙØ±Ø²" },
                        { week: 2, task: "Ø¨Ù†Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ÙˆÙ„ÙŠ" },
                        { week: 3, task: "ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦" },
                        { week: 4, task: "ØªØ¬Ø±Ø¨Ø© Ø¯Ø§Ø®Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø¹ÙŠÙ†Ø© Ø¨ÙŠØ§Ù†Ø§Øª" },
                        { week: 5, task: "ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª" },
                        { week: 6, task: "Pilot Ù„Ù…Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ¥ØµØ¯Ø§Ø± ØªÙ‚Ø±ÙŠØ±" }
                    ],
                    impact: {
                        costSaving: 360000,
                        timeSavingPct: 31,
                        implementationCost: 170000,
                        operatingCost: 42000,
                        horizonYears: 3,
                        confidencePct: 78
                    },
                    riskProfile: {
                        operational: 3,
                        financial: 2,
                        technical: 3,
                        quality: 2,
                        experience: 2,
                        mitigationEffectivenessPct: 36,
                        mitigationPlan: "ØªØ´ØºÙŠÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ ÙÙŠ ÙˆØ±Ø¯ÙŠØ© Ù…Ø­Ø¯Ø¯Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ù…ÙŠÙ….",
                        owner: "Ù…Ø¯ÙŠØ± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦",
                        reviewCycle: "Ø£Ø³Ø¨ÙˆØ¹ÙŠ"
                    }
                },
                {
                    id: "BP-NOSHOW-AI",
                    title: "Ù…ØªÙ†Ø¨Ø¦ Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
                    domain: "ØªØ´ØºÙŠÙ„ÙŠ",
                    complexity: "Ù…Ù†Ø®ÙØ¶",
                    impactLevel: "Ø¹Ø§Ù„Ù",
                    summary: "Ù†Ù…ÙˆØ°Ø¬ ÙŠØªÙ†Ø¨Ø£ Ø¨Ù…Ø±Ø¶Ù‰ Ø¹Ø§Ù„ÙŠÙŠ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆÙŠØ±Ø³Ù„ ØªØ¯Ø®Ù„Ø§Øª Ø§Ø³ØªØ¨Ø§Ù‚ÙŠØ© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø±.",
                    problem: "Ù†Ø³Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ØªØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø¶ÙŠØ§Ø¹ Ø³Ø¹Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª ÙˆØ¥Ø·Ø§Ù„Ø© Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.",
                    beneficiary: "Ø§Ù„Ù…Ø±Ø¶Ù‰ØŒ Ù…Ù†Ø³Ù‚Ùˆ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§ÙƒØ².",
                    evidence: "ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± 12 Ø´Ù‡Ø± + Ø¥Ù„ØºØ§Ø¡Ø§Øª Ù…ØªØ£Ø®Ø±Ø© + Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ø¶ØºØ·.",
                    tag: "Ø±Ù‚Ù…Ù†Ø©",
                    defaultPriority: "Ø¹Ø§Ù„ÙŠØ©",
                    prototypeTemplate: "Prediction Dashboard",
                    supportUnit: "Ù…ÙƒØªØ¨ Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ",
                    prototypeScope: "Ø¯Ø±Ø¬Ø© Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ± + Ø­Ù…Ù„Ø§Øª ØªØ°ÙƒÙŠØ± Ø°ÙƒÙŠØ©",
                    readinessBase: 81,
                    dataSources: ["Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯", "Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±", "Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„", "ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª"],
                    kpis: [
                        "Ø®ÙØ¶ no-show Ø¨Ù†Ø³Ø¨Ø© 20%",
                        "Ø±ÙØ¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¨Ù†Ø³Ø¨Ø© 15%",
                        "ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø¨Ù†Ø³Ø¨Ø© 25%"
                    ],
                    mvpFeatures: [
                        "Ø¯Ø±Ø¬Ø© Ù…Ø®Ø§Ø·Ø± Ù„ÙƒÙ„ Ù…ÙˆØ¹Ø¯",
                        "Ù‚Ø§Ø¦Ù…Ø© Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ù„Ù„ØªÙˆØ§ØµÙ„",
                        "Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ ØªØ°ÙƒÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø®Ø§Ø·Ø±",
                        "Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ù…Ù†Ø³Ù‚"
                    ],
                    milestones: [
                        { week: 1, task: "ØªÙ†Ø¸ÙŠÙ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©" },
                        { week: 2, task: "Ø¨Ù†Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø£ÙˆÙ„ÙŠ" },
                        { week: 3, task: "ØªØµÙ…ÙŠÙ… Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±" },
                        { week: 4, task: "ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø¹ÙŠØ§Ø¯ØªÙŠÙ†" },
                        { week: 5, task: "ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ¯Ø®Ù„" },
                        { week: 6, task: "ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªÙˆØ³Ø¹" }
                    ],
                    impact: {
                        costSaving: 290000,
                        timeSavingPct: 22,
                        implementationCost: 95000,
                        operatingCost: 30000,
                        horizonYears: 3,
                        confidencePct: 82
                    },
                    riskProfile: {
                        operational: 2,
                        financial: 2,
                        technical: 2,
                        quality: 2,
                        experience: 2,
                        mitigationEffectivenessPct: 45,
                        mitigationPlan: "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.",
                        owner: "Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ",
                        reviewCycle: "Ø£Ø³Ø¨ÙˆØ¹ÙŠ"
                    }
                },
                {
                    id: "BP-BED-LIVE",
                    title: "Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø±Ø© Ù„Ø­Ø¸ÙŠÙ‹Ø§",
                    domain: "Ø¬ÙˆØ¯Ø©",
                    complexity: "Ù…ØªÙˆØ³Ø·",
                    impactLevel: "Ù…ØªÙˆØ³Ø·",
                    summary: "Ù„ÙˆØ­Ø© Ù„Ø­Ø¸ÙŠØ© Ù„Ø¥Ø´ØºØ§Ù„ Ø§Ù„Ø£Ø³Ø±Ø© ÙˆØ§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© ØªØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ ØªØ³Ø±ÙŠØ¹ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªÙ†ÙˆÙŠÙ….",
                    problem: "ØºÙŠØ§Ø¨ Ø±Ø¤ÙŠØ© Ù„Ø­Ø¸ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© ÙŠØ³Ø¨Ø¨ ØªØ£Ø®ÙŠØ± Ø§Ù„ØªÙ†ÙˆÙŠÙ… ÙˆØªØ°Ø¨Ø°Ø¨ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø³Ø±Ø©.",
                    beneficiary: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ØŒ ÙØ±Ù‚ Ø§Ù„ØªÙ†ÙˆÙŠÙ…ØŒ ÙˆØ§Ù„Ù‚ÙŠØ§Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©.",
                    evidence: "ØªØ£Ø®Ø± ØªØ­ÙˆÙŠÙ„Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© + ÙØ±ÙˆÙ‚Ø§Øª ÙŠÙˆÙ…ÙŠØ© ÙÙŠ Ø§Ù„Ø¥Ø´ØºØ§Ù„ + Ø´ÙƒØ§ÙˆÙ‰ ØªØ£Ø®ÙŠØ±.",
                    tag: "Ø¬ÙˆØ¯Ø©",
                    defaultPriority: "Ø¹Ø§Ù„ÙŠØ©",
                    prototypeTemplate: "Operational Dashboard",
                    supportUnit: "Ù…Ø±ÙƒØ² Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©",
                    prototypeScope: "Ù„ÙˆØ­Ø© Ø¥Ø´ØºØ§Ù„ + ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ø®ØªÙ†Ø§Ù‚ + ØªÙˆÙ‚Ø¹ Ø³Ø¹Ø© 24 Ø³Ø§Ø¹Ø©",
                    readinessBase: 69,
                    dataSources: ["Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†ÙˆÙŠÙ…", "Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª", "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø±ÙˆØ¬", "Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦"],
                    kpis: [
                        "Ø®ÙØ¶ Ø²Ù…Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ†ÙˆÙŠÙ… Ø¨Ù†Ø³Ø¨Ø© 18%",
                        "ØªØ­Ø³ÙŠÙ† Ø¯Ù‚Ø© ØªÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¥Ù„Ù‰ 85%",
                        "ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ù†Ø³Ø¨Ø© 20%"
                    ],
                    mvpFeatures: [
                        "Ø®Ø±ÙŠØ·Ø© Ø¥Ø´ØºØ§Ù„ Ù„Ø­Ø¸ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…",
                        "ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ù‚Ø³Ù… Ù„Ø­Ø§Ù„Ø© Ø§Ø®ØªÙ†Ø§Ù‚",
                        "ØªÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø¹Ø© Ù„Ù„Ù€ 24 Ø³Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©",
                        "ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ Ù„Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©"
                    ],
                    milestones: [
                        { week: 1, task: "ØªØ¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø±Ø© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª" },
                        { week: 2, task: "ØªØ¹Ø±ÙŠÙ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø§Ø®ØªÙ†Ø§Ù‚" },
                        { week: 3, task: "ØªØµÙ…ÙŠÙ… Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„ Ø§Ù„Ù„Ø­Ø¸ÙŠØ©" },
                        { week: 4, task: "Ø¥Ø·Ù„Ø§Ù‚ ØªØ¬Ø±ÙŠØ¨ÙŠ ÙÙŠ Ù‚Ø³Ù…ÙŠÙ†" },
                        { week: 5, task: "ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØªÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø¹Ø©" },
                        { week: 6, task: "ØªÙ‚Ø±ÙŠØ± Ø£Ø«Ø± ÙˆØªØ´ØºÙŠÙ„ Ù…ÙˆØ³Ø¹" }
                    ],
                    impact: {
                        costSaving: 240000,
                        timeSavingPct: 17,
                        implementationCost: 125000,
                        operatingCost: 38000,
                        horizonYears: 3,
                        confidencePct: 75
                    },
                    riskProfile: {
                        operational: 3,
                        financial: 2,
                        technical: 3,
                        quality: 3,
                        experience: 2,
                        mitigationEffectivenessPct: 30,
                        mitigationPlan: "ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø­Ù„ÙŠ ÙˆØ±Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„ØªÙ…Ø±ÙŠØ¶ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨.",
                        owner: "Ù…Ø¯ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ",
                        reviewCycle: "Ø£Ø³Ø¨ÙˆØ¹ÙŠ"
                    }
                }
            ];

            let activeBlueprintId = null;

            const fmt = (n) => new Intl.NumberFormat("ar-SA").format(Number(n || 0));
            const esc = (v) => String(v ?? "")
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/\"/g, "&quot;")
                .replace(/'/g, "&#39;");
            const clamp = (n, a, b) => Math.max(a, Math.min(b, Number(n || 0)));
            const nowISO = () => new Date().toISOString();
            const normalize = (t) => String(t || "").toLowerCase().trim().replace(/\s+/g, " ");

            function calcEconomicImpact(impact) {
                const model = impact || {};
                const saving = Math.max(0, Number(model.costSaving || 0));
                const implementationCost = Math.max(0, Number(model.implementationCost || 0));
                const operatingCost = Math.max(0, Number(model.operatingCost || 0));
                const horizonYears = clamp(Number(model.horizonYears || 3), 1, 5);
                const confidencePct = clamp(Number(model.confidencePct || 75), 10, 100);
                const adjustedSaving = Math.round(saving * (confidencePct / 100));
                const netAnnual = adjustedSaving - operatingCost;
                const netOverHorizon = (netAnnual * horizonYears) - implementationCost;
                const roiPct = implementationCost > 0 ? Math.round((netOverHorizon / implementationCost) * 100) : 0;
                const paybackMonths = netAnnual > 0 ? Math.round((implementationCost / netAnnual) * 12) : null;
                return { netAnnual, roiPct, paybackMonths };
            }

            function calcRiskResidual(profile) {
                const p = profile || {};
                const vals = [
                    clamp(p.operational || 2, 1, 5),
                    clamp(p.financial || 2, 1, 5),
                    clamp(p.technical || 2, 1, 5),
                    clamp(p.quality || 2, 1, 5),
                    clamp(p.experience || 2, 1, 5)
                ];
                const avg = vals.reduce((a, b) => a + b, 0) / vals.length;
                const indexPct = Math.round((avg / 5) * 100);
                const mitigation = clamp(p.mitigationEffectivenessPct || 0, 0, 100);
                return Math.round(indexPct * (1 - (mitigation / 100)));
            }

            function calcReadiness(bp) {
                const dataPct = clamp(bp.dataSources.length * 22, 0, 100);
                const featurePct = clamp(bp.mvpFeatures.length * 24, 0, 100);
                const planPct = clamp(bp.milestones.length * 16, 0, 100);
                const riskSafe = 100 - calcRiskResidual(bp.riskProfile);
                const econ = calcEconomicImpact(bp.impact);
                const econPct = clamp(Math.round((econ.roiPct + 100) / 2), 0, 100);
                const score = Math.round(
                    (bp.readinessBase * 0.28) +
                    (dataPct * 0.16) +
                    (featurePct * 0.16) +
                    (planPct * 0.12) +
                    (riskSafe * 0.14) +
                    (econPct * 0.14)
                );
                return clamp(score, 0, 100);
            }

            function fillFilters() {
                const domains = Array.from(new Set(BLUEPRINTS.map((b) => b.domain)));
                $("#domainFilter").innerHTML = `<option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</option>` + domains.map((d) => `<option>${esc(d)}</option>`).join("");
            }

            function getFilters() {
                return {
                    q: normalize($("#q").value),
                    domain: $("#domainFilter").value || "",
                    complexity: $("#complexityFilter").value || "",
                    impact: $("#impactFilter").value || ""
                };
            }

            function filterBlueprints() {
                const f = getFilters();
                return BLUEPRINTS.filter((b) => {
                    const hay = normalize([
                        b.id,
                        b.title,
                        b.summary,
                        b.problem,
                        b.domain,
                        b.complexity,
                        b.impactLevel,
                        ...(b.kpis || []),
                        ...(b.mvpFeatures || [])
                    ].join(" "));
                    const okQ = !f.q || hay.includes(f.q);
                    const okDomain = !f.domain || b.domain === f.domain;
                    const okComplexity = !f.complexity || b.complexity === f.complexity;
                    const okImpact = !f.impact || b.impactLevel === f.impact;
                    return okQ && okDomain && okComplexity && okImpact;
                });
            }

            function scoreBadgeClass(score) {
                if (score >= 75) return "is-good";
                if (score >= 55) return "is-mid";
                return "is-bad";
            }

            function renderStats(list) {
                const total = list.length;
                const readiness = total ? Math.round(list.reduce((sum, b) => sum + calcReadiness(b), 0) / total) : 0;
                const economic = list.reduce((sum, b) => sum + calcEconomicImpact(b.impact).netAnnual, 0);
                const quick = list.filter((b) => {
                    const r = calcReadiness(b);
                    const p = calcEconomicImpact(b.impact).paybackMonths;
                    return r >= 70 && p != null && p <= 14;
                }).length;

                $("#kTotal").textContent = fmt(total);
                $("#kReadiness").textContent = `${fmt(readiness)}%`;
                $("#kEconomic").textContent = fmt(economic);
                $("#kQuick").textContent = fmt(quick);
            }

            function renderCards(list) {
                $("#resultCount").textContent = `${fmt(list.length)} Ù†Ù…Ø§Ø°Ø¬`;
                $("#emptyState").style.display = list.length ? "none" : "block";

                $("#prototypeGrid").innerHTML = list.map((b) => {
                    const readiness = calcReadiness(b);
                    const econ = calcEconomicImpact(b.impact);
                    const risk = calcRiskResidual(b.riskProfile);
                    return `
                        <article class="prototype-card">
                            <div class="prototype-head">
                                <h4>${esc(b.title)}</h4>
                                <span class="status-badge ${scoreBadgeClass(readiness)}">${fmt(readiness)}%</span>
                            </div>

                            <div class="prototype-meta">
                                <span class="chip">${esc(b.domain)}</span>
                                <span class="chip">ØªØ¹Ù‚ÙŠØ¯: ${esc(b.complexity)}</span>
                                <span class="chip">Ø£Ø«Ø±: ${esc(b.impactLevel)}</span>
                            </div>

                            <p class="prototype-summary">${esc(b.summary)}</p>

                            <div class="proto-progress">
                                <div class="proto-progress-head">
                                    <span>AI Readiness</span>
                                    <strong>${fmt(readiness)}%</strong>
                                </div>
                                <div class="proto-track"><span style="width:${readiness}%"></span></div>
                            </div>

                            <ul class="prototype-kpis">
                                <li>ROI Ù…ØªÙˆÙ‚Ø¹: <strong>${fmt(econ.roiPct)}%</strong></li>
                                <li>Ø§Ù„Ø®Ø·Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <strong>${fmt(risk)}%</strong></li>
                                <li>ØµØ§ÙÙŠ Ø£Ø«Ø± Ø³Ù†ÙˆÙŠ: <strong>${fmt(econ.netAnnual)} SAR</strong></li>
                            </ul>

                            <div class="prototype-actions">
                                <button class="btn btn-soft" data-open="${esc(b.id)}">ØªÙØ§ØµÙŠÙ„</button>
                                <button class="btn btn-primary" data-add="${esc(b.id)}">ØªØ­ÙˆÙŠÙ„ Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©</button>
                            </div>
                        </article>
                    `;
                }).join("");
            }

            function backlogRows(list) {
                const rows = [];
                list.forEach((b) => {
                    (b.mvpFeatures || []).forEach((feature, idx) => {
                        rows.push({
                            blueprint: b.title,
                            feature,
                            priority: idx <= 1 ? "Ø¹Ø§Ù„ÙŠØ©" : "Ù…ØªÙˆØ³Ø·Ø©",
                            week: `W${Math.min(idx + 1, 6)}`
                        });
                    });
                });
                return rows;
            }

            function renderBacklog(list) {
                const rows = backlogRows(list);
                $("#backlogBody").innerHTML = rows.length
                    ? rows.map((r) => `
                        <tr>
                            <td>${esc(r.blueprint)}</td>
                            <td>${esc(r.feature)}</td>
                            <td><span class="status-badge ${r.priority === "Ø¹Ø§Ù„ÙŠØ©" ? "is-mid" : "is-low"}">${esc(r.priority)}</span></td>
                            <td>${esc(r.week)}</td>
                        </tr>
                    `).join("")
                    : `<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Backlog.</td></tr>`;
            }

            function renderBrief(list) {
                const total = list.length;
                const avgReadiness = total ? Math.round(list.reduce((sum, b) => sum + calcReadiness(b), 0) / total) : 0;
                const highImpact = list.filter((b) => b.impactLevel === "Ø¹Ø§Ù„Ù").length;
                const netAnnual = list.reduce((sum, b) => sum + calcEconomicImpact(b.impact).netAnnual, 0);
                const highest = [...list].sort((a, b) => calcReadiness(b) - calcReadiness(a))[0];

                $("#briefList").innerHTML = `
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ: <strong>${fmt(total)}</strong>.</li>
                    <li>Ù…ØªÙˆØ³Ø· Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ØªÙ†ÙÙŠØ°: <strong>${fmt(avgReadiness)}%</strong>.</li>
                    <li>Ù†Ù…Ø§Ø°Ø¬ Ø°Ø§Øª Ø£Ø«Ø± Ø¹Ø§Ù„Ù: <strong>${fmt(highImpact)}</strong>.</li>
                    <li>ØµØ§ÙÙŠ Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: <strong>${fmt(netAnnual)} SAR</strong>.</li>
                    <li>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ù„Ø¨Ø¯Ø¡: <strong>${esc(highest ? highest.title : "â€”")}</strong>.</li>
                `;
            }

            function renderWeeksPlan(list) {
                const byWeek = new Map();
                for (let week = 1; week <= 6; week += 1) byWeek.set(week, []);

                list.forEach((b) => {
                    (b.milestones || []).forEach((m) => {
                        if (byWeek.has(m.week)) {
                            byWeek.get(m.week).push(`${b.title}: ${m.task}`);
                        }
                    });
                });

                $("#weeksGrid").innerHTML = Array.from(byWeek.entries()).map(([w, tasks]) => {
                    const picked = tasks.slice(0, 4);
                    const extra = tasks.length - picked.length;
                    return `
                        <article class="week-item">
                            <strong>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${fmt(w)}</strong>
                            <ul>
                                ${picked.map((t) => `<li>${esc(t)}</li>`).join("")}
                                ${extra > 0 ? `<li>+${fmt(extra)} Ù…Ù‡Ø§Ù… Ø¥Ø¶Ø§ÙÙŠØ©</li>` : ""}
                            </ul>
                        </article>
                    `;
                }).join("");
            }

            function renderAudit() {
                const items = (IS.state.audit || []).slice(0, 12);
                $("#audit").innerHTML = items.map((a) => `
                    <li class="timeline-item">
                        <h4>${esc(a.title || "Ø­Ø¯Ø«")}</h4>
                        <p>${esc(a.meta || "")}</p>
                        <div class="time">${esc((a.at || "").slice(0, 19).replace("T", " â€¢ "))}</div>
                    </li>
                `).join("");
            }

            function getBlueprint(id) {
                return BLUEPRINTS.find((b) => b.id === id) || null;
            }

            function openModal(id) {
                const bp = getBlueprint(id);
                if (!bp) return;
                activeBlueprintId = id;
                const readiness = calcReadiness(bp);
                const econ = calcEconomicImpact(bp.impact);
                const risk = calcRiskResidual(bp.riskProfile);

                $("#mTitle").textContent = `${bp.title} (${bp.id})`;
                $("#mReadiness").textContent = `Ø¬Ø§Ù‡Ø²ÙŠØ© ${fmt(readiness)}%`;
                $("#mOrg").value = IS.state.org?.nameAr || "";
                $("#mPriority").value = bp.defaultPriority || "Ø¹Ø§Ù„ÙŠØ©";
                $("#mOwner").value = bp.riskProfile?.owner || "";
                $("#mSummary").innerHTML = `
                    <li><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> ${esc(bp.problem)}</li>
                    <li><strong>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯:</strong> ${esc(bp.beneficiary)}</li>
                    <li><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> ${esc(bp.evidence)}</li>
                    <li><strong>ROI:</strong> ${fmt(econ.roiPct)}% â€¢ <strong>Payback:</strong> ${econ.paybackMonths == null ? "â€”" : `${fmt(econ.paybackMonths)} Ø´Ù‡Ø±`}</li>
                    <li><strong>ØµØ§ÙÙŠ Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ø³Ù†ÙˆÙŠ:</strong> ${fmt(econ.netAnnual)} SAR</li>
                    <li><strong>Ø§Ù„Ø®Ø·Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> ${fmt(risk)}%</li>
                `;
                $("#modalBlueprint").classList.remove("hidden");
            }

            function closeModal() {
                activeBlueprintId = null;
                $("#modalBlueprint").classList.add("hidden");
            }

            function nextInitiativeId() {
                const ids = (IS.state.initiatives || []).map((i) => String(i.id || ""));
                const nums = ids
                    .map((id) => {
                        const m = id.match(/I-(\d+)/i);
                        return m ? Number(m[1]) : null;
                    })
                    .filter((x) => Number.isFinite(x));
                const next = nums.length ? (Math.max(...nums) + 1) : 3001;
                return `I-${next}`;
            }

            function buildTaskId(index) {
                const base = Date.now().toString().slice(-5);
                return `TK-${base}${index}`;
            }

            function dueDateFromNow(days) {
                const d = new Date();
                d.setDate(d.getDate() + days);
                return d.toISOString().slice(0, 10);
            }

            function initiativeExistsByBlueprint(bp) {
                return (IS.state.initiatives || []).find((i) => i.prototypeBlueprintId === bp.id || i.title === bp.title) || null;
            }

            function createFromBlueprint(bp, options = {}, { openMap = false } = {}) {
                const already = initiativeExistsByBlueprint(bp);
                if (already) {
                    IS.toast(`Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙƒÙ…Ø¨Ø§Ø¯Ø±Ø© (${already.id})`, "warn", 1800);
                    if (openMap) {
                        localStorage.setItem("is_selected_initiative", already.id);
                        window.location.href = "../map/index.html";
                    }
                    return { created: false, id: already.id };
                }

                const id = nextInitiativeId();
                const now = nowISO();
                const readiness = calcReadiness(bp);
                const owner = String(options.owner || bp.riskProfile?.owner || "Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹").trim();
                const org = String(options.org || IS.state.org?.nameAr || "Ø¬Ù‡Ø© ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©").trim();
                const priority = String(options.priority || bp.defaultPriority || "Ø¹Ø§Ù„ÙŠØ©").trim();

                const initiative = {
                    id,
                    title: bp.title,
                    stage: "Ø§Ù„ÙÙƒØ±Ø©",
                    status: "Ù…Ø³ÙˆØ¯Ø©",
                    progress: 10,
                    score: null,
                    rubric: null,
                    minutes: "",
                    tags: [bp.tag],
                    ownerTeam: (IS.state.teams && IS.state.teams[0] && IS.state.teams[0].id) ? IS.state.teams[0].id : "",
                    org,
                    priority,
                    prototypeBlueprintId: bp.id,
                    validation: {
                        problem: bp.problem,
                        beneficiary: bp.beneficiary,
                        evidence: bp.evidence
                    },
                    impact: { ...bp.impact },
                    riskProfile: {
                        ...bp.riskProfile,
                        owner
                    },
                    postMonitoring: {
                        owner,
                        expected: {
                            annualSaving: Number(bp.impact?.costSaving || 0),
                            timeSavingPct: Number(bp.impact?.timeSavingPct || 0)
                        },
                        m3: { annualSaving: null, timeSavingPct: null, qualityImprovementPct: null, satisfactionPct: null, recordedAt: null },
                        m6: { annualSaving: null, timeSavingPct: null, qualityImprovementPct: null, satisfactionPct: null, recordedAt: null },
                        notes: ""
                    },
                    prototype: {
                        id: `P-${id.split("-")[1]}`,
                        template: bp.prototypeTemplate,
                        support: bp.supportUnit,
                        scope: bp.prototypeScope,
                        progress: 12,
                        status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ®Ø·ÙŠØ·",
                        createdAt: now
                    },
                    tasks: (bp.milestones || []).slice(0, 4).map((m, idx) => ({
                        id: buildTaskId(idx + 1),
                        title: m.task,
                        owner,
                        col: "todo",
                        due: dueDateFromNow((idx + 1) * 6)
                    })),
                    aiPrediction: {
                        score: readiness,
                        level: readiness >= 75 ? "Ù…Ø±ØªÙØ¹" : (readiness >= 55 ? "Ù…ØªÙˆØ³Ø·" : "Ù…Ù†Ø®ÙØ¶"),
                        confidencePct: 72,
                        summary: `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ${bp.id} Ù…Ø¹ Ø¬Ø§Ù‡Ø²ÙŠØ© ${readiness}%.`,
                        updatedAt: now
                    },
                    createdAt: now,
                    updatedAt: now
                };

                IS.state.initiatives = IS.state.initiatives || [];
                IS.state.initiatives.unshift(initiative);
                if (IS.state.me) {
                    IS.state.me.points = Number(IS.state.me.points || 0) + 8;
                }

                IS.audit("Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…Ù† Ù…Ø±ÙƒØ² Ø§Ù„Ù†Ù…Ø§Ø°Ø¬", `${initiative.id} â€¢ ${bp.id}`);
                IS.save();
                IS.toast(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${initiative.id} Ø¨Ù†Ø¬Ø§Ø­ âœ…`, "ok", 1800);

                if (openMap) {
                    localStorage.setItem("is_selected_initiative", initiative.id);
                    window.location.href = "../map/index.html";
                }
                return { created: true, id: initiative.id };
            }

            function renderAll() {
                const list = filterBlueprints();
                renderStats(list);
                renderCards(list);
                renderBacklog(list);
                renderBrief(list);
                renderWeeksPlan(list);
                renderAudit();
            }

            function wireCardActions() {
                $("#prototypeGrid").addEventListener("click", (e) => {
                    const openBtn = e.target.closest("[data-open]");
                    if (openBtn) {
                        openModal(openBtn.getAttribute("data-open"));
                        return;
                    }
                    const addBtn = e.target.closest("[data-add]");
                    if (addBtn) {
                        const bp = getBlueprint(addBtn.getAttribute("data-add"));
                        if (!bp) return;
                        createFromBlueprint(bp);
                        renderAll();
                    }
                });
            }

            function init() {
                fillFilters();
                IS.audit("ÙØªØ­ Ù…Ø±ÙƒØ² Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©", "prototype");
                IS.save();
                renderAll();
                wireCardActions();

                ["q", "domainFilter", "complexityFilter", "impactFilter"].forEach((id) => {
                    const el = document.getElementById(id);
                    const evt = id === "q" ? "input" : "change";
                    el.addEventListener(evt, renderAll);
                });

                $("#btnReset").addEventListener("click", () => {
                    $("#q").value = "";
                    $("#domainFilter").value = "";
                    $("#complexityFilter").value = "";
                    $("#impactFilter").value = "";
                    renderAll();
                });

                $("#btnGenerateBrief").addEventListener("click", renderAll);

                $("#btnGoMap").addEventListener("click", () => {
                    window.location.href = "../map/index.html";
                });

                $("#btnPrint").addEventListener("click", () => {
                    IS.audit("Ø·Ø¨Ø§Ø¹Ø© Ù…Ø±ÙƒØ² Ø§Ù„Ù†Ù…Ø§Ø°Ø¬", "prototype/print");
                    IS.save();
                    window.print();
                });

                $("#btnCreateAll").addEventListener("click", () => {
                    const list = filterBlueprints();
                    let created = 0;
                    list.forEach((bp) => {
                        const res = createFromBlueprint(bp);
                        if (res.created) created += 1;
                    });
                    IS.toast(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${fmt(created)} Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©`, "ok", 2000);
                    renderAll();
                });

                $("#mAdd").addEventListener("click", () => {
                    const bp = getBlueprint(activeBlueprintId);
                    if (!bp) return;
                    createFromBlueprint(bp, {
                        org: $("#mOrg").value,
                        priority: $("#mPriority").value,
                        owner: $("#mOwner").value
                    });
                    closeModal();
                    renderAll();
                });

                $("#mAddOpen").addEventListener("click", () => {
                    const bp = getBlueprint(activeBlueprintId);
                    if (!bp) return;
                    createFromBlueprint(bp, {
                        org: $("#mOrg").value,
                        priority: $("#mPriority").value,
                        owner: $("#mOwner").value
                    }, { openMap: true });
                });

                $$('[data-close-modal]').forEach((el) => el.addEventListener('click', closeModal));
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') closeModal();
                });
            }

            document.addEventListener("DOMContentLoaded", init);
        })();
    </script>

</body>

</html>
