<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <title>Ø¯Ø±Ø¹ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± | Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/app.css" />
    <style>
        .map-controls-grid {
            display: grid;
            grid-template-columns: 1.4fr repeat(7, minmax(110px, 1fr)) auto;
            gap: 8px;
        }

        .map-mini-analytics {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 8px;
        }

        .stage-mini-card {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .04);
            padding: 8px;
            min-height: 90px;
            display: grid;
            gap: 4px;
        }

        .stage-mini-card p {
            margin: 0;
            color: var(--muted2);
            font-size: 11px;
        }

        .stage-mini-card strong {
            font-size: 15px;
            font-weight: 900;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 8px;
        }

        .heat-cell {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            min-height: 66px;
            padding: 8px;
            display: grid;
            align-content: space-between;
            background: rgba(255, 255, 255, .03);
            position: relative;
            overflow: hidden;
        }

        .heat-cell::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(145deg, rgba(255, 90, 122, .28), rgba(255, 214, 106, .20), rgba(66, 246, 231, .14));
            opacity: var(--heat, 0.12);
            pointer-events: none;
        }

        .critical-list {
            margin: 0;
            padding: 0;
            list-style: none;
            display: grid;
            gap: 8px;
        }

        .critical-list li {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            padding: 8px;
        }

        .critical-list .meta {
            margin-top: 4px;
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .live-switch {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, .14);
            background: rgba(255, 255, 255, .05);
            font-size: 12px;
            font-weight: 800;
        }

        .live-switch.is-on {
            border-color: rgba(57, 229, 140, .30);
            background: rgba(57, 229, 140, .14);
        }

        .map-card-kpis {
            display: grid;
            gap: 4px;
            margin-top: 6px;
        }

        .map-card-kpis small {
            color: var(--muted2);
            font-size: 10px;
        }

        .detail-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .change-list {
            margin: 0;
            padding: 0;
            list-style: none;
            display: grid;
            gap: 8px;
            max-height: 220px;
            overflow: auto;
        }

        .change-list li {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            padding: 8px;
        }

        .change-list .time {
            display: block;
            color: var(--muted2);
            font-size: 11px;
            margin-top: 4px;
        }

        .journey-flow {
            display: grid;
            grid-template-columns: repeat(6, minmax(0, 1fr));
            gap: 8px;
        }

        .flow-card {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .04);
            padding: 8px;
            min-height: 84px;
            display: grid;
            gap: 4px;
        }

        .flow-card p {
            margin: 0;
            color: var(--muted2);
            font-size: 11px;
        }

        .flow-card strong {
            font-size: 13px;
        }

        .workspace-kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 8px;
        }

        .workspace-kpi-card {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            padding: 8px;
            min-height: 74px;
            display: grid;
            gap: 2px;
        }

        .workspace-kpi-card p {
            margin: 0;
            color: var(--muted2);
            font-size: 11px;
        }

        .workspace-kpi-card strong {
            font-size: 16px;
            font-weight: 900;
        }

        .ai-output {
            width: 100%;
            border-radius: 12px;
            border: 1px solid rgba(53, 82, 110, .28);
            background: rgba(9, 14, 28, .55);
            color: var(--text);
            padding: 10px;
            line-height: 1.8;
            min-height: 88px;
            resize: vertical;
            font-family: inherit;
        }

        .vote-row {
            margin-top: 6px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }

        .ai-chip {
            border: 1px solid rgba(66, 246, 231, .28);
            background: rgba(66, 246, 231, .10);
            border-radius: 999px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 800;
            color: #d2fffb;
        }

        .welcome-video {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: linear-gradient(150deg, rgba(78, 163, 255, .14), rgba(66, 246, 231, .08));
            padding: 10px;
            line-height: 1.8;
            font-size: 13px;
        }

        .about-quick {
            display: grid;
            gap: 10px;
        }

        .about-quick p {
            margin: 0;
        }

        .about-points {
            margin: 0;
            padding: 0;
            list-style: none;
            display: grid;
            gap: 6px;
        }

        .onboarding-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        #btnNew {
            box-shadow: 0 10px 24px rgba(12, 96, 182, .35);
            border: 1px solid rgba(97, 176, 255, .42);
            font-weight: 900;
            letter-spacing: .2px;
        }

        .quick-paths {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
        }

        .quick-cta {
            border: 1px solid rgba(255, 255, 255, .15);
            border-radius: 14px;
            background: rgba(255, 255, 255, .04);
            color: var(--text);
            min-height: 64px;
            padding: 10px 12px;
            text-align: start;
            display: grid;
            gap: 2px;
            align-content: center;
            cursor: pointer;
            transition: transform .16s ease, border-color .16s ease, box-shadow .16s ease;
        }

        .quick-cta strong {
            font-size: 14px;
            font-weight: 900;
        }

        .quick-cta small {
            color: var(--muted2);
            font-size: 11px;
        }

        .quick-cta:hover {
            transform: translateY(-2px);
            border-color: rgba(126, 187, 255, .45);
            box-shadow: 0 12px 20px rgba(0, 0, 0, .32);
        }

        .quick-cta.is-primary {
            background: linear-gradient(140deg, rgba(77, 168, 255, .24), rgba(66, 246, 231, .14));
            border-color: rgba(97, 176, 255, .5);
        }

        .quick-cta.is-challenge {
            background: linear-gradient(140deg, rgba(255, 115, 135, .2), rgba(255, 210, 109, .15));
            border-color: rgba(255, 129, 143, .4);
        }

        .quick-cta.is-judge {
            background: linear-gradient(140deg, rgba(169, 112, 255, .2), rgba(77, 168, 255, .14));
            border-color: rgba(181, 127, 255, .4);
        }

        .kpi-visual-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
        }

        .kpi-chart-card {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            padding: 10px;
            display: grid;
            gap: 8px;
        }

        .kpi-chart-card p {
            margin: 0;
            color: var(--muted2);
            font-size: 12px;
        }

        .kpi-bars {
            display: grid;
            gap: 8px;
        }

        .kpi-row {
            display: grid;
            grid-template-columns: minmax(90px, .9fr) 1fr auto;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .kpi-row strong {
            font-size: 11px;
            color: var(--muted2);
        }

        .kpi-track {
            width: 100%;
            height: 8px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, .15);
            background: rgba(255, 255, 255, .06);
            overflow: hidden;
        }

        .kpi-track span {
            display: block;
            height: 100%;
            border-radius: 999px;
            background: linear-gradient(90deg, rgba(77, 168, 255, .9), rgba(66, 246, 231, .85));
        }

        .kpi-row small {
            color: var(--text);
            font-weight: 800;
        }

        .impact-ring-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 8px;
        }

        .impact-ring {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            padding: 8px;
            display: grid;
            gap: 6px;
            justify-items: center;
            text-align: center;
        }

        .impact-ring p {
            margin: 0;
            font-size: 11px;
            color: var(--muted2);
        }

        .ring {
            --pct: 0;
            --clr: rgba(77, 168, 255, .95);
            width: 66px;
            height: 66px;
            border-radius: 50%;
            background: conic-gradient(var(--clr) calc(var(--pct)*1%), rgba(255, 255, 255, .14) 0);
            position: relative;
            display: grid;
            place-items: center;
        }

        .ring::before {
            content: "";
            position: absolute;
            inset: 8px;
            border-radius: 50%;
            background: rgba(10, 14, 24, .96);
            border: 1px solid rgba(255, 255, 255, .08);
        }

        .ring b {
            position: relative;
            z-index: 1;
            font-size: 12px;
            font-weight: 900;
        }

        .kpi-sparkline {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            width: 100%;
            height: 126px;
        }

        .kpi-sparkline-meta {
            margin-top: 6px;
            color: var(--muted2);
            font-size: 11px;
        }

        .honor-list {
            margin: 0;
            padding: 0;
            list-style: none;
            display: grid;
            gap: 8px;
        }

        .honor-item {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            padding: 8px;
            display: grid;
            gap: 4px;
        }

        .honor-item .meta {
            margin-top: 4px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }

        @media (max-width: 1200px) {
            .map-controls-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .map-mini-analytics,
            .heatmap-grid,
            .detail-grid-2,
            .workspace-kpi-grid {
                grid-template-columns: 1fr;
            }

            .journey-flow {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .kpi-visual-grid {
                grid-template-columns: 1fr;
            }

            .quick-paths,
            .impact-ring-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 760px) {
            .quick-paths {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body class="career-body">

    <div class="platform-bg">
        <div class="mesh mesh-1"></div>
        <div class="mesh mesh-2"></div>
        <div class="mesh mesh-3"></div>
    </div>

    <div class="platform-shell">

        <!-- TOPBAR -->
        <header class="platform-topbar reveal">
            <div class="topbar-brand">
                <div class="brand-mark">IS</div>
                <div>
                    <h1 class="topbar-title">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h1>
                    <p class="topbar-sub">Ø§Ø¨ØªÙƒØ§Ø± Ø­Ø± + ØªØ­Ø¯ÙŠØ§Øª ÙˆØ§Ù‚Ø¹ÙŠØ© + AI Ù…Ø³Ø§Ø¹Ø¯ + ØªØ­ÙƒÙŠÙ… Ø¨Ø´Ø±ÙŠ Ø¹Ø§Ø¯Ù„</p>
                </div>
            </div>

            <nav class="nav">
                <a href="../../index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="../map/index.html" class="active">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±</a>
                <a href="../prototype/index.html">Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</a>
                <a href="../employee/index.html">Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</a>
                <a href="../judging/index.html">Ø§Ù„ØªØ­ÙƒÙŠÙ…</a>
                <a href="../command/index.html">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</a>
                <a href="../policies/index.html">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</a>
                <a href="../report/index.html">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ</a>
                <a href="../about/index.html">Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ©</a>
            </nav>

            <div class="topbar-actions">
                <span class="live-pill">ğŸ§­ Kanban Live</span>
                <span class="live-switch" id="liveState">LIVE: OFF</span>
                <button class="btn btn-soft" id="btnSeed">Ø¹ÙŠÙ†Ø§Øª</button>
                <button class="btn btn-soft" id="btnLiveToggle">ØªØ´ØºÙŠÙ„ Live</button>
                <button class="btn btn-ghost" id="btnApiSettings">API</button>
                <button class="btn btn-primary" id="btnNew">Ø¨Ø¯Ø¡ Ù…Ø¨Ø§Ø¯Ø±Ø©</button>
            </div>
        </header>

        <section class="workspace-banner reveal">
            <div>
                <span class="eyebrow">Innovation Arena</span>
                <h2 class="hero-title" style="margin-top:8px;">
                    Ø§Ø®ØªØ±: Ø¥Ù…Ø§ Ø¥Ø·Ù„Ø§Ù‚ ÙÙƒØ±Ø© Ø­Ø±Ø© Ø£Ùˆ ØªØ¨Ù†Ù‘ÙŠ ØªØ­Ø¯Ù Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Ø§Ù„ØªØ¬Ù…Ø¹
                </h2>
                <p class="hero-sub">
                    Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø­Ø±Ø© ÙˆØ§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©/Ø§Ù„Ø®Ø¯Ù…ÙŠØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©.
                    Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø±ØŒ ÙŠØ³Ø§Ø¹Ø¯Ùƒ AI ÙÙŠ Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙÙƒØ±Ø©ØŒ Ø«Ù… ØªÙ†ØªÙ‚Ù„ Ø¥Ù„Ù‰ ØªØ­ÙƒÙŠÙ… Ø¨Ø´Ø±ÙŠ ÙŠØ¶Ù…Ù† Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø¹Ø¯Ø§Ù„Ø©.
                </p>
            </div>
            <div class="quality-pill">
                Employee â€¢ Patient â€¢ Ops â€¢ Quality â€¢ Tech â€¢ HR
            </div>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h3>
                <span class="panel-note">Ø­Ø±ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ø¶Ù…Ù† Ø§Ø­ØªÙŠØ§Ø¬ Ø­Ù‚ÙŠÙ‚ÙŠ</span>
            </div>
            <ul class="insight-list" style="margin:0;">
                <li>Ø§Ø¨ØªÙƒØ± Ù„Ø£ÙŠ Ù…Ø³Ø§Ø± ØªØ­Ø³ÙŠÙ†: Ø§Ù„Ù…ÙˆØ¸ÙØŒ Ø§Ù„Ù…Ø±ÙŠØ¶ØŒ Ø§Ù„ØªØ´ØºÙŠÙ„ØŒ Ø§Ù„Ø¬ÙˆØ¯Ø©ØŒ Ø§Ù„ØªÙ‚Ù†ÙŠØ©ØŒ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©.</li>
                <li>Ø£Ùˆ Ø§Ø®ØªØ± ØªØ­Ø¯ÙŠÙ‹Ø§ ÙØ¹Ù„ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠØ© ÙˆØªÙ†Ø§ÙØ³ Ø¹Ù„Ù‰ Ø­Ù„Ù‘Ù‡.</li>
                <li>Ø§Ø³ØªØ®Ø¯Ù… AI Ù„ØµÙŠØ§ØºØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØ§Ù„Ø­Ù„ ÙˆMVP ÙˆØ§Ù„Ø£Ø«Ø± Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ….</li>
                <li>Ø§Ù†ØªÙ‚Ù„ Ù„Ù„ØªØ­ÙƒÙŠÙ… Ø§Ù„Ø¨Ø´Ø±ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ø¯Ø§Ù„Ø© ÙˆØ§Ù„Ø¯Ù‚Ø© ÙˆØ¬ÙˆØ¯Ø© Ø§Ù„Ù‚Ø±Ø§Ø±.</li>
            </ul>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>ØªØ¹Ø±ÙŠÙ Ø³Ø±ÙŠØ¹ Ø¨Ø§Ù„Ù…Ù†ØµØ© ÙˆØ§Ù„ÙØ±ÙŠÙ‚</h3>
                <span class="panel-note">Ù…Ù† Ù†Ø­Ù† â€¢ Ù…Ø§Ø°Ø§ Ù†Ù‚Ø¯Ù… â€¢ ÙƒÙŠÙ ØªØ¨Ø¯Ø£</span>
            </div>
            <div class="about-quick">
                <p class="hero-sub">
                    Ø¯Ø±Ø¹ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± Ù…Ù†ØµØ© ØªÙ…ÙƒÙ‘Ù† Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† ØªØ­ÙˆÙŠÙ„ Ø£ÙŠ ÙÙƒØ±Ø© Ø¥Ù„Ù‰ Ù…Ø¨Ø§Ø¯Ø±Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¨Ø± AI Ù…Ø³Ø§Ø¹Ø¯ + ØªØ­ÙƒÙŠÙ… Ø¨Ø´Ø±ÙŠ + ØªØªØ¨Ø¹ Ø£Ø«Ø±.
                    ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¤ÙŠØ© ÙˆØ§Ù„ÙØ±ÙŠÙ‚ ÙˆÙ‚ØµØµ Ø§Ù„Ù†Ø¬Ø§Ø­ Ù…Ù† ØµÙØ­Ø© "Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ©".
                </p>
                <ul class="about-points">
                    <li>Ø§Ø¨Ø¯Ø£ Ø¨Ù…Ø´ÙƒÙ„Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© Ø£Ùˆ ÙÙƒØ±Ø© Ø­Ø±Ø©.</li>
                    <li>Ø£Ø¶Ù Ø§Ù„ÙØ±ÙŠÙ‚ ÙˆØ³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</li>
                    <li>Ø§Ø³ØªØ®Ø¯Ù… AI Ù„Ù„ØµÙŠØ§ØºØ© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ† Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</li>
                </ul>
                <div class="onboarding-actions">
                    <button class="btn btn-ghost" id="btnFirstGuide">Ø®Ø·ÙˆØ§Øª Ø£ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>
                </div>
            </div>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>Ø±Ø­Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø®ØªØµØ±Ø©</h3>
                <span class="panel-note">Ù…Ù† ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠ ÙÙŠ Ù…Ø³Ø§Ø± ÙˆØ§Ø­Ø¯</span>
            </div>
            <div class="journey-flow">
                <article class="flow-card">
                    <strong>1) Ø¥Ù†Ø´Ø§Ø¡ ÙÙƒØ±Ø©</strong>
                    <p>Ø¥Ø¶Ø§ÙØ© ÙÙƒØ±Ø© Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± ØªØ­Ø¯Ù ÙˆØ§Ù‚Ø¹ÙŠ.</p>
                </article>
                <article class="flow-card">
                    <strong>2) ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ±ÙŠÙ‚</strong>
                    <p>Ø§Ø®ØªÙŠØ§Ø± Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ‚.</p>
                </article>
                <article class="flow-card">
                    <strong>3) Workspace ØªÙ„Ù‚Ø§Ø¦ÙŠ</strong>
                    <p>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ø§Ù… ÙˆØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆÙ…Ù„ÙØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</p>
                </article>
                <article class="flow-card">
                    <strong>4) ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</strong>
                    <p>ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.</p>
                </article>
                <article class="flow-card">
                    <strong>5) Ø¹Ù…Ù„ Ø¬Ù…Ø§Ø¹ÙŠ</strong>
                    <p>Ø¯Ø±Ø¯Ø´Ø©ØŒ Ù…Ø±ÙÙ‚Ø§ØªØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù….</p>
                </article>
                <article class="flow-card">
                    <strong>6) ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø­Ù„</strong>
                    <p>Ø±ÙØ¹ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„ØªØ­ÙƒÙŠÙ….</p>
                </article>
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
                <button class="btn btn-soft" id="btnWelcome">Ø´Ø±Ø­ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø±Ø­Ù„Ø©</button>
                <span class="ai-chip">AI Suggestions ON</span>
            </div>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>
                <span class="panel-note">ÙˆØµÙˆÙ„ Ù…Ø¨Ø§Ø´Ø± Ù„Ø£Ù‡Ù… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</span>
            </div>
            <div class="quick-paths">
                <button class="quick-cta is-challenge" id="btnPathChallenges">
                    <strong>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</strong>
                    <small>Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©</small>
                </button>
                <button class="quick-cta is-judge" id="btnPathJudging">
                    <strong>Ù…Ø³Ø§Ø± Ø§Ù„ØªØ­ÙƒÙŠÙ…</strong>
                    <small>Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„ØªØ­ÙƒÙŠÙ… Ù…Ø¹ Ø¢Ø®Ø± Ù…Ø¨Ø§Ø¯Ø±Ø©</small>
                </button>
                <button class="quick-cta" id="btnPathBoard">
                    <strong>Ù„ÙˆØ­Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©</strong>
                    <small>Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Kanban</small>
                </button>
            </div>
        </section>

        <!-- CONTROLS -->
        <section class="panel reveal">
            <div class="panel-head">
                <h3>Ø§Ù„ØªØ­ÙƒÙ…</h3>
                <span class="panel-note">Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø£Ùˆ Ø¯ÙØ¹Ù‡Ø§ Ù„Ù„ØªØ­ÙƒÙŠÙ…</span>
            </div>

            <div class="table-tools map-controls-grid">
                <input id="q" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ (Ø¹Ù†ÙˆØ§Ù†/Ù…Ø¹Ø±Ù/ØªØµÙ†ÙŠÙ)â€¦" />
                <input id="qSemantic" placeholder="Ø¨Ø­Ø« Ø¯Ù„Ø§Ù„ÙŠ Semantic Searchâ€¦" />
                <select id="status">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option>Ù…Ø³ÙˆØ¯Ø©</option>
                    <option>Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…</option>
                    <option>Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</option>
                    <option>Ù…Ø¹ØªÙ…Ø¯</option>
                    <option>Ù…Ø±ÙÙˆØ¶</option>
                    <option>Ù…Ø·Ø¨Ù‚</option>
                </select>

                <select id="tag">
                    <option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
                </select>
                <select id="maturityFilter">
                    <option value="">ÙƒÙ„ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬</option>
                    <option value="low">Ù…Ù†Ø®ÙØ¶</option>
                    <option value="mid">Ù…ØªÙˆØ³Ø·</option>
                    <option value="high">Ù…Ø±ØªÙØ¹</option>
                </select>
                <select id="riskFilter">
                    <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
                    <option value="low">Ù…Ø®Ø§Ø·Ø± Ù…Ù†Ø®ÙØ¶Ø©</option>
                    <option value="mid">Ù…Ø®Ø§Ø·Ø± Ù…ØªÙˆØ³Ø·Ø©</option>
                    <option value="high">Ù…Ø®Ø§Ø·Ø± Ù…Ø±ØªÙØ¹Ø©</option>
                </select>
                <select id="priorityFilter">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                    <option>Ø­Ø±Ø¬Ø©</option>
                    <option>Ø¹Ø§Ù„ÙŠØ©</option>
                    <option>Ù…ØªÙˆØ³Ø·Ø©</option>
                    <option>Ù…Ù†Ø®ÙØ¶Ø©</option>
                </select>
                <select id="orgFilter">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                </select>
                <input id="dateFrom" type="date" />
                <input id="dateTo" type="date" />

                <span class="table-count" id="pill">â€”</span>
                <button class="btn btn-ghost" id="btnReset">Ø¥Ø¹Ø§Ø¯Ø©</button>
            </div>
        </section>

        <section class="insights-grid reveal">
            <section class="panel">
                <div class="panel-head">
                    <h3>Ù„ÙˆØ­Ø© Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø³Ø§Ø­Ø©</h3>
                    <span class="panel-note">ØªÙ‚Ø¯Ù… â€¢ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª â€¢ ØªØ­ÙÙŠØ²</span>
                </div>
                <div class="workspace-kpi-grid">
                    <article class="workspace-kpi-card">
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</p>
                        <strong id="wsTotal">0</strong>
                    </article>
                    <article class="workspace-kpi-card">
                        <p>Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ­ÙƒÙŠÙ…</p>
                        <strong id="wsReady">0</strong>
                    </article>
                    <article class="workspace-kpi-card">
                        <p>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
                        <strong id="wsNotifications">0</strong>
                    </article>
                    <article class="workspace-kpi-card">
                        <p>Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­ÙÙŠØ²</p>
                        <strong id="wsPoints">0</strong>
                    </article>
                </div>
                <ul class="insight-list" id="workspaceAlerts" style="margin-top:10px;"></ul>
            </section>
            <section class="panel">
                <div class="panel-head">
                    <h3>Ø§Ù„Ø£ÙƒØ«Ø± ØªÙØ§Ø¹Ù„Ù‹Ø§</h3>
                    <span class="panel-note">ØªØµÙˆÙŠØª + ØªØ¹Ù„ÙŠÙ‚Ø§Øª + Ø¥Ù†Ø¬Ø§Ø² Ù…Ù‡Ø§Ù…</span>
                </div>
                <ul class="critical-list" id="topEngagementList"></ul>
            </section>
        </section>

        <section class="insights-grid reveal">
            <section class="panel">
                <div class="panel-head">
                    <h3>Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø±Ø¦ÙŠØ©</h3>
                    <span class="panel-note">Ø±Ø³ÙˆÙ… Ù…Ø¨Ø³Ø·Ø© Ù„Ù‚Ø±Ø§Ø¡Ø© Ø£Ø³Ø±Ø¹ Ù„Ù„Ø£Ø«Ø±</span>
                </div>
                <div class="kpi-visual-grid">
                    <article class="kpi-chart-card">
                        <p>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</p>
                        <div class="kpi-bars" id="kpiStatusBars"></div>
                    </article>
                    <article class="kpi-chart-card">
                        <p>ØµØ­Ø© Ù…Ø³Ø§Ø± Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± (Ù…ØªÙˆØ³Ø·Ø§Øª)</p>
                        <div class="kpi-bars" id="kpiHealthBars"></div>
                    </article>
                    <article class="kpi-chart-card">
                        <p>Ø§Ù„Ø£Ø«Ø± Ø§Ù„ÙƒÙ„ÙŠ (Ø¯ÙˆØ§Ø¦Ø± Ù†Ø³Ø¨ÙŠØ©)</p>
                        <div class="impact-ring-grid" id="kpiImpactRings"></div>
                    </article>
                    <article class="kpi-chart-card">
                        <p>Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ù…Ø±Ø§Ø­Ù„</p>
                        <svg class="kpi-sparkline" id="kpiSparkline" viewBox="0 0 320 126" aria-label="Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø±Ø§Ø­Ù„">
                            <defs>
                                <linearGradient id="kpiSparkGrad" x1="0%" x2="100%" y1="0%" y2="0%">
                                    <stop offset="0%" stop-color="rgba(77,168,255,.95)" />
                                    <stop offset="100%" stop-color="rgba(66,246,231,.95)" />
                                </linearGradient>
                            </defs>
                            <path id="kpiSparkPath" d="" fill="none" stroke="url(#kpiSparkGrad)" stroke-width="3"
                                stroke-linecap="round"></path>
                            <g id="kpiSparkDots"></g>
                        </svg>
                        <div class="kpi-sparkline-meta" id="kpiSparklineMeta">â€”</div>
                    </article>
                </div>
            </section>
            <section class="panel">
                <div class="panel-head">
                    <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù ÙˆØ§Ù„Ø´Ø§Ø±Ø§Øª</h3>
                    <span class="panel-note">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø´Ø§Ø·Ù‹Ø§ Ø¨Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ù‡Ø§Ù…</span>
                </div>
                <ul class="honor-list" id="honorBoardList"></ul>
            </section>
        </section>

        <section class="insights-grid reveal">
            <section class="panel">
                <div class="panel-head">
                    <h3>Mini Analytics Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</h3>
                    <span class="panel-note">Count â€¢ Maturity â€¢ Risk</span>
                </div>
                <div class="map-mini-analytics" id="stageMiniAnalytics"></div>
            </section>
            <section class="panel">
                <div class="panel-head">
                    <h3>Ø®Ø±ÙŠØ·Ø© Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</h3>
                    <span class="panel-note">Heatmap Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙˆØ§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</span>
                </div>
                <div class="heatmap-grid" id="mapHeat"></div>
            </section>
        </section>

        <section class="panel reveal">
            <div class="panel-head">
                <h3>Ø³ÙˆÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠØ©</h3>
                <span class="panel-note">Ù‚Ø§Ø¦Ù…Ø© Ù…Ø´Ø§ÙƒÙ„/Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø­Ø±Ø¬Ø© ØªØ­ØªØ§Ø¬ Ø­Ù„ÙˆÙ„Ù‹Ø§ ØªÙ†Ø§ÙØ³ÙŠØ©</span>
            </div>
            <ul class="critical-list" id="criticalList"></ul>
        </section>

        <!-- BOARD -->
        <section class="board reveal" id="board"></section>

        <!-- NEW MODAL -->
        <div class="modal hidden" id="modalNew">
            <div class="modal-backdrop" data-close></div>
            <div class="modal-card">
                <div class="mhead">
                    <div class="mtitle">Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø¯Ø±Ø©</div>
                    <button class="btn btn-ghost" data-close>Ø¥ØºÙ„Ø§Ù‚</button>
                </div>

                <div class="mgrid">
                    <div class="field">
                        <div class="lbl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</div>
                        <input id="nTitle" placeholder="Ù…Ø«Ø§Ù„: Ø£ØªÙ…ØªØ© Ù…Ø³Ø§Ø±â€¦">
                    </div>

                    <div class="field">
                        <div class="lbl">Ø§Ù„ØªØµÙ†ÙŠÙ</div>
                        <select id="nTag" class="select"></select>
                    </div>

                    <div class="field">
                        <div class="lbl">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</div>
                        <select id="nStage" class="select"></select>
                    </div>

                    <div class="field">
                        <div class="lbl">Template Ø¬Ø§Ù‡Ø²</div>
                        <select id="nTemplate" class="select">
                            <option value="">Ø¨Ø¯ÙˆÙ† Template</option>
                            <option value="service-ops">ØªØ­Ø³ÙŠÙ† ØªØ´ØºÙŠÙ„ÙŠ</option>
                            <option value="patient-exp">ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªÙÙŠØ¯</option>
                            <option value="digital-ai">Ø­Ù„ Ø±Ù‚Ù…ÙŠ/Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
                            <option value="quality-compliance">Ø¬ÙˆØ¯Ø© ÙˆØ§Ù…ØªØ«Ø§Ù„</option>
                        </select>
                    </div>

                    <div class="field">
                        <div class="lbl">Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
                        <select id="nStatus" class="select">
                            <option>Ù…Ø³ÙˆØ¯Ø©</option>
                            <option>Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…</option>
                            <option>Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</option>
                        </select>
                    </div>

                    <div class="field">
                        <div class="lbl">Ø§Ù„Ø¬Ù‡Ø©</div>
                        <input id="nOrg" placeholder="Ù…Ø«Ø§Ù„: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©">
                    </div>

                    <div class="field">
                        <div class="lbl">Ø§Ù„ÙØ±ÙŠÙ‚</div>
                        <select id="nTeam" class="select"></select>
                    </div>
                </div>

                <div class="field" style="margin-top:10px;">
                    <div class="lbl">Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹</div>
                    <textarea id="nDesc" rows="4"
                        style="width:100%; border-radius:12px; border:1px solid rgba(53,82,110,.22); padding:10px; font-family:inherit;"></textarea>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>Validation Layer</h3>
                        <span class="panel-note">Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙƒÙŠÙ…</span>
                    </div>
                    <div class="mgrid">
                        <div class="field">
                            <div class="lbl">Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©</div>
                            <input id="nProblem" placeholder="Ù…Ø§ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©ØŸ">
                        </div>
                        <div class="field">
                            <div class="lbl">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø©</div>
                            <input id="nBeneficiary" placeholder="Ù…Ø±Ø¶Ù‰ / Ù…ÙˆØ¸ÙÙŠÙ† / Ø£Ù‚Ø³Ø§Ù… ...">
                        </div>
                        <div class="field" style="grid-column:1/-1;">
                            <div class="lbl">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ / Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
                            <textarea id="nEvidence" rows="3"
                                style="width:100%; border-radius:12px; border:1px solid rgba(53,82,110,.22); padding:10px; font-family:inherit;"></textarea>
                        </div>
                        <div class="field">
                            <div class="lbl">Ø­Ø¬Ù… Ø¹ÙŠÙ†Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰/Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†</div>
                            <input id="nCoSample" type="number" min="0" step="1" placeholder="Ù…Ø«Ø§Ù„: 12">
                        </div>
                        <div class="field">
                            <div class="lbl">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹ÙŠÙ†Ø© (1-5)</div>
                            <input id="nCoScore" type="number" min="1" max="5" step="1" placeholder="Ù…Ø«Ø§Ù„: 4">
                        </div>
                        <div class="field" style="grid-column:1/-1;">
                            <div class="lbl">Ø£Ø¨Ø±Ø² Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ù„Ù…</div>
                            <input id="nCoPain" placeholder="Ù…Ø«Ø§Ù„: Ø·ÙˆÙ„ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙˆØµØ¹ÙˆØ¨Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ¹Ø¯">
                        </div>
                        <div class="field" style="grid-column:1/-1;">
                            <div class="lbl">ØªÙˆØµÙŠØ© Ø§Ù„Ø¹ÙŠÙ†Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙƒÙŠÙ…</div>
                            <input id="nCoReco" placeholder="Ù…Ø«Ø§Ù„: Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­ÙƒÙŠÙ… Ø¨Ø¹Ø¯ ØªÙˆØ¶ÙŠØ­ Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø±ÙŠØ¶">
                        </div>
                    </div>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>AI Coâ€‘Pilot</h3>
                        <span class="panel-note">ØµÙŠØ§ØºØ© Ø§Ù„ÙÙƒØ±Ø© + Ø§Ù‚ØªØ±Ø§Ø­ ØªØ­Ø³ÙŠÙ†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</span>
                    </div>
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-soft" id="nAiDraft">AI ØµÙŠØ§ØºØ© Ø§Ù„ÙÙƒØ±Ø©</button>
                        <button class="btn btn-soft" id="nAiImprove">AI ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙÙƒØ±Ø©</button>
                    </div>
                    <textarea id="nAiOutput" class="ai-output" rows="4"
                        placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ..."></textarea>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„</h3>
                        <span class="panel-note">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø­ÙØ¸ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©</span>
                    </div>
                    <div class="mgrid">
                        <label class="field" style="display:flex; gap:8px; align-items:center;">
                            <input id="nAutoWorkspace" type="checkbox" checked>
                            <div class="lbl" style="margin:0;">Ø¥Ù†Ø´Ø§Ø¡ Workspace ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
                        </label>
                        <label class="field" style="display:flex; gap:8px; align-items:center;">
                            <input id="nAutoAiTasks" type="checkbox" checked>
                            <div class="lbl" style="margin:0;">ØªÙˆØ²ÙŠØ¹ Ù…Ù‡Ø§Ù… Ø£ÙˆÙ„ÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
                        </label>
                    </div>
                </div>

                <div class="mfoot">
                    <div class="mtext" id="nHint">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ + Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚.</div>
                    <button class="btn btn-primary" id="nCreate">Ø¥Ù†Ø´Ø§Ø¡</button>
                </div>
            </div>
        </div>

        <!-- DETAILS MODAL -->
        <div class="modal hidden" id="modalDetails">
            <div class="modal-backdrop" data-close2></div>
            <div class="modal-card">
                <div class="mhead">
                    <div class="mtitle" id="dTitle">ØªÙØ§ØµÙŠÙ„</div>
                    <button class="btn btn-ghost" data-close2>Ø¥ØºÙ„Ø§Ù‚</button>
                </div>

                <div class="mgrid">
                    <div class="field">
                        <div class="lbl">Ø§Ù„Ù…Ø¹Ø±Ù</div>
                        <input id="dId" disabled>
                    </div>

                    <div class="field">
                        <div class="lbl">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</div>
                        <select id="dStage" class="select"></select>
                    </div>

                    <div class="field">
                        <div class="lbl">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                        <select id="dStatus" class="select">
                            <option>Ù…Ø³ÙˆØ¯Ø©</option>
                            <option>Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…</option>
                            <option>Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</option>
                            <option>Ù…Ø¹ØªÙ…Ø¯</option>
                            <option>Ù…Ø±ÙÙˆØ¶</option>
                            <option>Ù…Ø·Ø¨Ù‚</option>
                        </select>
                    </div>

                    <div class="field">
                        <div class="lbl">Ø§Ù„ØªÙ‚Ø¯Ù… %</div>
                        <input id="dProgress" type="number" min="0" max="100" step="1">
                    </div>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>Prototype (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
                        <span class="panel-note">Ø¬Ø§Ù‡Ø²ÙŠØ© + Ø¯Ø¹Ù…</span>
                    </div>

                    <div class="mgrid">
                        <div class="field">
                            <div class="lbl">Ø§Ù„Ù‚Ø§Ù„Ø¨</div>
                            <select id="pTemplate" class="select">
                                <option value="">â€”</option>
                                <option>Dashboard</option>
                                <option>Landing Page</option>
                                <option>Chatbot</option>
                                <option>Mobile Mockup</option>
                                <option>Data Flow Diagram</option>
                            </select>
                        </div>

                        <div class="field">
                            <div class="lbl">Ø§Ù„ØªÙ‚Ø¯Ù… %</div>
                            <input id="pProgress" type="number" min="0" max="100" step="1" value="0">
                        </div>

                        <div class="field">
                            <div class="lbl">ÙˆØ­Ø¯Ø© Ø§Ù„Ø¯Ø¹Ù…</div>
                            <select id="pSupport" class="select">
                                <option>Prototype Support Unit</option>
                                <option>UI/UX</option>
                                <option>Development</option>
                                <option>Analytics</option>
                            </select>
                        </div>

                        <div class="field">
                            <div class="lbl">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                            <select id="pStatus" class="select">
                                <option>Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</option>
                                <option>Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­ÙƒÙŠÙ…</option>
                                <option>Ù…ÙƒØªÙ…Ù„</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>Validation + Impact</h3>
                        <span class="panel-note">Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© + Ø£Ø«Ø± Ø§Ù‚ØªØµØ§Ø¯ÙŠ ØªÙ‚Ø¯ÙŠØ±ÙŠ</span>
                    </div>
                    <div class="mgrid">
                        <div class="field">
                            <div class="lbl">Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©</div>
                            <input id="dProblem" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ø´ÙƒÙ„Ø©">
                        </div>
                        <div class="field">
                            <div class="lbl">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø©</div>
                            <input id="dBeneficiary" placeholder="Ù…Ù† Ø§Ù„Ù…ØªØ£Ø«Ø±ØŸ">
                        </div>
                        <div class="field" style="grid-column:1/-1;">
                            <div class="lbl">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ / Ù†ØªØ§Ø¦Ø¬ Ù…Ù‚Ø§Ø¨Ù„Ø§Øª</div>
                            <textarea id="dEvidence" rows="3"
                                style="width:100%; border-radius:12px; border:1px solid rgba(53,82,110,.22); padding:10px; font-family:inherit;"></textarea>
                        </div>
                        <div class="field">
                            <div class="lbl">ØªÙˆÙÙŠØ± Ø³Ù†ÙˆÙŠ ØªÙ‚Ø¯ÙŠØ±ÙŠ (Ø±ÙŠØ§Ù„)</div>
                            <input id="dCostSaving" type="number" min="0" step="1000" value="0">
                        </div>
                        <div class="field">
                            <div class="lbl">ØªØ®ÙÙŠØ¶ ÙˆÙ‚Øª Ø§Ù„Ø®Ø¯Ù…Ø© (%)</div>
                            <input id="dTimeSaving" type="number" min="0" max="100" step="1" value="0">
                        </div>
                    </div>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>Patient Coâ€‘Creation Panel</h3>
                        <span class="panel-note">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙƒØ±Ø© Ù…Ø¹ Ø¹ÙŠÙ†Ø© Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙƒÙŠÙ… Ø§Ù„Ø±Ø³Ù…ÙŠ</span>
                    </div>
                    <div class="mgrid">
                        <div class="field">
                            <div class="lbl">Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</div>
                            <input id="dCoSample" type="number" min="0" step="1" value="0">
                        </div>
                        <div class="field">
                            <div class="lbl">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (1-5)</div>
                            <input id="dCoScore" type="number" min="1" max="5" step="1">
                        </div>
                        <div class="field" style="grid-column:1/-1;">
                            <div class="lbl">Ø£Ø¨Ø±Ø² Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ù„Ù…</div>
                            <textarea id="dCoPain" rows="2"
                                style="width:100%; border-radius:12px; border:1px solid rgba(53,82,110,.22); padding:10px; font-family:inherit;"></textarea>
                        </div>
                        <div class="field" style="grid-column:1/-1;">
                            <div class="lbl">ØªÙˆØµÙŠØ© Ø§Ù„Ø¹ÙŠÙ†Ø©</div>
                            <input id="dCoReco" placeholder="Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­ÙƒÙŠÙ… / ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„">
                        </div>
                    </div>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>Post-Implementation Monitoring</h3>
                        <span class="panel-note">Ù…ØªØ§Ø¨Ø¹Ø© 3/6 Ø£Ø´Ù‡Ø± ÙˆÙ…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø¨Ø§Ù„ÙØ¹Ù„ÙŠ</span>
                    </div>
                    <div class="mgrid">
                        <div class="field">
                            <div class="lbl">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</div>
                            <input id="dMonOwner" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„">
                        </div>
                        <div class="field">
                            <div class="lbl">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</div>
                            <input id="dMonNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø®ØªØµØ±Ø©">
                        </div>

                        <div class="field">
                            <div class="lbl">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ØªÙˆÙÙŠØ± Ø³Ù†ÙˆÙŠ (SAR)</div>
                            <input id="dMonExpectedSaving" type="number" min="0" step="1000" value="0">
                        </div>
                        <div class="field">
                            <div class="lbl">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: Ø®ÙØ¶ ÙˆÙ‚Øª (%)</div>
                            <input id="dMonExpectedTime" type="number" min="0" max="100" step="1" value="0">
                        </div>

                        <div class="field">
                            <div class="lbl">ÙØ¹Ù„ÙŠ 3 Ø£Ø´Ù‡Ø±: ØªÙˆÙÙŠØ± (SAR)</div>
                            <input id="dMon3Saving" type="number" min="0" step="1000">
                        </div>
                        <div class="field">
                            <div class="lbl">ÙØ¹Ù„ÙŠ 3 Ø£Ø´Ù‡Ø±: Ø®ÙØ¶ ÙˆÙ‚Øª (%)</div>
                            <input id="dMon3Time" type="number" min="0" max="100" step="1">
                        </div>
                        <div class="field">
                            <div class="lbl">ÙØ¹Ù„ÙŠ 3 Ø£Ø´Ù‡Ø±: ØªØ­Ø³Ù† Ø¬ÙˆØ¯Ø© (%)</div>
                            <input id="dMon3Quality" type="number" min="0" max="100" step="1">
                        </div>
                        <div class="field">
                            <div class="lbl">ÙØ¹Ù„ÙŠ 3 Ø£Ø´Ù‡Ø±: Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ (%)</div>
                            <input id="dMon3Sat" type="number" min="0" max="100" step="1">
                        </div>

                        <div class="field">
                            <div class="lbl">ÙØ¹Ù„ÙŠ 6 Ø£Ø´Ù‡Ø±: ØªÙˆÙÙŠØ± (SAR)</div>
                            <input id="dMon6Saving" type="number" min="0" step="1000">
                        </div>
                        <div class="field">
                            <div class="lbl">ÙØ¹Ù„ÙŠ 6 Ø£Ø´Ù‡Ø±: Ø®ÙØ¶ ÙˆÙ‚Øª (%)</div>
                            <input id="dMon6Time" type="number" min="0" max="100" step="1">
                        </div>
                        <div class="field">
                            <div class="lbl">ÙØ¹Ù„ÙŠ 6 Ø£Ø´Ù‡Ø±: ØªØ­Ø³Ù† Ø¬ÙˆØ¯Ø© (%)</div>
                            <input id="dMon6Quality" type="number" min="0" max="100" step="1">
                        </div>
                        <div class="field">
                            <div class="lbl">ÙØ¹Ù„ÙŠ 6 Ø£Ø´Ù‡Ø±: Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ (%)</div>
                            <input id="dMon6Sat" type="number" min="0" max="100" step="1">
                        </div>
                    </div>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>Ù…Ù‡Ø§Ù… Ø³Ø±ÙŠØ¹Ø©</h3>
                        <span class="panel-note">Todo â€¢ Doing â€¢ Done</span>
                    </div>

                    <div class="mgrid">
                        <div class="field">
                            <div class="lbl">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©</div>
                            <input id="tTitle" placeholder="Ù…Ø«Ø§Ù„: ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬">
                        </div>
                        <div class="field">
                            <div class="lbl">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</div>
                            <input id="tOwner" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¶Ùˆ 2">
                        </div>
                        <div class="field">
                            <div class="lbl">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                            <select id="tCol" class="select">
                                <option value="todo">Todo</option>
                                <option value="doing">Doing</option>
                                <option value="done">Done</option>
                            </select>
                        </div>
                        <div class="field">
                            <div class="lbl">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</div>
                            <input id="tDue" type="date">
                        </div>
                    </div>

                    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
                        <button class="btn btn-soft" id="tAdd">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
                        <button class="btn btn-soft" id="tAiDistribute">ØªÙˆØ²ÙŠØ¹ AI</button>
                        <button class="btn btn-soft" id="tAiSummary">ØªÙ„Ø®ÙŠØµ AI</button>
                        <span class="table-count" id="tCount">â€”</span>
                    </div>

                    <ul class="insight-list" id="tList" style="margin-top:10px;"></ul>
                </div>

                <div class="detail-grid-2">
                    <div class="panel" style="margin-top:10px;">
                        <div class="panel-head">
                            <h3>ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
                            <span class="panel-note">Collaboration</span>
                        </div>
                        <div class="mgrid">
                            <div class="field">
                                <div class="lbl">ØªØ¹Ù„ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</div>
                                <input id="dCommentText" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ù‹Ø§..." />
                            </div>
                            <div class="field">
                                <div class="lbl">ÙƒØ§ØªØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</div>
                                <input id="dCommentAuthor" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù / @mention">
                            </div>
                        </div>
                        <div style="margin-top:8px;">
                            <button class="btn btn-soft" id="dCommentAdd">Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚</button>
                        </div>
                        <ul class="change-list" id="dComments" style="margin-top:10px;"></ul>
                    </div>

                    <div class="panel" style="margin-top:10px;">
                        <div class="panel-head">
                            <h3>Ù…Ø±ÙÙ‚Ø§Øª ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„ØªØºÙŠÙŠØ±</h3>
                            <span class="panel-note">Attachments â€¢ Change Log</span>
                        </div>
                        <div class="mgrid">
                            <div class="field">
                                <div class="lbl">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙÙ‚</div>
                                <input id="dFileName" placeholder="Ù…Ø«Ø§Ù„: business-case.pdf">
                            </div>
                            <div class="field">
                                <div class="lbl">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙÙ‚</div>
                                <select id="dFileType" class="select">
                                    <option>Document</option>
                                    <option>Image</option>
                                    <option>Pitch</option>
                                    <option>Prototype</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top:8px;">
                            <button class="btn btn-soft" id="dFileAdd">Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙÙ‚</button>
                        </div>
                        <ul class="change-list" id="dFiles" style="margin-top:10px;"></ul>
                        <div class="hr"></div>
                        <ul class="change-list" id="dChangeLog"></ul>
                    </div>
                </div>

                <div class="panel" style="margin-top:10px;">
                    <div class="panel-head">
                        <h3>AI Assistant</h3>
                        <span class="panel-note">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª + Ø­Ù„ÙˆÙ„ + ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
                    </div>
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-soft" id="dAiSuggest">Ø§Ù‚ØªØ±Ø§Ø­ ØªØ­Ø³ÙŠÙ†Ø§Øª AI</button>
                        <button class="btn btn-soft" id="dAiSolve">Ø§Ù‚ØªØ±Ø§Ø­ Ø­Ù„ÙˆÙ„ AI</button>
                        <button class="btn btn-primary" id="dSubmitFinal">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</button>
                    </div>
                    <textarea id="dAiOutput" class="ai-output" rows="5"
                        placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ù„Ø®Øµ Ø£Ùˆ ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ..."></textarea>
                </div>

                <div class="mfoot">
                    <div class="mtext">Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ ÙŠÙ†Ø¹ÙƒØ³ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„ØªØ­ÙƒÙŠÙ….</div>
                    <button class="btn btn-primary" id="dSave">Ø­ÙØ¸</button>
                </div>
            </div>
        </div>

        <div class="modal hidden" id="modalApi">
            <div class="modal-backdrop" data-close-api></div>
            <div class="modal-card">
                <div class="mhead">
                    <div class="mtitle">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· API</div>
                    <button class="btn btn-ghost" data-close-api>Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
                <div class="field">
                    <div class="lbl">API Base URL</div>
                    <input id="apiBaseInput" placeholder="http://127.0.0.1:8080" dir="ltr" />
                </div>
                <div class="mfoot">
                    <div class="mtext" id="apiStateHint">ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.</div>
                    <button class="btn btn-soft" id="btnApiTest">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
                    <button class="btn btn-primary" id="btnApiSave">Ø­ÙØ¸</button>
                </div>
            </div>
        </div>

        <div class="modal hidden" id="modalWelcome">
            <div class="modal-backdrop" data-close-welcome></div>
            <div class="modal-card">
                <div class="mhead">
                    <div class="mtitle">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±</div>
                    <button class="btn btn-ghost" data-close-welcome>Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
                <div class="welcome-video">
                    <strong>ÙÙŠØ¯ÙŠÙˆ ØªØ±Ø­ÙŠØ¨ÙŠ (60 Ø«Ø§Ù†ÙŠØ© - Ù†Øµ ØªÙØ§Ø¹Ù„ÙŠ)</strong>
                    <p style="margin:6px 0 0;">
                        1) Ø§Ø¨Ø¯Ø£ Ø¨ÙÙƒØ±Ø© Ø£Ùˆ ØªØ­Ø¯Ù ÙˆØ§Ù‚Ø¹ÙŠ.<br>
                        2) Ø­Ø¯Ù‘Ø¯ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„.<br>
                        3) Ø£Ù†Ø´Ø¦ Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.<br>
                        4) ÙˆØ²Ù‘Ø¹ Ø§Ù„Ù…Ù‡Ø§Ù… ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø£Ùˆ Ø¹Ø¨Ø± AI.<br>
                        5) ØªØ¹Ø§ÙˆÙ† Ø¹Ø¨Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ø±ÙÙ‚Ø§Øª.<br>
                        6) Ù‚Ø¯Ù‘Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ØªØ­ÙƒÙŠÙ….
                    </p>
                </div>
                <div class="mfoot">
                    <div class="mtext">ÙŠÙ…ÙƒÙ†Ùƒ ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±Ø­ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ù† Ø²Ø± "Ø´Ø±Ø­ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø±Ø­Ù„Ø©".</div>
                    <button class="btn btn-primary" id="welcomeStartBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
                </div>
            </div>
        </div>

    </div>

    <script src="../../assets/js/app.js"></script>

    <script>
        (() => {
            "use strict";

            const $ = (s, r = document) => r.querySelector(s);
            const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
            const IS = window.IS;

            const fmt = (n) => new Intl.NumberFormat("ar-SA").format(Number(n || 0));
            const clamp = (n, a, b) => Math.max(a, Math.min(b, Number(n || 0)));
            const nowISO = () => new Date().toISOString();
            const esc = (v) => String(v ?? "")
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#39;");
            const normalize = (v) => String(v || "")
                .toLowerCase()
                .replace(/[Ø£Ø¥Ø¢]/g, "Ø§")
                .replace(/Ø©/g, "Ù‡")
                .replace(/Ù‰/g, "ÙŠ")
                .replace(/\s+/g, " ")
                .trim();
            const toNullableNumber = (v, min = 0, max = null) => {
                if (v == null || v === "") return null;
                const n = Number(v);
                if (!Number.isFinite(n)) return null;
                let out = n;
                if (min != null) out = Math.max(min, out);
                if (max != null) out = Math.min(max, out);
                return out;
            };

            const API_BASE_KEY = "IS_API_BASE";
            const DEFAULT_API_BASE = localStorage.getItem(API_BASE_KEY) || "http://127.0.0.1:8080";
            const SEARCH_ALIASES = {
                "Ø§Ù„Ù„Ø¬Ù†Ù‡": "Ø§Ù„Ù„Ø¬Ù†Ø©",
                "Ù„Ø¬Ù†Ù‡": "Ø§Ù„Ù„Ø¬Ù†Ø©",
                "Ø¬ÙˆØ¯Ù‡": "Ø¬ÙˆØ¯Ø©",
                "Ø­Ø±Ø¬Ù‡": "Ø­Ø±Ø¬Ø©",
                "Ø±Ù‚Ù…ÙŠ": "Ø±Ù‚Ù…Ù†Ø©",
                "ai": "Ø°ÙƒØ§Ø¡",
                "Ø°ÙƒØ§Ø¡": "Ø°ÙƒØ§Ø¡"
            };
            const PRIORITY_RANK = { "Ø­Ø±Ø¬Ø©": 4, "Ø¹Ø§Ù„ÙŠØ©": 3, "Ù…ØªÙˆØ³Ø·Ø©": 2, "Ù…Ù†Ø®ÙØ¶Ø©": 1 };
            const MAP_WELCOME_KEY = "IS_MAP_WELCOME_V3";

            const board = $("#board");
            let current = null;
            let liveMode = false;
            let liveTimer = null;

            const TEMPLATE_PRESETS = {
                "service-ops": {
                    tag: "ØªØ´ØºÙŠÙ„ÙŠ",
                    stage: "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
                    status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…",
                    title: "ØªØ­Ø³ÙŠÙ† Ù…Ø³Ø§Ø± ØªØ´ØºÙŠÙ„ÙŠ",
                    desc: "ØªØ­Ø³ÙŠÙ† Ø±Ø­Ù„Ø© ØªØ´ØºÙŠÙ„ÙŠØ© ÙˆØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ.",
                    problem: "ØªØ£Ø®Ø± ÙÙŠ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.",
                    beneficiary: "Ø§Ù„ÙØ±Ù‚ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©",
                    evidence: "ØªØ­Ù„ÙŠÙ„ Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø®Ù„Ø§Ù„ 90 ÙŠÙˆÙ…."
                },
                "patient-exp": {
                    tag: "ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªÙÙŠØ¯",
                    stage: "Ø§Ù„ÙÙƒØ±Ø©",
                    status: "Ù…Ø³ÙˆØ¯Ø©",
                    title: "ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯",
                    desc: "Ù…Ø¨Ø§Ø¯Ø±Ø© Ù„Ø±ÙØ¹ Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ ÙˆØªÙ‚Ù„ÙŠÙ„ Ø²Ù…Ù† Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.",
                    problem: "ØªØ°Ø¨Ø°Ø¨ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù….",
                    beneficiary: "Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙˆØ§Ù„Ø²ÙˆØ§Ø±",
                    evidence: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…ÙŠØ¯Ø§Ù†ÙŠØ© + Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª Ø±Ø¶Ø§."
                },
                "digital-ai": {
                    tag: "Ø±Ù‚Ù…Ù†Ø©",
                    stage: "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ",
                    status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",
                    title: "Ø­Ù„ Ø±Ù‚Ù…ÙŠ Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
                    desc: "ØªØ­ÙˆÙŠÙ„ Ø¥Ø¬Ø±Ø§Ø¡ ÙŠØ¯ÙˆÙŠ Ø¥Ù„Ù‰ Ø®Ø¯Ù…Ø© Ø±Ù‚Ù…ÙŠØ© Ø°ÙƒÙŠØ©.",
                    problem: "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙŠØ¯ÙˆÙŠØ© Ø¨Ø·ÙŠØ¦Ø©.",
                    beneficiary: "Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ† ÙˆØ§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†",
                    evidence: "Ù‚ÙŠØ§Ø³ Ø²Ù…Ù† Ø§Ù„Ø®Ø¯Ù…Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø±Ù‚Ù…Ù†Ø©."
                },
                "quality-compliance": {
                    tag: "Ø¬ÙˆØ¯Ø©",
                    stage: "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
                    status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…",
                    title: "ØªØ¹Ø²ÙŠØ² Ø¬ÙˆØ¯Ø© ÙˆØ§Ù…ØªØ«Ø§Ù„",
                    desc: "Ù…Ø¨Ø§Ø¯Ø±Ø© Ù„Ø¶Ø¨Ø· Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ±ÙØ¹ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ.",
                    problem: "ØªÙØ§ÙˆØª ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©.",
                    beneficiary: "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø±Ø§ÙÙŠØ©",
                    evidence: "ØªÙ‚Ø§Ø±ÙŠØ± ØªØ¯Ù‚ÙŠÙ‚ Ø¯Ø§Ø®Ù„ÙŠØ©."
                }
            };

            const openNew = () => $("#modalNew").classList.remove("hidden");
            const closeNew = () => $("#modalNew").classList.add("hidden");
            const openDetails = () => $("#modalDetails").classList.remove("hidden");
            const closeDetails = () => $("#modalDetails").classList.add("hidden");
            const openWelcome = () => $("#modalWelcome").classList.remove("hidden");
            const closeWelcome = () => $("#modalWelcome").classList.add("hidden");
            const openApiModal = () => {
                $("#apiBaseInput").value = getApiBase();
                $("#apiStateHint").textContent = "ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.";
                $("#modalApi").classList.remove("hidden");
            };
            const closeApiModal = () => $("#modalApi").classList.add("hidden");

            $$('[data-close]').forEach((b) => b.addEventListener("click", closeNew));
            $$("#modalNew .modal-backdrop").forEach((b) => b.addEventListener("click", closeNew));
            $$('[data-close2]').forEach((b) => b.addEventListener("click", closeDetails));
            $$("#modalDetails .modal-backdrop").forEach((b) => b.addEventListener("click", closeDetails));
            $$('[data-close-api]').forEach((b) => b.addEventListener("click", closeApiModal));
            $$("#modalApi .modal-backdrop").forEach((b) => b.addEventListener("click", closeApiModal));
            $$('[data-close-welcome]').forEach((b) => b.addEventListener("click", closeWelcome));
            $$("#modalWelcome .modal-backdrop").forEach((b) => b.addEventListener("click", closeWelcome));

            function getApiBase() {
                return (localStorage.getItem(API_BASE_KEY) || DEFAULT_API_BASE).replace(/\/+$/, "");
            }

            function setApiBase(nextBase) {
                const clean = String(nextBase || "").trim().replace(/\/+$/, "");
                if (!clean) return null;
                localStorage.setItem(API_BASE_KEY, clean);
                return clean;
            }

            function withTimeout(promise, ms = 3200) {
                let timer = null;
                const timeout = new Promise((_, reject) => {
                    timer = setTimeout(() => reject(new Error("REQUEST_TIMEOUT")), ms);
                });
                return Promise.race([promise, timeout]).finally(() => clearTimeout(timer));
            }

            async function apiRequest(path, { method = "GET", body, timeoutMs = 3200 } = {}) {
                const res = await withTimeout(fetch(`${getApiBase()}${path}`, {
                    method,
                    headers: { "Content-Type": "application/json" },
                    body: body ? JSON.stringify(body) : undefined
                }), timeoutMs);

                let json = null;
                try { json = await res.json(); } catch { json = null; }
                if (!res.ok) {
                    const msg = json?.error?.message || json?.message || `${res.status}`;
                    throw new Error(`API_${msg}`);
                }
                return json;
            }

            function mapStageToLocal(stageValue) {
                const raw = normalize(stageValue || "");
                const map = {
                    "idea_submission": "Ø§Ù„ÙÙƒØ±Ø©",
                    "screening": "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
                    "evaluation": "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
                    "team_formation": "ØªØ´ÙƒÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚",
                    "prototype": "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ",
                    "development": "Ø§Ù„ØªØ·ÙˆÙŠØ±",
                    "pilot": "Ø§Ù„ØªØ¬Ø±Ø¨Ø©",
                    "approval": "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯",
                    "legal_protection": "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯",
                    "launch": "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
                };
                if (map[raw]) return map[raw];
                return String(stageValue || "Ø§Ù„ÙÙƒØ±Ø©");
            }

            function mapStatusToLocal(statusValue) {
                const raw = normalize(statusValue || "");
                const map = {
                    "draft": "Ù…Ø³ÙˆØ¯Ø©",
                    "in_review": "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…",
                    "in_progress": "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",
                    "pilot": "Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©",
                    "approved": "Ù…Ø¹ØªÙ…Ø¯",
                    "rejected": "Ù…Ø±ÙÙˆØ¶",
                    "launched": "Ù…Ø·Ø¨Ù‚"
                };
                if (map[raw]) return map[raw];
                return String(statusValue || "Ù…Ø³ÙˆØ¯Ø©");
            }

            function mapStageToApi(stageValue) {
                const raw = normalize(stageValue || "");
                const map = {
                    "Ø§Ù„ÙÙƒØ±Ù‡": "idea_submission",
                    "Ø§Ù„ÙÙƒØ±Ø©": "idea_submission",
                    "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…": "evaluation",
                    "ØªØ´ÙƒÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚": "team_formation",
                    "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§ÙˆÙ„ÙŠ": "prototype",
                    "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ": "prototype",
                    "Ø§Ù„ØªØ·ÙˆÙŠØ±": "development",
                    "Ø§Ù„ØªØ¬Ø±Ø¨Ù‡": "pilot",
                    "Ø§Ù„ØªØ¬Ø±Ø¨Ø©": "pilot",
                    "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯": "approval",
                    "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚": "launch"
                };
                if (map[raw]) return map[raw];
                if (String(stageValue || "").includes("_")) return String(stageValue).trim();
                return "evaluation";
            }

            function mapStatusToApi(statusValue) {
                const raw = normalize(statusValue || "");
                const map = {
                    "Ù…Ø³ÙˆØ¯Ù‡": "draft",
                    "Ù…Ø³ÙˆØ¯Ø©": "draft",
                    "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…": "in_review",
                    "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±": "in_progress",
                    "Ù…Ø±Ø­Ù„Ù‡ Ø§Ù„ØªØ¬Ø±Ø¨Ù‡": "pilot",
                    "Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©": "pilot",
                    "Ù…Ø¹ØªÙ…Ø¯": "approved",
                    "Ù…Ø±ÙÙˆØ¶": "rejected",
                    "Ù…Ø·Ø¨Ù‚": "launched"
                };
                if (map[raw]) return map[raw];
                if (String(statusValue || "").includes("_")) return String(statusValue).trim();
                return "in_review";
            }

            function addDaysISO(days = 1) {
                const d = new Date();
                d.setDate(d.getDate() + Number(days || 0));
                return d.toISOString().slice(0, 10);
            }

            function ensureOpsState() {
                IS.state.notifications = Array.isArray(IS.state.notifications) ? IS.state.notifications : [];
                IS.state.gamification = IS.state.gamification || { points: 0, logs: [] };
                IS.state.gamification.logs = Array.isArray(IS.state.gamification.logs) ? IS.state.gamification.logs : [];
            }

            function pushNotification(message, initiativeId = "", type = "info") {
                ensureOpsState();
                IS.state.notifications.unshift({
                    id: newId("NF"),
                    at: nowISO(),
                    message: String(message || ""),
                    initiativeId: String(initiativeId || ""),
                    type: String(type || "info")
                });
                IS.state.notifications = IS.state.notifications.slice(0, 80);
            }

            function addPoints(points, reason = "", initiativeId = "") {
                ensureOpsState();
                const value = Math.max(0, Number(points || 0));
                IS.state.gamification.points = Math.max(0, Number(IS.state.gamification.points || 0) + value);
                IS.state.gamification.logs.unshift({
                    at: nowISO(),
                    points: value,
                    reason: String(reason || "Ù†Ø´Ø§Ø·"),
                    initiativeId: String(initiativeId || "")
                });
                IS.state.gamification.logs = IS.state.gamification.logs.slice(0, 120);
            }

            function getTeamById(teamId) {
                const teams = Array.isArray(IS.state.teams) ? IS.state.teams : [];
                if (!teams.length) return null;
                return teams.find((t) => t.id === teamId) || teams[0] || null;
            }

            function getTeamMembers(teamId) {
                const team = getTeamById(teamId);
                const members = Array.isArray(team?.members) ? team.members : [];
                return members.map((m) => ({
                    id: String(m.id || ""),
                    name: String(m.name || "Ø¹Ø¶Ùˆ"),
                    role: String(m.role || "Ø¹Ø¶Ùˆ"),
                    weight: Number(m.weight || 0)
                }));
            }

            function engagementScore(i) {
                const up = Math.max(0, Number(i?.engagement?.upvotes || 0));
                const down = Math.max(0, Number(i?.engagement?.downvotes || 0));
                const comments = Array.isArray(i?.comments) ? i.comments.length : 0;
                const files = Array.isArray(i?.files) ? i.files.length : 0;
                const doneTasks = Array.isArray(i?.tasks) ? i.tasks.filter((t) => t.col === "done").length : 0;
                const progress = clamp(i?.progress || 0, 0, 100);
                return Math.max(0, (up * 3) - down + (comments * 3) + (files * 2) + (doneTasks * 4) + Math.round(progress / 8));
            }

            function aiDraftFromInputs(input) {
                const x = input || {};
                const title = String(x.title || "Ù…Ø¨Ø§Ø¯Ø±Ø© ØªØ·ÙˆÙŠØ±");
                const domain = String(x.tag || "ØªØ´ØºÙŠÙ„ÙŠ");
                const beneficiary = String(x.beneficiary || "Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠÙŠÙ†");
                const problem = x.problem || `ØªÙˆØ¬Ø¯ ÙØ¬ÙˆØ© ØªØ´ØºÙŠÙ„ÙŠØ© ÙÙŠ ${domain} ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø©.`;
                const desc = x.desc || `Ø­Ù„ ${domain} Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ¹Ù„ÙŠØ© Ù„Ø±ÙØ¹ Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø²Ù…Ù† Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ.`;
                const pain = x.painPoints || `ØªØ£Ø®ÙŠØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§ØªØŒ ØªÙØ§ÙˆØª Ø§Ù„Ø¬ÙˆØ¯Ø©ØŒ ÙˆØ¶Ø¹Ù Ø§Ù„ØªØªØ¨Ø¹ ÙÙŠ ${domain}.`;
                const reco = x.recommendation || "Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ†Ù…ÙˆØ°Ø¬ Ø£ÙˆÙ„ÙŠ Ù…Ø¹ Ù‚ÙŠØ§Ø³ Ø£Ø«Ø± Ø´Ù‡Ø±ÙŠ.";
                const mvp = [
                    "Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø¢Ù†ÙŠØ© Ù„Ù„Ù…Ø¤Ø´Ø±Ø§Øª",
                    "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªØ¹Ø«Ø±Ø©",
                    "Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙˆØ­Ø¯ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                    "ØªÙ‚Ø±ÙŠØ± Ø£Ø«Ø± Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù„Ù„Ù‚ÙŠØ§Ø¯Ø©"
                ];
                return {
                    title,
                    problem,
                    desc,
                    beneficiary,
                    evidence: x.evidence || `ØªØ­Ù„ÙŠÙ„ Ø£ÙˆÙ„ÙŠ + Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ù…Ø¹ ${beneficiary}.`,
                    pain,
                    reco,
                    mvp
                };
            }

            function aiImprovementTips(i) {
                const tips = [];
                if (!String(i?.validation?.problem || "").trim()) tips.push("ÙˆØ¶Ù‘Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨ØµÙŠØ§ØºØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚ÙŠØ§Ø³.");
                if (!String(i?.validation?.evidence || "").trim()) tips.push("Ø£Ø¶Ù Ø¯Ù„ÙŠÙ„Ù‹Ø§ Ù…Ù† Ù…Ù‚Ø§Ø¨Ù„Ø§Øª/Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ´ØºÙŠÙ„ÙŠØ©.");
                if (!i?.prototype) tips.push("Ø£Ù†Ø´Ø¦ Ù†Ù…ÙˆØ°Ø¬Ù‹Ø§ Ø£ÙˆÙ„ÙŠÙ‹Ø§ Ø¨Ø³ÙŠØ·Ù‹Ø§ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙƒÙŠÙ….");
                if (calcRiskProfile(i?.riskProfile || {}).residualPct >= 60) tips.push("Ø®ÙÙ‘Ø¶ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø¨Ø®Ø·Ø© Mitigation ÙˆØ§Ø¶Ø­Ø©.");
                if (!isCoCreationReady(i)) tips.push("Ø§Ø³ØªÙƒÙ…Ù„ Patient Coâ€‘Creation (Ø¹ÙŠÙ†Ø© + ØªÙˆØµÙŠØ© ÙˆØ§Ø¶Ø­Ø©).");
                if (!tips.length) tips.push("Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…ÙƒØªÙ…Ù„Ø© Ù†Ø³Ø¨ÙŠÙ‹Ø§. Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯.");
                return tips;
            }

            function aiSolutionIdeas(i) {
                const domain = (i?.tags && i.tags[0]) ? i.tags[0] : "ØªØ´ØºÙŠÙ„ÙŠ";
                return [
                    `Ø§Ø¹ØªÙ…Ø¯ MVP Ù…Ø±Ø­Ù„ÙŠ (${domain}) Ù„Ù…Ø¯Ø© 4 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„ØªÙˆØ³Ø¹.`,
                    "Ù‚Ø³Ù‘Ù… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¥Ù„Ù‰ Quick Wins + ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ø¯Ù‰.",
                    "Ø§Ø±Ø¨Ø· Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ø§Ù„ÙˆÙ‚Øª/Ø§Ù„ØªÙƒÙ„ÙØ©/Ø§Ù„Ø±Ø¶Ø§) Ø¨Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.",
                    "ÙˆØ«Ù‘Ù‚ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø© Ù„Ø±ÙØ¹ Ø¬ÙˆØ¯Ø© Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ØªØ­ÙƒÙŠÙ… Ù„Ø§Ø­Ù‚Ù‹Ø§."
                ];
            }

            function autoCreateWorkspace(item, { aiTasks = true } = {}) {
                if (!item) return;
                item.tasks = Array.isArray(item.tasks) ? item.tasks : [];
                item.comments = Array.isArray(item.comments) ? item.comments : [];
                const members = getTeamMembers(item.ownerTeam);
                const owners = members.length ? members : [{ name: "Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©", role: "Ù‚ÙŠØ§Ø¯Ø©" }];
                const workflow = [
                    { title: "ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆÙ†Ø·Ø§Ù‚Ù‡Ø§", col: "todo", offset: 1 },
                    { title: "ØµÙŠØ§ØºØ© Ø§Ù„Ø­Ù„ ÙˆÙØ±Ø¶ÙŠØ§Øª Ø§Ù„Ù‚ÙŠÙ…Ø©", col: "todo", offset: 2 },
                    { title: "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ (MVP)", col: "todo", offset: 4 },
                    { title: "ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„ØªØ­ÙƒÙŠÙ…", col: "todo", offset: 6 }
                ];
                const has = new Set(item.tasks.map((t) => normalize(t.title || "")));
                workflow.forEach((w, idx) => {
                    if (has.has(normalize(w.title))) return;
                    const owner = owners[idx % owners.length];
                    item.tasks.push({
                        id: newId("TK"),
                        title: w.title,
                        owner: owner.name,
                        col: w.col,
                        due: addDaysISO(w.offset)
                    });
                });

                if (aiTasks) {
                    const aiWorkflow = [
                        "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ®Ø·Ø© Ø§Ù„ØªØ®ÙÙŠÙ",
                        "ØªÙ„Ø®ÙŠØµ Ø§Ù„Ù…Ù‚ØªØ±Ø­ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ Ù„Ù„Ù‚ÙŠØ§Ø¯Ø©"
                    ];
                    aiWorkflow.forEach((title, idx) => {
                        if (has.has(normalize(title))) return;
                        const owner = owners[(idx + 1) % owners.length];
                        item.tasks.push({
                            id: newId("TK"),
                            title,
                            owner: owner.name,
                            col: "todo",
                            due: addDaysISO(5 + idx)
                        });
                    });
                }

                item.comments.unshift({
                    id: newId("CM"),
                    text: "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ø¹ Ø®Ø·Ø© Ù…Ù‡Ø§Ù… Ø£ÙˆÙ„ÙŠØ©.",
                    author: "System Bot",
                    at: nowISO()
                });
                pushNotification(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Workspace ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ${item.id}.`, item.id, "workspace");
                addPoints(12, "ØªÙ‡ÙŠØ¦Ø© Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§", item.id);
            }

            function distributeTasksByAI(initiative) {
                if (!initiative) return 0;
                initiative.tasks = Array.isArray(initiative.tasks) ? initiative.tasks : [];
                const members = getTeamMembers(initiative.ownerTeam);
                if (!members.length) return 0;
                const targets = initiative.tasks.filter((t) => !String(t.owner || "").trim() || String(t.owner || "").trim() === "Ø¹Ø¶Ùˆ");
                targets.forEach((task, idx) => {
                    const owner = members[idx % members.length];
                    task.owner = owner.name;
                    if (!task.due) task.due = addDaysISO(idx + 2);
                });
                if (targets.length) {
                    initiative.comments = Array.isArray(initiative.comments) ? initiative.comments : [];
                    initiative.comments.unshift({
                        id: newId("CM"),
                        text: `AI ÙˆØ²Ù‘Ø¹ ${targets.length} Ù…Ù‡Ø§Ù… Ø¹Ù„Ù‰ ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©.`,
                        author: "AI Coâ€‘Pilot",
                        at: nowISO()
                    });
                    pushNotification(`ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¹Ø¨Ø± AI Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ${initiative.id}.`, initiative.id, "ai");
                    addPoints(8, "ØªÙˆØ²ÙŠØ¹ Ù…Ù‡Ø§Ù… Ø¹Ø¨Ø± AI", initiative.id);
                }
                return targets.length;
            }

            function calcRiskProfile(profile) {
                const p = profile || {};
                const vals = [
                    clamp(p.operational || 2, 1, 5),
                    clamp(p.financial || 2, 1, 5),
                    clamp(p.technical || 2, 1, 5),
                    clamp(p.quality || 2, 1, 5),
                    clamp(p.experience || 2, 1, 5)
                ];
                const avg = vals.reduce((a, b) => a + b, 0) / vals.length;
                const indexPct = Math.round((avg / 5) * 100);
                const mitigation = clamp(p.mitigationEffectivenessPct || 0, 0, 100);
                const residualPct = Math.round(indexPct * (1 - mitigation / 100));
                const level = residualPct >= 70 ? "Ù…Ø±ØªÙØ¹" : (residualPct >= 40 ? "Ù…ØªÙˆØ³Ø·" : "Ù…Ù†Ø®ÙØ¶");
                return { indexPct, residualPct, level };
            }

            function getScore(i) {
                if (Number.isFinite(Number(i?.score))) return clamp(i.score, 0, 100);
                const r = i?.rubric || {};
                const vals = ["problem", "feasible", "impact", "prototype", "risk"].map((k) => clamp(r[k] || 0, 0, 5));
                const sum = vals.reduce((a, b) => a + b, 0);
                return Math.round((sum / 25) * 100);
            }

            function calcMaturity(i) {
                const score = getScore(i);
                const progress = clamp(i?.prototype?.progress ?? i?.progress ?? 0, 0, 100);
                const validation = i?.validation || {};
                const v = ["problem", "beneficiary", "evidence"].filter((k) => String(validation[k] || "").trim()).length;
                const validationPct = Math.round((v / 3) * 100);
                const coCreationPct = calcCoCreationCoverage(i?.coCreation);
                return clamp(Math.round((score * 0.40) + (progress * 0.30) + (validationPct * 0.18) + (coCreationPct * 0.12)), 0, 100);
            }

            function calcCoCreationCoverage(coCreation) {
                const c = coCreation || {};
                const completed = [
                    Number(c.sampleSize || 0) > 0,
                    Number(c.score || 0) >= 1,
                    String(c.painPoints || "").trim().length > 0,
                    String(c.recommendation || "").trim().length > 0
                ].filter(Boolean).length;
                return Math.round((completed / 4) * 100);
            }

            function isCoCreationReady(i) {
                const c = i?.coCreation || {};
                return Number(c.sampleSize || 0) >= 5
                    && Number(c.score || 0) >= 3
                    && String(c.painPoints || "").trim().length > 0
                    && String(c.recommendation || "").trim().length > 0;
            }

            function inferPriority(i) {
                const maturity = calcMaturity(i);
                const risk = calcRiskProfile(i?.riskProfile || {}).residualPct;
                const urgency = Math.round((risk * 0.48) + ((100 - maturity) * 0.32) + ((100 - clamp(i?.progress || 0, 0, 100)) * 0.20));
                if (urgency >= 72) return "Ø­Ø±Ø¬Ø©";
                if (urgency >= 56) return "Ø¹Ø§Ù„ÙŠØ©";
                if (urgency >= 40) return "Ù…ØªÙˆØ³Ø·Ø©";
                return "Ù…Ù†Ø®ÙØ¶Ø©";
            }

            function bucketMaturity(i) {
                const m = calcMaturity(i);
                if (m >= 75) return "high";
                if (m >= 50) return "mid";
                return "low";
            }

            function bucketRisk(i) {
                const r = calcRiskProfile(i?.riskProfile || {}).residualPct;
                if (r >= 70) return "high";
                if (r >= 40) return "mid";
                return "low";
            }

            function ensureShape(i) {
                i.tags = Array.isArray(i.tags) ? i.tags : [];
                i.validation = i.validation || { problem: "", beneficiary: "", evidence: "" };
                i.coCreation = i.coCreation || { sampleSize: 0, score: null, painPoints: "", recommendation: "", updatedAt: null };
                i.engagement = i.engagement || { upvotes: 0, downvotes: 0, userVote: 0, updatedAt: null };
                i.engagement.upvotes = Math.max(0, Number(i.engagement.upvotes || 0));
                i.engagement.downvotes = Math.max(0, Number(i.engagement.downvotes || 0));
                i.engagement.userVote = clamp(i.engagement.userVote || 0, -1, 1);
                i.impact = i.impact || { costSaving: 0, timeSavingPct: 0, implementationCost: 0, operatingCost: 0, horizonYears: 3, confidencePct: 75 };
                i.riskProfile = i.riskProfile || { operational: 2, financial: 2, technical: 2, quality: 2, experience: 2, mitigationEffectivenessPct: 0, mitigationPlan: "", owner: "", reviewCycle: "Ø´Ù‡Ø±ÙŠ" };
                i.postMonitoring = i.postMonitoring || {
                    owner: "",
                    notes: "",
                    expected: { annualSaving: 0, timeSavingPct: 0 },
                    m3: { annualSaving: null, timeSavingPct: null, qualityImprovementPct: null, satisfactionPct: null, recordedAt: null },
                    m6: { annualSaving: null, timeSavingPct: null, qualityImprovementPct: null, satisfactionPct: null, recordedAt: null }
                };
                i.tasks = Array.isArray(i.tasks) ? i.tasks : [];
                i.comments = Array.isArray(i.comments) ? i.comments : [];
                i.files = Array.isArray(i.files) ? i.files : [];
                i.changeLog = Array.isArray(i.changeLog) ? i.changeLog : [];
                i.ownerTeam = String(i.ownerTeam || getTeamById()?.id || "T-1001");
                i.organization = String(i.organization || i.org || i.department || "Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ØµØ­ÙŠ Ø¨Ø§Ù„Ø·Ø§Ø¦Ù");
                i.score = Number.isFinite(Number(i.score)) ? clamp(i.score, 0, 100) : i.score ?? null;
                i.stage = i.stage || "Ø§Ù„ÙÙƒØ±Ø©";
                i.status = i.status || "Ù…Ø³ÙˆØ¯Ø©";
                i.progress = clamp(i.progress || i.prototype?.progress || 0, 0, 100);
                i.updatedAt = i.updatedAt || nowISO();
                i.priority = i.priority || inferPriority(i);
            }

            function normalizeState() {
                ensureOpsState();
                IS.state.initiatives = IS.state.initiatives || [];
                IS.state.initiatives.forEach(ensureShape);
            }

            function addChange(i, action, details = "") {
                if (!i) return;
                i.changeLog = Array.isArray(i.changeLog) ? i.changeLog : [];
                i.changeLog.unshift({ at: nowISO(), action, details });
                if (i.changeLog.length > 80) i.changeLog = i.changeLog.slice(0, 80);
            }

            function getTaxonomy() {
                return IS.state.taxonomy || ["ØªÙ‚Ù†ÙŠ", "ØªØ´ØºÙŠÙ„ÙŠ", "Ø³Ø±ÙŠØ±ÙŠ", "ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªÙÙŠØ¯", "Ø¬ÙˆØ¯Ø©", "Ù…Ø§Ù„ÙŠ", "Ø±Ù‚Ù…Ù†Ø©"];
            }

            function fillStages() {
                const st = IS.state.stages || ["Ø§Ù„ÙÙƒØ±Ø©", "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", "ØªØ´ÙƒÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚", "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ", "Ø§Ù„ØªØ·ÙˆÙŠØ±", "Ø§Ù„ØªØ¬Ø±Ø¨Ø©", "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯", "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"];
                $("#nStage").innerHTML = st.map((s) => `<option>${esc(s)}</option>`).join("");
                $("#dStage").innerHTML = st.map((s) => `<option>${esc(s)}</option>`).join("");
            }

            function fillTaxonomy() {
                const taxonomy = getTaxonomy();
                $("#tag").innerHTML = `<option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>` + taxonomy.map((t) => `<option>${esc(t)}</option>`).join("");
                $("#nTag").innerHTML = taxonomy.map((t) => `<option>${esc(t)}</option>`).join("");
            }

            function fillTeams() {
                const teams = Array.isArray(IS.state.teams) ? IS.state.teams : [];
                const node = $("#nTeam");
                if (!node) return;
                const keep = node.value;
                node.innerHTML = teams.length
                    ? teams.map((t) => `<option value="${esc(t.id)}">${esc(t.name || t.id)}</option>`).join("")
                    : `<option value="T-1001">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>`;
                if (keep && teams.some((t) => t.id === keep)) node.value = keep;
            }

            function updateNewHintByTeam() {
                const node = $("#nHint");
                const team = getTeamById($("#nTeam")?.value);
                if (!node) return;
                if (!team) {
                    node.textContent = "Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ + Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚.";
                    return;
                }
                const members = (team.members || []).map((m) => m.name).filter(Boolean);
                node.textContent = `Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø®ØªØ§Ø±: ${team.name} (${members.join("ØŒ ") || "Ø¨Ø¯ÙˆÙ† Ø£Ø¹Ø¶Ø§Ø¡"}) â€¢ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Workspace ØªÙ„Ù‚Ø§Ø¦ÙŠ.`;
            }

            function fillOrgFilter() {
                const inis = IS.state.initiatives || [];
                const node = $("#orgFilter");
                const keep = node.value;
                const orgs = Array.from(new Set(inis.map((i) => String(i.organization || "").trim()).filter(Boolean)));
                node.innerHTML = `<option value="">ÙƒÙ„ Ø§Ù„Ø¬Ù‡Ø§Øª</option>${orgs.map((o) => `<option>${esc(o)}</option>`).join("")}`;
                if (orgs.includes(keep)) node.value = keep;
            }

            function semanticMatch(i, query) {
                const q = normalize(query);
                if (!q) return true;
                const bag = normalize([
                    i.id,
                    i.title,
                    i.stage,
                    i.status,
                    i.organization,
                    i.priority,
                    ...(i.tags || []),
                    i.validation?.problem,
                    i.validation?.beneficiary,
                    i.validation?.evidence,
                    i.coCreation?.painPoints,
                    i.coCreation?.recommendation,
                    ...(i.comments || []).map((c) => c.text)
                ].join(" "));
                const tokens = q.split(" ").filter(Boolean);
                return tokens.every((tok) => {
                    const alias = SEARCH_ALIASES[tok];
                    return bag.includes(tok) || (alias && bag.includes(normalize(alias)));
                });
            }

            function getFilters() {
                return {
                    q: normalize($("#q").value || ""),
                    qSemantic: normalize($("#qSemantic").value || ""),
                    status: ($("#status").value || "").trim(),
                    tag: ($("#tag").value || "").trim(),
                    maturity: ($("#maturityFilter").value || "").trim(),
                    risk: ($("#riskFilter").value || "").trim(),
                    priority: ($("#priorityFilter").value || "").trim(),
                    org: ($("#orgFilter").value || "").trim(),
                    dateFrom: $("#dateFrom").value || "",
                    dateTo: $("#dateTo").value || ""
                };
            }

            function filteredInitiatives() {
                const f = getFilters();
                const inis = IS.state.initiatives || [];
                return inis.filter((i) => {
                    const hay = normalize(`${i.id} ${i.title} ${(i.tags || []).join(" ")} ${i.stage} ${i.status} ${i.organization} ${i.priority}`);
                    const okQ = !f.q || hay.includes(f.q);
                    const okSemantic = !f.qSemantic || semanticMatch(i, f.qSemantic);
                    const okStatus = !f.status || i.status === f.status;
                    const okTag = !f.tag || (i.tags || []).includes(f.tag);
                    const okMaturity = !f.maturity || bucketMaturity(i) === f.maturity;
                    const okRisk = !f.risk || bucketRisk(i) === f.risk;
                    const okPriority = !f.priority || i.priority === f.priority;
                    const okOrg = !f.org || i.organization === f.org;

                    const updated = new Date(i.updatedAt || i.createdAt || nowISO());
                    const from = f.dateFrom ? new Date(`${f.dateFrom}T00:00:00`) : null;
                    const to = f.dateTo ? new Date(`${f.dateTo}T23:59:59`) : null;
                    const okDateFrom = !from || updated >= from;
                    const okDateTo = !to || updated <= to;

                    return okQ && okSemantic && okStatus && okTag && okMaturity && okRisk && okPriority && okOrg && okDateFrom && okDateTo;
                }).sort((a, b) => {
                    const pa = PRIORITY_RANK[a.priority] || 0;
                    const pb = PRIORITY_RANK[b.priority] || 0;
                    if (pb !== pa) return pb - pa;
                    return new Date(b.updatedAt || 0).getTime() - new Date(a.updatedAt || 0).getTime();
                });
            }

            function badgeClass(i) {
                return (i.status === "Ù…Ø¹ØªÙ…Ø¯" || i.status === "Ù…Ø·Ø¨Ù‚") ? "is-good"
                    : (i.status === "Ù…Ø±ÙÙˆØ¶") ? "is-mid"
                        : (i.stage === "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ") ? "is-mid"
                            : "is-low";
            }

            function renderStageMiniAnalytics(list) {
                const stages = IS.state.stages || [];
                const rows = stages.map((s) => {
                    const bucket = list.filter((i) => i.stage === s);
                    const count = bucket.length;
                    const maturity = count ? Math.round(bucket.reduce((sum, i) => sum + calcMaturity(i), 0) / count) : 0;
                    const risk = count ? Math.round(bucket.reduce((sum, i) => sum + calcRiskProfile(i.riskProfile).residualPct, 0) / count) : 0;
                    return { stage: s, count, maturity, risk };
                });

                $("#stageMiniAnalytics").innerHTML = rows.map((r) => `
                    <article class="stage-mini-card">
                        <p>${esc(r.stage)}</p>
                        <strong>${fmt(r.count)} Ù…Ø¨Ø§Ø¯Ø±Ø©</strong>
                        <small>Ù†Ø¶Ø¬ Ù…ØªÙˆØ³Ø·: ${r.maturity}%</small>
                        <small>Ø®Ø·Ø± Ù…ØªØ¨Ù‚ÙŠ: ${r.risk}%</small>
                    </article>
                `).join("");
            }

            function renderKpiVisuals(list) {
                const total = Math.max(1, list.length);
                const statusRows = [
                    { key: "Ù…Ø³ÙˆØ¯Ø©", label: "Ù…Ø³ÙˆØ¯Ø©", color: "linear-gradient(90deg, rgba(154,170,191,.95), rgba(119,136,156,.9))" },
                    { key: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…", label: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…", color: "linear-gradient(90deg, rgba(255,196,92,.95), rgba(255,149,85,.9))" },
                    { key: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±", label: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±", color: "linear-gradient(90deg, rgba(89,166,255,.95), rgba(86,214,255,.9))" },
                    { key: "Ù…Ø¹ØªÙ…Ø¯", label: "Ù…Ø¹ØªÙ…Ø¯", color: "linear-gradient(90deg, rgba(76,227,143,.95), rgba(66,246,231,.9))" },
                    { key: "Ù…Ø·Ø¨Ù‚", label: "Ù…Ø·Ø¨Ù‚", color: "linear-gradient(90deg, rgba(57,229,140,.95), rgba(98,255,189,.9))" },
                    { key: "Ù…Ø±ÙÙˆØ¶", label: "Ù…Ø±ÙÙˆØ¶", color: "linear-gradient(90deg, rgba(255,103,129,.95), rgba(255,77,109,.9))" }
                ];

                $("#kpiStatusBars").innerHTML = statusRows.map((row) => {
                    const count = list.filter((i) => i.status === row.key).length;
                    const pct = Math.round((count / total) * 100);
                    return `
                        <div class="kpi-row">
                            <strong>${esc(row.label)}</strong>
                            <div class="kpi-track"><span style="width:${pct}%; background:${row.color};"></span></div>
                            <small>${fmt(count)} â€¢ ${pct}%</small>
                        </div>
                    `;
                }).join("");

                const avgProgress = list.length ? Math.round(list.reduce((sum, i) => sum + clamp(i.progress || 0, 0, 100), 0) / list.length) : 0;
                const avgMaturity = list.length ? Math.round(list.reduce((sum, i) => sum + calcMaturity(i), 0) / list.length) : 0;
                const avgCoCreation = list.length ? Math.round(list.reduce((sum, i) => sum + calcCoCreationCoverage(i.coCreation), 0) / list.length) : 0;
                const avgRisk = list.length ? Math.round(list.reduce((sum, i) => sum + calcRiskProfile(i.riskProfile).residualPct, 0) / list.length) : 0;
                const avgSafety = clamp(100 - avgRisk, 0, 100);

                const healthRows = [
                    { label: "ØªÙ‚Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°", value: avgProgress, color: "linear-gradient(90deg, rgba(77,168,255,.95), rgba(66,246,231,.85))" },
                    { label: "Ù†Ø¶Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª", value: avgMaturity, color: "linear-gradient(90deg, rgba(169,112,255,.95), rgba(77,168,255,.9))" },
                    { label: "Ø¬Ø§Ù‡Ø²ÙŠØ© Coâ€‘Creation", value: avgCoCreation, color: "linear-gradient(90deg, rgba(66,246,231,.95), rgba(111,255,196,.9))" },
                    { label: "Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±", value: avgSafety, color: "linear-gradient(90deg, rgba(125,238,180,.95), rgba(66,246,231,.85))" }
                ];

                $("#kpiHealthBars").innerHTML = healthRows.map((row) => `
                    <div class="kpi-row">
                        <strong>${esc(row.label)}</strong>
                        <div class="kpi-track"><span style="width:${clamp(row.value, 0, 100)}%; background:${row.color};"></span></div>
                        <small>${fmt(clamp(row.value, 0, 100))}%</small>
                    </div>
                `).join("");

                const readyCount = list.filter((i) => {
                    const hasCore = String(i.validation?.problem || "").trim() && String(i.validation?.beneficiary || "").trim();
                    const hasWork = (i.tasks || []).length >= 3 && ((i.prototype && i.prototype.progress >= 30) || i.progress >= 35);
                    return hasCore && hasWork;
                }).length;
                const approvedCount = list.filter((i) => ["Ù…Ø¹ØªÙ…Ø¯", "Ù…Ø·Ø¨Ù‚"].includes(i.status)).length;
                const highPriorityCount = list.filter((i) => ["Ø­Ø±Ø¬Ø©", "Ø¹Ø§Ù„ÙŠØ©"].includes(i.priority)).length;
                const avgEngagement = list.length
                    ? Math.round(list.reduce((sum, i) => sum + engagementScore(i), 0) / list.length)
                    : 0;

                const ringRows = [
                    { label: "Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„ØªØ­ÙƒÙŠÙ…", value: Math.round((readyCount / total) * 100), color: "rgba(77,168,255,.96)" },
                    { label: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯/Ø§Ù„ØªØ·Ø¨ÙŠÙ‚", value: Math.round((approvedCount / total) * 100), color: "rgba(57,229,140,.96)" },
                    { label: "Ù…Ø¤Ø´Ø± Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø®Ø§Ø·Ø±", value: avgSafety, color: "rgba(66,246,231,.96)" },
                    { label: "Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙØ§Ø¹Ù„", value: clamp(avgEngagement, 0, 100), color: "rgba(169,112,255,.96)" }
                ];

                $("#kpiImpactRings").innerHTML = ringRows.map((r) => `
                    <article class="impact-ring">
                        <div class="ring" style="--pct:${clamp(r.value, 0, 100)}; --clr:${r.color};"><b>${fmt(clamp(r.value, 0, 100))}%</b></div>
                        <p>${esc(r.label)}</p>
                    </article>
                `).join("");

                const sparkSvg = $("#kpiSparkline");
                const sparkPath = $("#kpiSparkPath");
                const sparkDots = $("#kpiSparkDots");
                const sparkMeta = $("#kpiSparklineMeta");
                if (sparkSvg && sparkPath && sparkDots && sparkMeta) {
                    const stages = IS.state.stages || [];
                    const values = stages.map((s) => list.filter((i) => i.stage === s).length);
                    const width = 320;
                    const height = 126;
                    const pad = 16;
                    const maxVal = Math.max(1, ...values);
                    const step = values.length > 1 ? (width - (pad * 2)) / (values.length - 1) : 0;
                    const points = values.map((v, idx) => {
                        const x = pad + (idx * step);
                        const ratio = maxVal ? (v / maxVal) : 0;
                        const y = height - pad - (ratio * (height - (pad * 2)));
                        return { x, y, v };
                    });
                    const d = points.map((p, idx) => `${idx ? "L" : "M"}${p.x.toFixed(2)} ${p.y.toFixed(2)}`).join(" ");
                    sparkPath.setAttribute("d", d || "");
                    sparkDots.innerHTML = points.map((p, idx) => `
                        <circle cx="${p.x.toFixed(2)}" cy="${p.y.toFixed(2)}" r="3.2" fill="rgba(66,246,231,.95)">
                            <title>${esc(stages[idx] || "")}: ${fmt(p.v)}</title>
                        </circle>
                    `).join("");
                    const maxIdx = points.reduce((best, p, idx, arr) => p.v > arr[best].v ? idx : best, 0);
                    const maxStage = stages[maxIdx] || "â€”";
                    const maxCount = points[maxIdx]?.v || 0;
                    sparkMeta.textContent = `Ø£Ø¹Ù„Ù‰ ØªØ±ÙƒØ² Ø­Ø§Ù„ÙŠ ÙÙŠ Ù…Ø±Ø­Ù„Ø©: ${maxStage} (${fmt(maxCount)} Ù…Ø¨Ø§Ø¯Ø±Ø©) â€¢ Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø¹Ø§Ù„ÙŠØ©/Ø­Ø±Ø¬Ø©: ${fmt(highPriorityCount)}.`;
                }
            }

            function honorBadge(points, rank) {
                if (rank === 0 && points >= 12) return { label: "ğŸ† Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±", cls: "is-good" };
                if (points >= 24) return { label: "ğŸ¥‡ Ù…Ø³Ø§Ù‡Ù… Ø°Ù‡Ø¨ÙŠ", cls: "is-good" };
                if (points >= 14) return { label: "ğŸ¥ˆ Ù…Ø³Ø§Ù‡Ù… Ù†Ø´Ø·", cls: "is-mid" };
                if (points >= 8) return { label: "ğŸ¥‰ Ù…ØªØ¹Ø§ÙˆÙ† ÙØ¹Ù‘Ø§Ù„", cls: "is-low" };
                return { label: "â­ Ø¹Ø¶Ùˆ Ù…Ø´Ø§Ø±Ùƒ", cls: "is-low" };
            }

            function renderHonorBoard(list) {
                const users = new Map();
                const touch = (name, delta, kind) => {
                    const clean = String(name || "").trim();
                    if (!clean) return;
                    const row = users.get(clean) || { name: clean, score: 0, comments: 0, done: 0, files: 0 };
                    row.score += Math.max(0, Number(delta || 0));
                    if (kind === "comment") row.comments += 1;
                    if (kind === "done") row.done += 1;
                    if (kind === "file") row.files += 1;
                    users.set(clean, row);
                };

                list.forEach((i) => {
                    (i.comments || []).forEach((c) => touch(c.author || "Ù…ÙˆØ¸Ù", 3, "comment"));
                    (i.tasks || []).forEach((t) => {
                        if (t.col === "done") touch(t.owner || "Ù…ÙˆØ¸Ù", 5, "done");
                        else if (t.col === "doing") touch(t.owner || "Ù…ÙˆØ¸Ù", 3, "task");
                        else touch(t.owner || "Ù…ÙˆØ¸Ù", 1, "task");
                    });
                    (i.files || []).forEach((f) => touch(f.addedBy || "Ù…ÙˆØ¸Ù", 2, "file"));
                });

                const top = Array.from(users.values())
                    .sort((a, b) => (b.score - a.score) || (b.done - a.done) || (b.comments - a.comments))
                    .slice(0, 6);

                $("#honorBoardList").innerHTML = top.length ? top.map((u, idx) => {
                    const badge = honorBadge(u.score, idx);
                    return `
                        <li class="honor-item">
                            <strong>${esc(u.name)}</strong>
                            <div class="meta">
                                <span class="status-badge ${badge.cls}">${badge.label}</span>
                                <span class="status-badge is-low">Ù†Ù‚Ø§Ø· ${fmt(u.score)}</span>
                                <span class="status-badge is-low">ØªØ¹Ù„ÙŠÙ‚Ø§Øª ${fmt(u.comments)}</span>
                                <span class="status-badge is-low">Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø© ${fmt(u.done)}</span>
                                <span class="status-badge is-low">Ù…Ù„ÙØ§Øª ${fmt(u.files)}</span>
                            </div>
                        </li>
                    `;
                }).join("") : `<li class="honor-item"><strong>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ø§Ù‡Ù…Ø§Øª ÙƒØ§ÙÙŠØ© Ø¨Ø¹Ø¯.</strong><p style="margin:0; color:var(--muted2);">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø£Ùˆ Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ù„ØªØ¸Ù‡Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</p></li>`;
            }

            function renderHeatmap(list) {
                const stages = IS.state.stages || [];
                const maxCount = Math.max(1, ...stages.map((s) => list.filter((i) => i.stage === s).length));
                $("#mapHeat").innerHTML = stages.map((s) => {
                    const items = list.filter((i) => i.stage === s);
                    const high = items.filter((i) => i.priority === "Ø­Ø±Ø¬Ø©" || i.priority === "Ø¹Ø§Ù„ÙŠØ©").length;
                    const heat = (items.length / maxCount) * 0.85;
                    return `
                        <article class="heat-cell" style="--heat:${heat.toFixed(2)};">
                            <strong>${esc(s)}</strong>
                            <small>${fmt(items.length)} Ø¥Ø¬Ù…Ø§Ù„ÙŠ â€¢ ${fmt(high)} Ø¹Ø§Ù„ÙŠ/Ø­Ø±Ø¬</small>
                        </article>
                    `;
                }).join("");
            }

            function renderCriticalQueue(list) {
                const critical = list.filter((i) => i.priority === "Ø­Ø±Ø¬Ø©" || i.priority === "Ø¹Ø§Ù„ÙŠØ©").slice(0, 10);
                $("#criticalList").innerHTML = critical.length ? critical.map((i) => {
                    const maturity = calcMaturity(i);
                    const risk = calcRiskProfile(i.riskProfile).residualPct;
                    const coReady = isCoCreationReady(i);
                    return `
                        <li>
                            <strong>${esc(i.id)} â€” ${esc(i.title)}</strong>
                            <div class="meta">
                                <span class="status-badge ${i.priority === "Ø­Ø±Ø¬Ø©" ? "is-bad" : "is-mid"}">${esc(i.priority)}</span>
                                <span class="status-badge is-low">Ù†Ø¶Ø¬ ${maturity}%</span>
                                <span class="status-badge ${risk >= 70 ? "is-bad" : (risk >= 40 ? "is-mid" : "is-good")}">Ø®Ø·Ø± ${risk}%</span>
                                <span class="status-badge ${coReady ? "is-good" : "is-mid"}">${coReady ? "Coâ€‘Creation Ø¬Ø§Ù‡Ø²" : "Coâ€‘Creation Ù†Ø§Ù‚Øµ"}</span>
                                <button class="btn btn-soft sm" data-open="${esc(i.id)}">ØªÙØ§ØµÙŠÙ„</button>
                                <button class="btn btn-ghost sm" data-j="${esc(i.id)}">ØªØ­ÙƒÙŠÙ…</button>
                                <button class="btn btn-ghost sm" data-e="${esc(i.id)}">Ù…ÙˆØ¸Ù</button>
                            </div>
                        </li>
                    `;
                }).join("") : `<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø­Ø±Ø¬Ø© Ø£Ùˆ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹.</li>`;

                $$('[data-open]', $("#criticalList")).forEach((b) => b.addEventListener("click", () => showDetails(b.getAttribute("data-open"))));
                $$('[data-j]', $("#criticalList")).forEach((b) => b.addEventListener("click", () => goJudging(b.getAttribute("data-j"))));
                $$('[data-e]', $("#criticalList")).forEach((b) => b.addEventListener("click", () => goEmployee(b.getAttribute("data-e"))));
            }

            function voteInitiative(id, direction = 1) {
                const i = (IS.state.initiatives || []).find((x) => x.id === id);
                if (!i) return;
                ensureShape(i);
                const dir = direction >= 0 ? 1 : -1;
                const prev = Number(i.engagement?.userVote || 0);
                if (dir === 1) {
                    if (prev === 1) {
                        i.engagement.upvotes = Math.max(0, Number(i.engagement.upvotes || 0) - 1);
                        i.engagement.userVote = 0;
                    } else {
                        i.engagement.upvotes = Math.max(0, Number(i.engagement.upvotes || 0) + 1);
                        if (prev === -1) i.engagement.downvotes = Math.max(0, Number(i.engagement.downvotes || 0) - 1);
                        i.engagement.userVote = 1;
                    }
                } else {
                    if (prev === -1) {
                        i.engagement.downvotes = Math.max(0, Number(i.engagement.downvotes || 0) - 1);
                        i.engagement.userVote = 0;
                    } else {
                        i.engagement.downvotes = Math.max(0, Number(i.engagement.downvotes || 0) + 1);
                        if (prev === 1) i.engagement.upvotes = Math.max(0, Number(i.engagement.upvotes || 0) - 1);
                        i.engagement.userVote = -1;
                    }
                }
                i.engagement.updatedAt = nowISO();
                i.updatedAt = nowISO();
                addChange(i, "ØªØµÙˆÙŠØª", dir === 1 ? "Ø¯Ø¹Ù… Ø§Ù„ÙÙƒØ±Ø©" : "ØªØ­ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ÙÙƒØ±Ø©");
                IS.audit("ØªØµÙˆÙŠØª Ø¹Ù„Ù‰ Ù…Ø¨Ø§Ø¯Ø±Ø©", `${i.id} â€¢ ${dir === 1 ? "UP" : "DOWN"}`);
                IS.save();
                renderAll();
            }

            function renderWorkspaceHub(list) {
                const all = IS.state.initiatives || [];
                const ready = all.filter((i) => {
                    const hasCore = String(i.validation?.problem || "").trim() && String(i.validation?.beneficiary || "").trim();
                    const hasWork = (i.tasks || []).length >= 3 && ((i.prototype && i.prototype.progress >= 30) || i.progress >= 35);
                    return hasCore && hasWork;
                }).length;
                ensureOpsState();
                const notifications = IS.state.notifications || [];
                const points = Number(IS.state.gamification?.points || 0);

                $("#wsTotal").textContent = fmt(all.length);
                $("#wsReady").textContent = fmt(ready);
                $("#wsNotifications").textContent = fmt(notifications.length);
                $("#wsPoints").textContent = fmt(points);

                const latestAlerts = notifications.slice(0, 4);
                $("#workspaceAlerts").innerHTML = latestAlerts.length
                    ? latestAlerts.map((n) => `<li>${esc(n.message || "ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯")} ${n.initiativeId ? `<span class="status-badge is-low">${esc(n.initiativeId)}</span>` : ""}</li>`).join("")
                    : `<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©. Ø§Ø¨Ø¯Ø£ Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ø¢Ù†.</li>`;

                const top = [...list]
                    .sort((a, b) => engagementScore(b) - engagementScore(a))
                    .slice(0, 6);
                $("#topEngagementList").innerHTML = top.length ? top.map((i) => {
                    const score = engagementScore(i);
                    const up = Math.max(0, Number(i.engagement?.upvotes || 0));
                    const down = Math.max(0, Number(i.engagement?.downvotes || 0));
                    return `
                        <li>
                            <strong>${esc(i.id)} â€” ${esc(i.title)}</strong>
                            <div class="meta">
                                <span class="status-badge is-good">ØªÙØ§Ø¹Ù„ ${fmt(score)}</span>
                                <span class="status-badge is-low">ØªØ¹Ù„ÙŠÙ‚Ø§Øª ${fmt((i.comments || []).length)}</span>
                                <span class="status-badge is-low">Ù…Ù‡Ø§Ù… Ù…Ù†Ø¬Ø²Ø© ${fmt((i.tasks || []).filter((t) => t.col === "done").length)}</span>
                                <button class="btn btn-soft sm" data-open-eng="${esc(i.id)}">ØªÙØ§ØµÙŠÙ„</button>
                            </div>
                            <div class="vote-row">
                                <button class="btn btn-soft sm" data-vote-up="${esc(i.id)}">ğŸ‘ ${fmt(up)}</button>
                                <button class="btn btn-ghost sm" data-vote-down="${esc(i.id)}">ğŸ‘ ${fmt(down)}</button>
                            </div>
                        </li>
                    `;
                }).join("") : `<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØ§Ø¹Ù„ ÙƒØ§ÙÙŠØ© Ø¨Ø¹Ø¯.</li>`;

                $$('[data-open-eng]', $("#topEngagementList")).forEach((b) => b.addEventListener("click", () => showDetails(b.getAttribute("data-open-eng"))));
                $$('[data-vote-up]', $("#topEngagementList")).forEach((b) => b.addEventListener("click", () => voteInitiative(b.getAttribute("data-vote-up"), 1)));
                $$('[data-vote-down]', $("#topEngagementList")).forEach((b) => b.addEventListener("click", () => voteInitiative(b.getAttribute("data-vote-down"), -1)));
            }

            function goJudging(id) {
                const ini = (IS.state.initiatives || []).find((x) => x.id === id);
                if (ini && !isCoCreationReady(ini)) {
                    const sample = Math.max(0, Number(ini.coCreation?.sampleSize || 0));
                    const score = Number(ini.coCreation?.score || 0);
                    const proceed = window.confirm(`ØªÙ†Ø¨ÙŠÙ‡: Ø¨ÙŠØ§Ù†Ø§Øª Patient Coâ€‘Creation ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© (${sample} Ø¹ÙŠÙ†Ø© â€¢ ${score ? `${score}/5` : "Ø¨Ø¯ÙˆÙ† ØªÙ‚ÙŠÙŠÙ…"}).\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„ØªØ­ÙƒÙŠÙ…ØŸ`);
                    if (!proceed) {
                        IS.toast("ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø­ØªÙ‰ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Coâ€‘Creation.", "warn", 2100);
                        return;
                    }
                }
                IS.setSelectedInitiative(id);
                IS.audit("ÙØªØ­ Ø§Ù„ØªØ­ÙƒÙŠÙ… Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©", id);
                IS.save();
                location.href = "../judging/index.html";
            }

            function goEmployee(id) {
                IS.setSelectedInitiative(id);
                IS.audit("ÙØªØ­ Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©", id);
                IS.save();
                location.href = "../employee/index.html";
            }

            function renderBoard(list) {
                const stages = IS.state.stages || [];
                $("#pill").textContent = `${fmt(list.length)} Ù†ØªØ§Ø¦Ø¬`;

                board.innerHTML = stages.map((s) => `
                    <section class="col" data-stage="${esc(s)}">
                        <div class="col-head">
                            <h3>${esc(s)}</h3>
                            <span class="table-count">${fmt(list.filter((i) => i.stage === s).length)}</span>
                        </div>
                        <div class="dropzone" data-drop="${esc(s)}"></div>
                    </section>
                `).join("");

                $$(".dropzone").forEach((z) => {
                    z.addEventListener("dragover", (e) => {
                        e.preventDefault();
                        z.classList.add("is-over");
                    });
                    z.addEventListener("dragleave", () => z.classList.remove("is-over"));
                    z.addEventListener("drop", async (e) => {
                        e.preventDefault();
                        z.classList.remove("is-over");
                        const id = e.dataTransfer.getData("text/is_id");
                        const toStage = z.getAttribute("data-drop");
                        await moveToStage(id, toStage);
                    });
                });

                list.forEach((i) => {
                    const zone = document.querySelector(`.dropzone[data-drop="${i.stage}"]`);
                    if (!zone) return;
                    const tag = (i.tags && i.tags[0]) ? i.tags[0] : "â€”";
                    const score = Number.isFinite(Number(i.score)) ? `${clamp(i.score, 0, 100)}%` : "â€”";
                    const prog = clamp(i.progress || 0, 0, 100);
                    const risk = calcRiskProfile(i.riskProfile).residualPct;
                    const maturity = calcMaturity(i);
                    const protoProgress = clamp(i.prototype?.progress || 0, 0, 100);
                    const coCoverage = calcCoCreationCoverage(i.coCreation);
                    const coSample = Math.max(0, Number(i.coCreation?.sampleSize || 0));
                    const coScore = Number(i.coCreation?.score || 0);
                    const up = Math.max(0, Number(i.engagement?.upvotes || 0));
                    const down = Math.max(0, Number(i.engagement?.downvotes || 0));
                    const interact = engagementScore(i);

                    const card = document.createElement("article");
                    card.className = "kan-card";
                    card.setAttribute("draggable", "true");
                    card.setAttribute("data-id", i.id);
                    card.innerHTML = `
                        <div class="khead">
                            <div class="kid">${esc(i.id)}</div>
                            <span class="status-badge ${badgeClass(i)}">${esc(i.status || "Ù…Ø³ÙˆØ¯Ø©")}</span>
                        </div>
                        <div class="ktitle">${esc(i.title || "")}</div>
                        <div class="kmeta">
                            <span class="status-badge is-low">${esc(tag)}</span>
                            <span class="status-badge ${i.priority === "Ø­Ø±Ø¬Ø©" ? "is-bad" : (i.priority === "Ø¹Ø§Ù„ÙŠØ©" ? "is-mid" : "is-low")}">${esc(i.priority)}</span>
                        </div>
                        <div class="mini">
                            <div class="mini-progress"><span style="width:${prog}%"></span></div>
                            <small>ØªÙ‚Ø¯Ù…: ${fmt(prog)}% â€¢ Ù†ØªÙŠØ¬Ø©: ${score}</small>
                        </div>
                        <div class="map-card-kpis">
                            <small>Ù†Ø¶Ø¬: ${maturity}% â€¢ Ø®Ø·Ø±: ${risk}%</small>
                            <small>Ø¬Ù‡Ø©: ${esc(i.organization || "â€”")}</small>
                            <small>Coâ€‘Creation: ${coSample ? `${fmt(coSample)} Ø¹ÙŠÙ†Ø©` : "ØºÙŠØ± Ù…ÙƒØªÙ…Ù„"} â€¢ Ø¬Ø§Ù‡Ø²ÙŠØ© ${coCoverage}%${coScore ? ` â€¢ ØªÙ‚ÙŠÙŠÙ… ${fmt(coScore)}/5` : ""}</small>
                            <small>Ø§Ù„ØªÙØ§Ø¹Ù„: ${fmt(interact)} â€¢ ğŸ‘ ${fmt(up)} â€¢ ğŸ‘ ${fmt(down)}</small>
                        </div>
                        ${i.prototype ? `<div class="mini"><div class="mini-progress"><span style="width:${protoProgress}%"></span></div><small>Prototype: ${fmt(protoProgress)}%</small></div>` : ""}
                        <div class="vote-row">
                            <button class="btn btn-soft sm" data-vote-up="${esc(i.id)}">ğŸ‘ ${fmt(up)}</button>
                            <button class="btn btn-ghost sm" data-vote-down="${esc(i.id)}">ğŸ‘ ${fmt(down)}</button>
                        </div>
                        <div class="kactions">
                            <button class="btn btn-soft sm" data-open="${esc(i.id)}">ØªÙØ§ØµÙŠÙ„</button>
                            <button class="btn btn-ghost sm" data-j="${esc(i.id)}">Ù„Ù„ØªØ­ÙƒÙŠÙ…</button>
                            <button class="btn btn-ghost sm" data-e="${esc(i.id)}">Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</button>
                        </div>
                    `;

                    card.addEventListener("dragstart", (e) => {
                        e.dataTransfer.setData("text/is_id", i.id);
                        card.classList.add("is-drag");
                    });
                    card.addEventListener("dragend", () => card.classList.remove("is-drag"));
                    zone.appendChild(card);
                });

                $$('[data-open]', board).forEach((b) => b.addEventListener("click", () => showDetails(b.getAttribute("data-open"))));
                $$('[data-j]', board).forEach((b) => b.addEventListener("click", () => goJudging(b.getAttribute("data-j"))));
                $$('[data-e]', board).forEach((b) => b.addEventListener("click", () => goEmployee(b.getAttribute("data-e"))));
                $$('[data-vote-up]', board).forEach((b) => b.addEventListener("click", () => voteInitiative(b.getAttribute("data-vote-up"), 1)));
                $$('[data-vote-down]', board).forEach((b) => b.addEventListener("click", () => voteInitiative(b.getAttribute("data-vote-down"), -1)));
            }

            function renderAll() {
                normalizeState();
                fillOrgFilter();
                const list = filteredInitiatives();
                renderWorkspaceHub(list);
                renderKpiVisuals(list);
                renderHonorBoard(list);
                renderStageMiniAnalytics(list);
                renderHeatmap(list);
                renderCriticalQueue(list);
                renderBoard(list);
            }

            function newId(prefix = "I") {
                const rnd = Math.floor(1000 + Math.random() * 8999);
                return `${prefix}-${rnd}`;
            }

            async function moveToStage(id, stage) {
                const i = (IS.state.initiatives || []).find((x) => x.id === id);
                if (!i || !stage || i.stage === stage) return;

                const from = i.stage;
                i.stage = stage;
                if (stage === "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…" && i.status === "Ù…Ø³ÙˆØ¯Ø©") i.status = "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…";
                if (stage === "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ" && i.status === "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…") i.status = "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±";
                if (stage === "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯" && i.status === "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±") i.status = "Ù…Ø¹ØªÙ…Ø¯";
                if (stage === "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" && i.status === "Ù…Ø¹ØªÙ…Ø¯") i.status = "Ù…Ø·Ø¨Ù‚";

                i.updatedAt = nowISO();
                i.priority = inferPriority(i);
                addChange(i, "Ù†Ù‚Ù„ Ù…Ø±Ø­Ù„Ø©", `${from} â†’ ${stage}`);
                IS.audit("Ù†Ù‚Ù„ Ù…Ø±Ø­Ù„Ø©", `${id} â€¢ ${from} â†’ ${stage}`);
                IS.save();

                try {
                    await apiRequest(`/api/v2/initiatives/${encodeURIComponent(i.id)}`, {
                        method: "PATCH",
                        body: {
                            stage: mapStageToApi(i.stage),
                            status: mapStatusToApi(i.status)
                        }
                    });
                } catch {
                    IS.toast("ØªÙ… Ø§Ù„Ù†Ù‚Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§ØŒ ÙˆØªØ¹Ø°Ø± Ù…Ø²Ø§Ù…Ù†Ø© API Ø­Ø§Ù„ÙŠØ§Ù‹.", "warn", 1800);
                }

                renderAll();
                IS.toast("ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© âœ…", "ok", 1400);
            }

            function applyTemplatePreset() {
                const key = $("#nTemplate").value;
                if (!key || !TEMPLATE_PRESETS[key]) return;
                const t = TEMPLATE_PRESETS[key];
                if (!$("#nTitle").value.trim()) $("#nTitle").value = t.title;
                if (!$("#nDesc").value.trim()) $("#nDesc").value = t.desc;
                if (!$("#nProblem").value.trim()) $("#nProblem").value = t.problem;
                if (!$("#nBeneficiary").value.trim()) $("#nBeneficiary").value = t.beneficiary;
                if (!$("#nEvidence").value.trim()) $("#nEvidence").value = t.evidence;
                if (t.tag) $("#nTag").value = t.tag;
                if (t.stage) $("#nStage").value = t.stage;
                if (t.status) $("#nStatus").value = t.status;
            }

            function applyAiDraftToNew(mode = "draft") {
                const source = {
                    title: ($("#nTitle").value || "").trim(),
                    tag: $("#nTag").value || "",
                    problem: ($("#nProblem").value || "").trim(),
                    beneficiary: ($("#nBeneficiary").value || "").trim(),
                    desc: ($("#nDesc").value || "").trim(),
                    evidence: ($("#nEvidence").value || "").trim(),
                    painPoints: ($("#nCoPain").value || "").trim(),
                    recommendation: ($("#nCoReco").value || "").trim()
                };
                const draft = aiDraftFromInputs(source);
                if (!$("#nTitle").value.trim()) $("#nTitle").value = draft.title;
                if (!$("#nDesc").value.trim() || mode === "improve") $("#nDesc").value = draft.desc;
                if (!$("#nProblem").value.trim() || mode === "improve") $("#nProblem").value = draft.problem;
                if (!$("#nBeneficiary").value.trim() || mode === "improve") $("#nBeneficiary").value = draft.beneficiary;
                if (!$("#nEvidence").value.trim() || mode === "improve") $("#nEvidence").value = draft.evidence;
                if (!$("#nCoPain").value.trim() || mode === "improve") $("#nCoPain").value = draft.pain;
                if (!$("#nCoReco").value.trim() || mode === "improve") $("#nCoReco").value = draft.reco;
                $("#nAiOutput").value = `AI Coâ€‘Pilot:\n- Ù…Ø´ÙƒÙ„Ø©: ${draft.problem}\n- ÙˆØµÙ Ø§Ù„Ø­Ù„: ${draft.desc}\n- MVP: ${draft.mvp.join(" | ")}\n- ØªÙˆØµÙŠØ©: ${draft.reco}`;
                IS.toast("ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ØµÙŠØ§ØºØ© AI Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ âœ…", "ok", 1600);
            }

            async function createInitiative() {
                const title = ($("#nTitle").value || "").trim();
                if (!title) {
                    IS.toast("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹.", "warn", 2200);
                    return;
                }

                const tag = $("#nTag").value;
                const stage = $("#nStage").value;
                const status = $("#nStatus").value;
                const desc = ($("#nDesc").value || "").trim();
                const problem = ($("#nProblem").value || "").trim();
                const beneficiary = ($("#nBeneficiary").value || "").trim();
                const evidence = ($("#nEvidence").value || "").trim();
                const coSample = Math.max(0, Number($("#nCoSample").value || 0));
                const coScore = toNullableNumber($("#nCoScore").value, 1, 5);
                const coPain = ($("#nCoPain").value || "").trim();
                const coReco = ($("#nCoReco").value || "").trim();
                const nOrg = ($("#nOrg").value || "").trim() || "Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ØµØ­ÙŠ Ø¨Ø§Ù„Ø·Ø§Ø¦Ù";
                const template = $("#nTemplate").value;
                const teamId = ($("#nTeam").value || "").trim() || getTeamById()?.id || "T-1001";
                const autoWorkspace = !!($("#nAutoWorkspace") && $("#nAutoWorkspace").checked);
                const autoAiTasks = !!($("#nAutoAiTasks") && $("#nAutoAiTasks").checked);

                const iso = nowISO();
                const item = {
                    id: newId("I"),
                    title,
                    stage,
                    status,
                    progress: status === "Ù…Ø³ÙˆØ¯Ø©" ? 10 : (status === "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…" ? 25 : 32),
                    score: null,
                    rubric: null,
                    minutes: "",
                    desc,
                    tags: [tag || getTaxonomy()[0]],
                    ownerTeam: teamId,
                    organization: nOrg,
                    validation: { problem, beneficiary, evidence },
                    coCreation: {
                        sampleSize: coSample,
                        score: coScore,
                        painPoints: coPain,
                        recommendation: coReco,
                        updatedAt: (coSample > 0 || coScore != null || coPain || coReco) ? iso : null
                    },
                    impact: { costSaving: 0, timeSavingPct: 0, implementationCost: 0, operatingCost: 0, horizonYears: 3, confidencePct: 75 },
                    postMonitoring: {
                        owner: "Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©",
                        expected: { annualSaving: 0, timeSavingPct: 0 },
                        m3: { annualSaving: null, timeSavingPct: null, qualityImprovementPct: null, satisfactionPct: null, recordedAt: null },
                        m6: { annualSaving: null, timeSavingPct: null, qualityImprovementPct: null, satisfactionPct: null, recordedAt: null },
                        notes: ""
                    },
                    prototype: stage === "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ" ? {
                        id: newId("P"),
                        template: "Dashboard",
                        support: "Prototype Support Unit",
                        scope: template ? `Template: ${template}` : "Ù†Ø³Ø®Ø© Ø£ÙˆÙ„ÙŠØ©",
                        progress: 10,
                        status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",
                        createdAt: iso
                    } : null,
                    tasks: [],
                    comments: [],
                    files: [],
                    changeLog: [],
                    createdAt: iso,
                    updatedAt: iso
                };

                ensureShape(item);
                if (autoWorkspace) autoCreateWorkspace(item, { aiTasks: autoAiTasks });
                if (autoAiTasks) distributeTasksByAI(item);
                item.priority = inferPriority(item);
                addChange(item, "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¨Ø§Ø¯Ø±Ø©", `Template: ${template || "â€”"} â€¢ Team: ${teamId}`);
                pushNotification(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© ${item.id} (${item.title}).`, item.id, "idea");
                addPoints(10, "Ø¥Ø·Ù„Ø§Ù‚ Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©", item.id);

                IS.state.initiatives.unshift(item);
                IS.audit("Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø¯Ø±Ø©", `${item.id} â€¢ ${title}`);
                IS.save();

                try {
                    const payload = await apiRequest("/api/v2/initiatives", {
                        method: "POST",
                        body: {
                            title: item.title,
                            stage: mapStageToApi(item.stage),
                            status: mapStatusToApi(item.status)
                        }
                    });
                    const rid = payload?.data?.id;
                    if (rid && !IS.state.initiatives.some((x) => x.id === rid)) {
                        item.id = rid;
                        addChange(item, "Ø±Ø¨Ø· Ù…Ø¹Ø±Ù API", rid);
                    }
                } catch {
                    IS.toast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ØŒ ÙˆØªØ¹Ø°Ø± Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ API Ø­Ø§Ù„ÙŠØ§Ù‹.", "warn", 2000);
                }

                ["#nTitle", "#nDesc", "#nProblem", "#nBeneficiary", "#nEvidence", "#nOrg", "#nCoSample", "#nCoScore", "#nCoPain", "#nCoReco", "#nAiOutput"].forEach((id) => { $(id).value = ""; });
                $("#nTemplate").value = "";
                $("#nAutoWorkspace").checked = true;
                $("#nAutoAiTasks").checked = true;
                closeNew();
                renderAll();
                IS.toast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© âœ…", "ok", 1700);
            }

            function showDetails(id) {
                const i = (IS.state.initiatives || []).find((x) => x.id === id);
                if (!i) return;
                ensureShape(i);
                current = i;

                $("#dTitle").textContent = `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© â€” ${i.title}`;
                $("#dId").value = i.id;
                $("#dStage").value = i.stage;
                $("#dStatus").value = i.status || "Ù…Ø³ÙˆØ¯Ø©";
                $("#dProgress").value = clamp(i.progress || 0, 0, 100);

                $("#pTemplate").value = i.prototype?.template || "";
                $("#pProgress").value = clamp(i.prototype?.progress || 0, 0, 100);
                $("#pSupport").value = i.prototype?.support || "Prototype Support Unit";
                $("#pStatus").value = i.prototype?.status || "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±";

                $("#dProblem").value = i.validation?.problem || "";
                $("#dBeneficiary").value = i.validation?.beneficiary || "";
                $("#dEvidence").value = i.validation?.evidence || "";
                $("#dCoSample").value = Math.max(0, Number(i.coCreation?.sampleSize || 0));
                $("#dCoScore").value = i.coCreation?.score == null ? "" : clamp(i.coCreation.score, 1, 5);
                $("#dCoPain").value = i.coCreation?.painPoints || "";
                $("#dCoReco").value = i.coCreation?.recommendation || "";
                $("#dCostSaving").value = Math.max(0, Number(i.impact?.costSaving || 0));
                $("#dTimeSaving").value = clamp(i.impact?.timeSavingPct || 0, 0, 100);

                const mon = i.postMonitoring || {};
                const setNullable = (id2, value) => { $(id2).value = (value == null ? "" : value); };
                $("#dMonOwner").value = mon.owner || "";
                $("#dMonNotes").value = mon.notes || "";
                $("#dMonExpectedSaving").value = Math.max(0, Number(mon.expected?.annualSaving ?? i.impact?.costSaving ?? 0));
                $("#dMonExpectedTime").value = clamp(mon.expected?.timeSavingPct ?? i.impact?.timeSavingPct ?? 0, 0, 100);
                setNullable("#dMon3Saving", mon.m3?.annualSaving ?? null);
                setNullable("#dMon3Time", mon.m3?.timeSavingPct ?? null);
                setNullable("#dMon3Quality", mon.m3?.qualityImprovementPct ?? null);
                setNullable("#dMon3Sat", mon.m3?.satisfactionPct ?? null);
                setNullable("#dMon6Saving", mon.m6?.annualSaving ?? null);
                setNullable("#dMon6Time", mon.m6?.timeSavingPct ?? null);
                setNullable("#dMon6Quality", mon.m6?.qualityImprovementPct ?? null);
                setNullable("#dMon6Sat", mon.m6?.satisfactionPct ?? null);
                $("#dAiOutput").value = summarizeCurrentWorkspace();

                renderTasks();
                renderComments();
                renderFiles();
                renderChangeLog();

                IS.audit("ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ù…Ø¨Ø§Ø¯Ø±Ø©", i.id);
                IS.save();
                openDetails();
            }

            function renderTasks() {
                if (!current) return;
                current.tasks = current.tasks || [];
                $("#tCount").textContent = `${fmt(current.tasks.length)} Ù…Ù‡Ø§Ù…`;
                $("#tList").innerHTML = current.tasks.map((t) => {
                    const badge = t.col === "done" ? "is-good" : (t.col === "doing" ? "is-mid" : "is-low");
                    const due = t.due ? ` â€¢ ${t.due}` : "";
                    return `
                        <li>
                            <strong>${esc(t.title)}</strong>
                            <div style="margin-top:4px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
                                <span class="status-badge ${badge}">${esc(String(t.col || "todo").toUpperCase())}</span>
                                <span class="status-badge is-low">${esc(t.owner || "â€”")}${due}</span>
                                <button class="btn btn-ghost sm" data-del="${esc(t.id)}">Ø­Ø°Ù</button>
                            </div>
                        </li>
                    `;
                }).join("");

                $$('[data-del]', $("#tList")).forEach((b) => b.addEventListener("click", () => {
                    const tid = b.getAttribute("data-del");
                    current.tasks = current.tasks.filter((x) => x.id !== tid);
                    current.updatedAt = nowISO();
                    addChange(current, "Ø­Ø°Ù Ù…Ù‡Ù…Ø©", tid);
                    IS.audit("Ø­Ø°Ù Ù…Ù‡Ù…Ø©", `${current.id} â€¢ ${tid}`);
                    IS.save();
                    renderTasks();
                    renderAll();
                }));
            }

            function addTask() {
                if (!current) return;
                const title = ($("#tTitle").value || "").trim();
                if (!title) { IS.toast("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©.", "warn"); return; }
                const owner = ($("#tOwner").value || "").trim() || "Ø¹Ø¶Ùˆ";
                const col = $("#tCol").value;
                const due = $("#tDue").value || "";

                const id = newId("TK");
                current.tasks.unshift({ id, title, owner, col, due });
                current.updatedAt = nowISO();
                addChange(current, "Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©", `${id} â€¢ ${title}`);
                IS.audit("Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©", `${current.id} â€¢ ${id}`);
                IS.save();

                ["#tTitle", "#tOwner", "#tDue"].forEach((id2) => { $(id2).value = ""; });
                renderTasks();
                renderAll();
                IS.toast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© âœ…", "ok", 1500);
            }

            function renderComments() {
                if (!current) return;
                current.comments = current.comments || [];
                $("#dComments").innerHTML = current.comments.length ? current.comments.map((c) => `
                    <li>
                        <strong>${esc(c.author || "Ù…ÙˆØ¸Ù")}</strong>
                        <div>${esc(c.text || "")}</div>
                        <span class="time">${new Date(c.at || nowISO()).toLocaleString("ar-SA")}</span>
                    </li>
                `).join("") : `<li>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯.</li>`;
            }

            function addComment() {
                if (!current) return;
                const text = ($("#dCommentText").value || "").trim();
                const author = ($("#dCommentAuthor").value || "").trim() || "Ù…ÙˆØ¸Ù";
                if (!text) { IS.toast("Ø§ÙƒØªØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø£ÙˆÙ„Ø§Ù‹.", "warn", 1400); return; }

                current.comments.unshift({ id: newId("CM"), text, author, at: nowISO() });
                current.updatedAt = nowISO();
                addChange(current, "Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚", `${author}`);
                IS.audit("ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù„Ù‰ Ù…Ø¨Ø§Ø¯Ø±Ø©", `${current.id} â€¢ ${author}`);
                pushNotification(`ØªØ¹Ù„ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ ${current.id} Ø¨ÙˆØ§Ø³Ø·Ø© ${author}.`, current.id, "comment");
                addPoints(2, "ØªØ¹Ø§ÙˆÙ† Ø¹Ø¨Ø± ØªØ¹Ù„ÙŠÙ‚", current.id);
                IS.save();
                $("#dCommentText").value = "";
                $("#dCommentAuthor").value = "";
                renderComments();
                renderAll();
            }

            function summarizeCurrentWorkspace() {
                if (!current) return "";
                const tasks = current.tasks || [];
                const done = tasks.filter((t) => t.col === "done").length;
                const doing = tasks.filter((t) => t.col === "doing").length;
                const todo = tasks.filter((t) => t.col === "todo").length;
                const comments = (current.comments || []).length;
                const files = (current.files || []).length;
                const summary = [
                    `Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ${current.id}:`,
                    `- Ø§Ù„Ù…Ù‡Ø§Ù…: ${tasks.length} (Done ${done} / Doing ${doing} / Todo ${todo})`,
                    `- Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª: ${comments}`,
                    `- Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª: ${files}`,
                    `- Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: ${clamp(current.progress || 0, 0, 100)}%`
                ].join("\n");
                return summary;
            }

            function runAiTaskDistributionCurrent() {
                if (!current) return;
                const count = distributeTasksByAI(current);
                current.updatedAt = nowISO();
                addChange(current, "ØªÙˆØ²ÙŠØ¹ Ù…Ù‡Ø§Ù… AI", `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙˆØ²Ø¹Ø©: ${count}`);
                IS.audit("ØªÙˆØ²ÙŠØ¹ AI", `${current.id} â€¢ ${count} Ù…Ù‡Ø§Ù…`);
                IS.save();
                renderTasks();
                renderComments();
                renderAll();
                $("#dAiOutput").value = count
                    ? `AI Distribution:\nØªÙ… ØªÙˆØ²ÙŠØ¹ ${count} Ù…Ù‡Ø§Ù… Ø¹Ù„Ù‰ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.`
                    : "AI Distribution:\nÙ„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù‚Ø§Ø¨Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø§Ù„ÙŠÙ‹Ø§.";
                IS.toast("ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¹Ø¨Ø± AI âœ…", "ok", 1600);
            }

            function runAiTaskSummaryCurrent() {
                if (!current) return;
                const summary = summarizeCurrentWorkspace();
                $("#dAiOutput").value = summary;
                pushNotification(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ AI Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ${current.id}.`, current.id, "ai");
                addPoints(3, "ØªÙ„Ø®ÙŠØµ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„", current.id);
                IS.save();
                IS.toast("ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ø®Øµ AI âœ…", "ok", 1500);
            }

            function runAiSuggestCurrent() {
                if (!current) return;
                const tips = aiImprovementTips(current);
                $("#dAiOutput").value = `AI Improvement Tips:\n- ${tips.join("\n- ")}`;
                pushNotification(`AI Ø§Ù‚ØªØ±Ø­ ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ${current.id}.`, current.id, "ai");
                addPoints(4, "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª AI", current.id);
                IS.save();
                IS.toast("ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ØªØ­Ø³ÙŠÙ† âœ…", "ok", 1500);
            }

            function runAiSolveCurrent() {
                if (!current) return;
                const solutions = aiSolutionIdeas(current);
                $("#dAiOutput").value = `AI Solution Ideas:\n- ${solutions.join("\n- ")}`;
                pushNotification(`AI Ø§Ù‚ØªØ±Ø­ Ø­Ù„ÙˆÙ„Ù‹Ø§ ØªÙ†ÙÙŠØ°ÙŠØ© Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ${current.id}.`, current.id, "ai");
                addPoints(4, "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ù„ÙˆÙ„ AI", current.id);
                IS.save();
                IS.toast("ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø­Ù„ÙˆÙ„ AI âœ…", "ok", 1500);
            }

            function submitFinalProductCurrent() {
                if (!current) return;
                const hasProblem = String(current.validation?.problem || "").trim().length > 0;
                const hasTasks = (current.tasks || []).length >= 3;
                const hasWork = (!!current.prototype && Number(current.prototype.progress || 0) >= 35) || Number(current.progress || 0) >= 60;
                if (!hasProblem || !hasTasks || !hasWork) {
                    $("#dAiOutput").value = "Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯.\nØ£ÙƒÙ…Ù„: ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© + 3 Ù…Ù‡Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ + ØªÙ‚Ø¯Ù… ÙƒØ§ÙÙ ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°.";
                    IS.toast("Ø£ÙƒÙ…Ù„ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ….", "warn", 1900);
                    return;
                }

                const fromStage = current.stage;
                current.stage = "Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯";
                current.status = "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…";
                current.progress = Math.max(80, Number(current.progress || 0));
                current.updatedAt = nowISO();
                addChange(current, "ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", `${fromStage} â†’ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯`);
                current.comments = Array.isArray(current.comments) ? current.comments : [];
                current.comments.unshift({
                    id: newId("CM"),
                    text: "ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ØªØ­ÙƒÙŠÙ….",
                    author: "System Bot",
                    at: nowISO()
                });
                pushNotification(`ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ${current.id} Ù„Ù„ØªØ­ÙƒÙŠÙ….`, current.id, "final");
                addPoints(20, "ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", current.id);
                IS.audit("ØªÙ‚Ø¯ÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠ", `${current.id} â€¢ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯`);
                IS.save();

                $("#dAiOutput").value = "ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ù†Ø¬Ø§Ø­ âœ…\nØ§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù†ØªÙ‚Ù„Øª Ø¥Ù„Ù‰ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯/Ø§Ù„ØªØ­ÙƒÙŠÙ….";
                renderTasks();
                renderComments();
                renderAll();
                IS.toast("ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ âœ…", "ok", 1700);
            }

            function renderFiles() {
                if (!current) return;
                current.files = current.files || [];
                $("#dFiles").innerHTML = current.files.length ? current.files.map((f) => `
                    <li>
                        <strong>${esc(f.fileName || "file")}</strong>
                        <div>${esc(f.fileType || "Document")} â€¢ ${esc(f.addedBy || "Ù…ÙˆØ¸Ù")}</div>
                        <span class="time">${new Date(f.at || nowISO()).toLocaleString("ar-SA")}</span>
                    </li>
                `).join("") : `<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ÙÙ‚Ø§Øª Ø¨Ø¹Ø¯.</li>`;
            }

            function addFile() {
                if (!current) return;
                const fileName = ($("#dFileName").value || "").trim();
                const fileType = $("#dFileType").value || "Document";
                if (!fileName) {
                    IS.toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙÙ‚ Ø£ÙˆÙ„Ø§Ù‹.", "warn", 1500);
                    return;
                }
                current.files.unshift({ id: newId("F"), fileName, fileType, addedBy: "Ù…ÙˆØ¸Ù", at: nowISO() });
                current.updatedAt = nowISO();
                addChange(current, "Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙÙ‚", fileName);
                IS.audit("Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙÙ‚", `${current.id} â€¢ ${fileName}`);
                pushNotification(`ØªÙ… Ø±ÙØ¹ Ù…Ø±ÙÙ‚ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ${current.id}.`, current.id, "file");
                addPoints(2, "Ø±ÙØ¹ Ù…Ø±ÙÙ‚", current.id);
                IS.save();
                $("#dFileName").value = "";
                renderFiles();
                renderAll();
            }

            function renderChangeLog() {
                if (!current) return;
                current.changeLog = current.changeLog || [];
                $("#dChangeLog").innerHTML = current.changeLog.length ? current.changeLog.map((c) => `
                    <li>
                        <strong>${esc(c.action || "ØªØ­Ø¯ÙŠØ«")}</strong>
                        <div>${esc(c.details || "â€”")}</div>
                        <span class="time">${new Date(c.at || nowISO()).toLocaleString("ar-SA")}</span>
                    </li>
                `).join("") : `<li>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ø¹Ø¯.</li>`;
            }

            async function saveDetails() {
                if (!current) return;

                const stage = $("#dStage").value;
                const status = $("#dStatus").value;
                const progress = clamp($("#dProgress").value || 0, 0, 100);
                const problem = ($("#dProblem").value || "").trim();
                const beneficiary = ($("#dBeneficiary").value || "").trim();
                const evidence = ($("#dEvidence").value || "").trim();
                const coSample = Math.max(0, Number($("#dCoSample").value || 0));
                const coScore = toNullableNumber($("#dCoScore").value, 1, 5);
                const coPain = ($("#dCoPain").value || "").trim();
                const coReco = ($("#dCoReco").value || "").trim();
                const costSaving = Math.max(0, Number($("#dCostSaving").value || 0));
                const timeSavingPct = clamp($("#dTimeSaving").value || 0, 0, 100);
                const monOwner = ($("#dMonOwner").value || "").trim();
                const monNotes = ($("#dMonNotes").value || "").trim();
                const monExpectedSaving = Math.max(0, Number($("#dMonExpectedSaving").value || 0));
                const monExpectedTime = clamp($("#dMonExpectedTime").value || 0, 0, 100);
                const mon3Saving = toNullableNumber($("#dMon3Saving").value, 0);
                const mon3Time = toNullableNumber($("#dMon3Time").value, 0, 100);
                const mon3Quality = toNullableNumber($("#dMon3Quality").value, 0, 100);
                const mon3Sat = toNullableNumber($("#dMon3Sat").value, 0, 100);
                const mon6Saving = toNullableNumber($("#dMon6Saving").value, 0);
                const mon6Time = toNullableNumber($("#dMon6Time").value, 0, 100);
                const mon6Quality = toNullableNumber($("#dMon6Quality").value, 0, 100);
                const mon6Sat = toNullableNumber($("#dMon6Sat").value, 0, 100);

                const fromStage = current.stage;
                current.stage = stage;
                current.status = status;
                current.progress = progress;
                current.validation = { problem, beneficiary, evidence };
                current.coCreation = {
                    sampleSize: coSample,
                    score: coScore,
                    painPoints: coPain,
                    recommendation: coReco,
                    updatedAt: (coSample > 0 || coScore != null || coPain || coReco) ? nowISO() : null
                };
                current.impact = { ...(current.impact || {}), costSaving, timeSavingPct };

                const prevMon = current.postMonitoring || {};
                const has3m = [mon3Saving, mon3Time, mon3Quality, mon3Sat].some((v) => v != null);
                const has6m = [mon6Saving, mon6Time, mon6Quality, mon6Sat].some((v) => v != null);
                current.postMonitoring = {
                    owner: monOwner,
                    notes: monNotes,
                    expected: {
                        annualSaving: monExpectedSaving,
                        timeSavingPct: monExpectedTime
                    },
                    m3: {
                        annualSaving: mon3Saving,
                        timeSavingPct: mon3Time,
                        qualityImprovementPct: mon3Quality,
                        satisfactionPct: mon3Sat,
                        recordedAt: has3m ? (prevMon.m3?.recordedAt || nowISO()) : null
                    },
                    m6: {
                        annualSaving: mon6Saving,
                        timeSavingPct: mon6Time,
                        qualityImprovementPct: mon6Quality,
                        satisfactionPct: mon6Sat,
                        recordedAt: has6m ? (prevMon.m6?.recordedAt || nowISO()) : null
                    }
                };

                const tpl = $("#pTemplate").value;
                if (tpl) {
                    current.prototype = current.prototype || { id: newId("P"), createdAt: nowISO() };
                    current.prototype.template = tpl;
                    current.prototype.progress = clamp($("#pProgress").value || 0, 0, 100);
                    current.prototype.support = $("#pSupport").value;
                    current.prototype.status = $("#pStatus").value;
                } else {
                    current.prototype = null;
                }

                current.priority = inferPriority(current);
                current.updatedAt = nowISO();
                addChange(current, "Ø­ÙØ¸ ØªÙØ§ØµÙŠÙ„", `${fromStage} â†’ ${stage} â€¢ ${status} â€¢ ${isCoCreationReady(current) ? "Coâ€‘Creation Ø¬Ø§Ù‡Ø²" : "Coâ€‘Creation Ù†Ø§Ù‚Øµ"}`);
                IS.audit("Ø­ÙØ¸ ØªÙØ§ØµÙŠÙ„ Ù…Ø¨Ø§Ø¯Ø±Ø©", `${current.id} â€¢ ${fromStage}â†’${stage} â€¢ ${status}`);
                IS.save();

                try {
                    await apiRequest(`/api/v2/initiatives/${encodeURIComponent(current.id)}`, {
                        method: "PATCH",
                        body: {
                            stage: mapStageToApi(current.stage),
                            status: mapStatusToApi(current.status)
                        }
                    });
                } catch {
                    IS.toast("ØªØ¹Ø°Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹ API. ØªÙ… Ø­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§.", "warn", 1800);
                }

                IS.toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…", "ok", 1600);
                renderAll();
                closeDetails();
            }

            function seedMore() {
                const len = (IS.state.initiatives || []).length;
                if (len >= 10) {
                    IS.toast("Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ğŸ‘Œ", "warn");
                    return;
                }

                const iso = nowISO();
                IS.state.initiatives.unshift(
                    {
                        id: "I-3881",
                        title: "Ø£Ø¯Ø§Ø© ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ÙÙƒØ±Ø© (Validation)",
                        stage: "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
                        status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙŠÙ…",
                        progress: 38,
                        tags: ["ØªØ´ØºÙŠÙ„ÙŠ"],
                        organization: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†",
                        validation: { problem: "Ø¶Ø¹Ù Ø¯Ù‚Ø© Ø§Ù„Ø£ÙÙƒØ§Ø±", beneficiary: "Ø§Ù„Ù…Ù†Ø³Ù‚ÙˆÙ† ÙˆØ§Ù„Ù…Ù‚ÙŠÙ…ÙˆÙ†", evidence: "10 Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ø£ÙˆÙ„ÙŠØ© + Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø¯Ø§Ø®Ù„ÙŠ" },
                        coCreation: { sampleSize: 14, score: 4, painPoints: "ØªØ£Ø®Ø± Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ù…Ù‚Ø¯Ù… Ø§Ù„ÙÙƒØ±Ø© ÙˆØªÙƒØ±Ø§Ø± Ø§Ù„Ù†Ù…Ø§Ø°Ø¬", recommendation: "Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­ÙƒÙŠÙ… Ù…Ø¹ ØªØ¨Ø³ÙŠØ· ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„", updatedAt: iso },
                        impact: { costSaving: 180000, timeSavingPct: 25, implementationCost: 90000, operatingCost: 18000, horizonYears: 3, confidencePct: 80 },
                        postMonitoring: {
                            owner: "Ù…Ø¯ÙŠØ± Ø§Ù„ØªØ­Ø³ÙŠÙ†",
                            expected: { annualSaving: 180000, timeSavingPct: 25 },
                            m3: { annualSaving: 92000, timeSavingPct: 14, qualityImprovementPct: 12, satisfactionPct: 78, recordedAt: iso },
                            m6: { annualSaving: null, timeSavingPct: null, qualityImprovementPct: null, satisfactionPct: null, recordedAt: null },
                            notes: "Ù†ØªØ§Ø¦Ø¬ Ø£ÙˆÙ„ÙŠØ© Ù…Ø¨Ø´Ø±Ø© Ø¨Ø¹Ø¯ 3 Ø£Ø´Ù‡Ø±."
                        },
                        prototype: null,
                        tasks: [],
                        comments: [],
                        files: [],
                        changeLog: [{ at: iso, action: "Ø¥Ù†Ø´Ø§Ø¡ Ø¹ÙŠÙ†Ø©", details: "Seed" }],
                        createdAt: iso,
                        updatedAt: iso
                    },
                    {
                        id: "I-3884",
                        title: "Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØµØ­ÙŠØ© (Knowledge Hub)",
                        stage: "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ",
                        status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",
                        progress: 52,
                        tags: ["Ø±Ù‚Ù…Ù†Ø©"],
                        organization: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©",
                        validation: { problem: "ØªÙƒØ±Ø§Ø± Ø£Ø®Ø·Ø§Ø¡ Ø³Ø§Ø¨Ù‚Ø©", beneficiary: "Ø§Ù„Ù…Ø¨ØªÙƒØ±ÙˆÙ† Ø§Ù„Ø¬Ø¯Ø¯", evidence: "ØªØ­Ù„ÙŠÙ„ 12 Ù…Ø¨Ø§Ø¯Ø±Ø© Ø³Ø§Ø¨Ù‚Ø©" },
                        coCreation: { sampleSize: 6, score: 3, painPoints: "ØµØ¹ÙˆØ¨Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø© Ø¨Ø³Ø±Ø¹Ø©", recommendation: "Ø¥Ø¶Ø§ÙØ© Ø¨Ø­Ø« Ø£Ø³Ø±Ø¹ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙƒÙŠÙ…", updatedAt: iso },
                        impact: { costSaving: 260000, timeSavingPct: 31, implementationCost: 145000, operatingCost: 32000, horizonYears: 3, confidencePct: 84 },
                        postMonitoring: {
                            owner: "Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø¹Ø±ÙØ©",
                            expected: { annualSaving: 260000, timeSavingPct: 31 },
                            m3: { annualSaving: 150000, timeSavingPct: 20, qualityImprovementPct: 18, satisfactionPct: 82, recordedAt: iso },
                            m6: { annualSaving: 278000, timeSavingPct: 33, qualityImprovementPct: 24, satisfactionPct: 88, recordedAt: iso },
                            notes: "ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù ÙÙŠ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¯Ø³."
                        },
                        prototype: { id: "P-4884", template: "Landing Page", support: "Prototype Support Unit", scope: "Ù…ÙƒØªØ¨Ø© + Ù‚ÙˆØ§Ù„Ø¨", progress: 40, status: "Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±", createdAt: iso },
                        tasks: [],
                        comments: [],
                        files: [],
                        changeLog: [{ at: iso, action: "Ø¥Ù†Ø´Ø§Ø¡ Ø¹ÙŠÙ†Ø©", details: "Seed" }],
                        createdAt: iso,
                        updatedAt: iso
                    }
                );

                normalizeState();
                IS.audit("Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø§Øª Ù„Ù„Ø®Ø±ÙŠØ·Ø©", "seed");
                IS.save();
                IS.toast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø§Øª âœ…", "ok", 1600);
                renderAll();
            }

            async function syncInitiativesFromApi({ silent = true } = {}) {
                try {
                    const payload = await apiRequest("/api/v2/initiatives", { method: "GET", timeoutMs: 3600 });
                    const rows = Array.isArray(payload?.data) ? payload.data : [];
                    if (!rows.length) return { loaded: false, count: 0 };

                    const remote = rows.map((r) => ({
                        id: r.id,
                        title: r.title || "Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†",
                        stage: mapStageToLocal(r.stage),
                        status: mapStatusToLocal(r.status),
                        score: Number.isFinite(Number(r.averageScore)) ? clamp(r.averageScore, 0, 100) : null,
                        progress: clamp(({
                            "idea_submission": 12,
                            "screening": 22,
                            "evaluation": 34,
                            "team_formation": 44,
                            "prototype": 56,
                            "development": 66,
                            "pilot": 76,
                            "approval": 86,
                            "launch": 96
                        }[String(r.stage)] || 24), 0, 100),
                        updatedAt: r.updatedAt || r.createdAt || nowISO(),
                        organization: r.ownerName || "Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ØµØ­ÙŠ Ø¨Ø§Ù„Ø·Ø§Ø¦Ù",
                        tags: []
                    }));

                    const local = IS.state.initiatives || [];
                    const localMap = new Map(local.map((i) => [i.id, i]));

                    const merged = remote.map((r) => ({
                        ...(localMap.get(r.id) || {}),
                        ...r,
                        tags: Array.isArray(localMap.get(r.id)?.tags) ? localMap.get(r.id).tags : [],
                        tasks: Array.isArray(localMap.get(r.id)?.tasks) ? localMap.get(r.id).tasks : [],
                        comments: Array.isArray(localMap.get(r.id)?.comments) ? localMap.get(r.id).comments : [],
                        files: Array.isArray(localMap.get(r.id)?.files) ? localMap.get(r.id).files : [],
                        changeLog: Array.isArray(localMap.get(r.id)?.changeLog) ? localMap.get(r.id).changeLog : []
                    }));

                    local.forEach((item) => {
                        if (!merged.some((x) => x.id === item.id)) merged.push(item);
                    });

                    IS.state.initiatives = merged;
                    normalizeState();
                    IS.save();
                    if (!silent) IS.toast(`ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© ${fmt(remote.length)} Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…Ù† API`, "ok", 1400);
                    return { loaded: true, count: remote.length };
                } catch (err) {
                    if (!silent) IS.toast("ØªØ¹Ø°Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ù† API. ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.", "warn", 1700);
                    return { loaded: false, count: 0, error: err?.message || "API_UNAVAILABLE" };
                }
            }

            function setLiveMode(nextState) {
                liveMode = !!nextState;
                const badge = $("#liveState");
                badge.textContent = `LIVE: ${liveMode ? "ON" : "OFF"}`;
                badge.classList.toggle("is-on", liveMode);
                $("#btnLiveToggle").textContent = liveMode ? "Ø¥ÙŠÙ‚Ø§Ù Live" : "ØªØ´ØºÙŠÙ„ Live";

                if (liveTimer) {
                    clearInterval(liveTimer);
                    liveTimer = null;
                }
                if (liveMode) {
                    liveTimer = setInterval(async () => {
                        await syncInitiativesFromApi({ silent: true });
                        renderAll();
                    }, 20000);
                }
            }

            function resetFilters() {
                ["#q", "#qSemantic", "#status", "#tag", "#maturityFilter", "#riskFilter", "#priorityFilter", "#orgFilter", "#dateFrom", "#dateTo"].forEach((id) => {
                    const node = $(id);
                    if (!node) return;
                    if (node.tagName === "SELECT") node.value = "";
                    else node.value = "";
                });
                renderAll();
                IS.toast("ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙÙ„Ø§ØªØ± âœ…", "ok", 1400);
            }

            function openNewFlow() {
                fillTeams();
                updateNewHintByTeam();
                openNew();
            }

            function scrollToSection(selector) {
                const node = $(selector);
                if (!node) return;
                node.scrollIntoView({ behavior: "smooth", block: "start" });
            }

            function openJudgingShortcut() {
                const first = filteredInitiatives()[0] || (IS.state.initiatives || [])[0];
                if (first?.id) IS.setSelectedInitiative(first.id);
                IS.audit("Ø§Ø®ØªØµØ§Ø± Ø§Ù„ØªØ­ÙƒÙŠÙ…", first?.id || "none");
                IS.save();
                location.href = "../judging/index.html";
            }

            async function init() {
                fillStages();
                fillTaxonomy();
                fillTeams();
                await syncInitiativesFromApi({ silent: true });
                normalizeState();
                fillTeams();
                updateNewHintByTeam();

                IS.audit("ÙØªØ­ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±", "map");
                IS.save();

                const sel = IS.getSelectedInitiative();
                if (sel) IS.toast(`Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: ${sel}`, "ok", 1600);

                renderAll();
                setLiveMode(false);

                const openedBefore = localStorage.getItem(MAP_WELCOME_KEY) === "1";
                if (!openedBefore) openWelcome();

                $("#btnNew").addEventListener("click", openNewFlow);
                $("#btnPathChallenges").addEventListener("click", () => scrollToSection("#criticalList"));
                $("#btnPathBoard").addEventListener("click", () => scrollToSection("#board"));
                $("#btnPathJudging").addEventListener("click", openJudgingShortcut);
                $("#btnFirstGuide").addEventListener("click", openWelcome);
                $("#btnWelcome").addEventListener("click", openWelcome);
                $("#welcomeStartBtn").addEventListener("click", () => {
                    localStorage.setItem(MAP_WELCOME_KEY, "1");
                    closeWelcome();
                    openNewFlow();
                });
                $$('[data-close-welcome]').forEach((el) => el.addEventListener("click", () => {
                    localStorage.setItem(MAP_WELCOME_KEY, "1");
                    closeWelcome();
                }));

                $("#nTemplate").addEventListener("change", applyTemplatePreset);
                $("#nTeam").addEventListener("change", updateNewHintByTeam);
                $("#nAiDraft").addEventListener("click", () => applyAiDraftToNew("draft"));
                $("#nAiImprove").addEventListener("click", () => applyAiDraftToNew("improve"));
                $("#nCreate").addEventListener("click", createInitiative);

                $("#btnSeed").addEventListener("click", seedMore);
                $("#btnLiveToggle").addEventListener("click", () => setLiveMode(!liveMode));
                $("#btnApiSettings").addEventListener("click", openApiModal);

                ["q", "qSemantic", "status", "tag", "maturityFilter", "riskFilter", "priorityFilter", "orgFilter", "dateFrom", "dateTo"].forEach((id) => {
                    const node = document.getElementById(id);
                    if (!node) return;
                    node.addEventListener(node.tagName === "INPUT" && node.type !== "date" ? "input" : "change", renderAll);
                });

                $("#btnReset").addEventListener("click", resetFilters);

                $("#tAdd").addEventListener("click", addTask);
                $("#tAiDistribute").addEventListener("click", runAiTaskDistributionCurrent);
                $("#tAiSummary").addEventListener("click", runAiTaskSummaryCurrent);
                $("#dSave").addEventListener("click", saveDetails);
                $("#dCommentAdd").addEventListener("click", addComment);
                $("#dFileAdd").addEventListener("click", addFile);
                $("#dAiSuggest").addEventListener("click", runAiSuggestCurrent);
                $("#dAiSolve").addEventListener("click", runAiSolveCurrent);
                $("#dSubmitFinal").addEventListener("click", submitFinalProductCurrent);

                $("#btnApiSave").addEventListener("click", async () => {
                    const nextBase = setApiBase($("#apiBaseInput").value);
                    if (!nextBase) {
                        $("#apiStateHint").textContent = "Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† API ØµØ­ÙŠØ­ Ø£ÙˆÙ„Ø§Ù‹.";
                        return;
                    }
                    $("#apiStateHint").textContent = "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...";
                    const result = await syncInitiativesFromApi({ silent: true });
                    if (result.loaded) {
                        $("#apiStateHint").textContent = `ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ (${fmt(result.count)} Ù…Ø¨Ø§Ø¯Ø±Ø©).`;
                        renderAll();
                    } else {
                        $("#apiStateHint").textContent = "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠÙ‹Ø§.";
                    }
                });

                $("#btnApiTest").addEventListener("click", async () => {
                    $("#apiStateHint").textContent = "Ø¬Ø§Ø±Ù Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...";
                    const result = await syncInitiativesFromApi({ silent: true });
                    if (result.loaded) {
                        $("#apiStateHint").textContent = `Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ (${fmt(result.count)} Ù…Ø¨Ø§Ø¯Ø±Ø©).`;
                    } else {
                        $("#apiStateHint").textContent = "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€backend.";
                    }
                });
            }

            document.addEventListener("DOMContentLoaded", () => {
                init().catch(() => {
                    normalizeState();
                    renderAll();
                    setLiveMode(false);
                });
            });
        })();
    </script>

</body>

</html>
